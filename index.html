<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TourTick - Sistem Karcis Pariwisata</title>
    <!-- Load libraries from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f5f5;
            color: #333;
        }
        
        .sidebar {
            background-color: var(--dark-color);
            color: white;
            height: 100vh;
            position: fixed;
            transition: all 0.3s;
            overflow-y: auto;
        }
        
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.8);
            border-radius: 5px;
            margin: 5px 0;
            transition: all 0.2s;
        }
        
        .sidebar .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .sidebar .nav-link.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .main-content {
            margin-left: 250px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            border: none;
        }
        
        .card-header {
            background-color: var(--primary-color);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            padding: 12px 20px;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }
        
        .btn-danger {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
        }
        
        .ticket {
            border: 2px dashed #ccc;
            padding: 15px;
            margin: 10px 0;
            background-color: white;
            border-radius: 10px;
        }
        
        .barcode-container {
            text-align: center;
            margin: 15px 0;
        }
        
        /* Responsive styles */
        @media (max-width: 992px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                padding: 10px;
            }
            .main-content {
                margin-left: 0;
                padding: 15px;
            }
        }
        
        @media (max-width: 768px) {
            .row > div {
                margin-bottom: 15px;
            }
            .d-flex.justify-content-between {
                flex-direction: column;
            }
            .d-flex.justify-content-between > * {
                margin-bottom: 10px;
            }
            .card-body {
                padding: 15px;
            }
        }
        
        .search-box {
            position: relative;
        }
        
        .search-box i {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #aaa;
        }
        
        .search-box input {
            padding-left: 35px;
        }
        
        .ticket-preview {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        /* Receipt styles */
        .receipt {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            font-family: 'Courier New', monospace;
            padding: 15px;
            background-color: white;
            border: 1px solid #ddd;
        }
        
        .receipt .header {
            text-align: center;
            margin-bottom: 10px;
        }
        
        .receipt .divider {
            border-top: 1px dashed #000;
            margin: 10px 0;
        }
        
        .receipt .item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
        }
        
        .receipt .footer {
            text-align: center;
            margin-top: 15px;
            font-size: 0.9em;
        }
        
        .receipt-barcode {
            text-align: center;
            margin: 10px 0;
        }
        
        /* Status badges */
        .badge-valid {
            background-color: #28a745;
            color: white;
        }
        
        .badge-used {
            background-color: #17a2b8;
            color: white;
        }
        
        .badge-expired {
            background-color: #dc3545;
            color: white;
        }
        
        /* Access denied */
        .access-denied {
            text-align: center;
            padding: 50px 20px;
        }
        
        .access-denied i {
            font-size: 80px;
            color: var(--accent-color);
            margin-bottom: 20px;
        }
        
        /* Loading spinner */
        .loading-spinner {
            display: inline-block;
            width: 2rem;
            height: 2rem;
            vertical-align: text-bottom;
            border: 0.25em solid currentColor;
            border-right-color: transparent;
            border-radius: 50%;
            animation: spinner-border .75s linear infinite;
        }
        
        @keyframes spinner-border {
            to { transform: rotate(360deg); }
        }

        /* Footer */
        .app-footer {
            background-color: var(--dark-color);
            color: white;
            padding: 15px;
            text-align: center;
            margin-top: 20px;
            border-radius: 5px;
        }

        .app-footer a {
            color: var(--light-color);
            text-decoration: none;
        }

        .app-footer a:hover {
            color: var(--primary-color);
        }

        /* Role permissions */
        .permission-group {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 5px;
        }

        .permission-item {
            margin-bottom: 10px;
            padding: 8px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }

        .permission-checkbox {
            margin-right: 8px;
        }

        /* Backup section */
        .backup-card {
            cursor: pointer;
            transition: transform 0.2s;
        }

        .backup-card:hover {
            transform: translateY(-5px);
        }

        .backup-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        /* Logo styles */
        .app-logo {
            max-width: 150px;
            margin-bottom: 15px;
        }

        /* PDF styles */
        .pdf-table {
            width: 100%;
            border-collapse: collapse;
        }

        .pdf-table th, .pdf-table td {
            border: 1px solid #ddd;
            padding: 5px;
            font-size: 10px;
        }

        .pdf-table th {
            background-color: #f2f2f2;
            text-align: center;
        }

        /* Print styles */
        @media print {
            body * {
                visibility: hidden;
            }
            .receipt, .receipt * {
                visibility: visible;
            }
            .receipt {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                max-width: 100%;
                box-shadow: none;
                border: none;
            }
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="false" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog login-modal">
            <div class="modal-content">
                <div class="modal-body p-4">
                    <div class="login-logo text-center">
                        <img src="https://raw.githubusercontent.com/LKS-88/anekamarket/refs/heads/main/Logo-Anekamarketku.png" alt="TourTick Logo" class="app-logo">
                        <h3>TourTick</h3>
                        <p class="text-muted">Sistem Karcis Pariwisata</p>
                    </div>
                    <form id="loginForm">
                        <div class="mb-3">
                            <label class="form-label">Username</label>
                            <input type="text" class="form-control" id="loginUsername" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" id="loginPassword" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-sign-in-alt me-1"></i> Login
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App (hidden until login) -->
    <div id="appContainer" style="display: none;">
        <div class="d-flex flex-column flex-lg-row">
            <!-- Sidebar -->
            <div class="sidebar p-3" style="width: 250px;">
                <div class="text-center mb-4">
                    <img src="https://raw.githubusercontent.com/LKS-88/anekamarket/refs/heads/main/Logo-Anekamarketku.png" alt="TourTick Logo" class="app-logo">
                    <h4>TourTick</h4>
                    <p class="text-muted">Sistem Karcis Pariwisata</p>
                </div>
                <hr>
                <ul class="nav flex-column" id="sidebarMenu">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" onclick="showSection('dashboard')">
                            <i class="fas fa-home me-2"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('ticket-sales')">
                            <i class="fas fa-ticket-alt me-2"></i> Penjualan Karcis
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('generate-ticket')">
                            <i class="fas fa-barcode me-2"></i> Generate Karcis
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('ticket-list')">
                            <i class="fas fa-list me-2"></i> Daftar Karcis
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="showSection('reports')">
                            <i class="fas fa-chart-bar me-2"></i> Laporan
                        </a>
                    </li>
                    <li class="nav-item" id="products-menu-item">
                        <a class="nav-link" href="#" onclick="showSection('products')">
                            <i class="fas fa-map-marked-alt me-2"></i> Produk Wisata
                        </a>
                    </li>
                    <li class="nav-item" id="users-menu-item">
                        <a class="nav-link" href="#" onclick="showSection('users')">
                            <i class="fas fa-users me-2"></i> Pengguna
                        </a>
                    </li>
                    <li class="nav-item" id="settings-menu-item">
                        <a class="nav-link" href="#" onclick="showSection('settings')">
                            <i class="fas fa-cog me-2"></i> Pengaturan
                        </a>
                    </li>
                    <li class="nav-item" id="backup-menu-item">
                        <a class="nav-link" href="#" onclick="showSection('backup')">
                            <i class="fas fa-database me-2"></i> Backup Data
                        </a>
                    </li>
                </ul>
                <div class="mt-auto pt-3">
                    <div class="d-flex align-items-center">
                        <div class="user-avatar me-2" id="userAvatar">AD</div>
                        <div>
                            <small class="d-block" id="userName">Admin</small>
                            <small class="text-muted" id="userRole">Super User</small>
                        </div>
                    </div>
                    <button class="btn btn-sm btn-danger w-100 mt-3" onclick="logout()">
                        <i class="fas fa-sign-out-alt me-1"></i> Logout
                    </button>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <!-- Dashboard Section -->
                <div id="dashboard-section">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3>Dashboard</h3>
                        <div class="d-flex">
                            <div class="search-box me-2">
                                <i class="fas fa-search"></i>
                                <input type="text" class="form-control" placeholder="Cari...">
                            </div>
                            <button class="btn btn-primary" onclick="refreshDashboard()">
                                <i class="fas fa-sync-alt me-1"></i> Refresh
                            </button>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-3">
                            <div class="card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="text-muted">Penjualan Hari Ini</h6>
                                            <h3 id="todaySales">0</h3>
                                            <span class="text-success"><i class="fas fa-arrow-up me-1"></i> 0%</span>
                                        </div>
                                        <div class="bg-primary bg-opacity-10 p-3 rounded">
                                            <i class="fas fa-shopping-cart text-primary"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="text-muted">Pendapatan Hari Ini</h6>
                                            <h3 id="todayRevenue">Rp0</h3>
                                            <span class="text-success"><i class="fas fa-arrow-up me-1"></i> 0%</span>
                                        </div>
                                        <div class="bg-success bg-opacity-10 p-3 rounded">
                                            <i class="fas fa-wallet text-success"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="text-muted">Pengunjung Hari Ini</h6>
                                            <h3 id="todayVisitors">0</h3>
                                            <span class="text-danger"><i class="fas fa-arrow-down me-1"></i> 0%</span>
                                        </div>
                                        <div class="bg-info bg-opacity-10 p-3 rounded">
                                            <i class="fas fa-users text-info"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="text-muted">Karcis Tersedia</h6>
                                            <h3 id="availableTickets">0</h3>
                                            <span class="text-warning"><i class="fas fa-exclamation-circle me-1"></i> Low</span>
                                        </div>
                                        <div class="bg-warning bg-opacity-10 p-3 rounded">
                                            <i class="fas fa-ticket-alt text-warning"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Statistik Penjualan 7 Hari Terakhir</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="salesChart" height="250"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Produk Terlaris</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="topProductsChart" height="250"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Transaksi Terakhir</h5>
                                </div>
                                <div class="card-body p-0">
                                    <div class="table-responsive">
                                        <table class="table table-hover mb-0">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Tanggal</th>
                                                    <th>Jumlah</th>
                                                    <th>Total</th>
                                                </tr>
                                            </thead>
                                            <tbody id="recentTransactions">
                                                <!-- Transactions will be loaded here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Aktivitas Terkini</h5>
                                </div>
                                <div class="card-body p-0">
                                    <div class="list-group list-group-flush" id="recentActivities">
                                        <!-- Activities will be loaded here -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ticket Sales Section -->
                <div id="ticket-sales-section" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3>Penjualan Karcis</h3>
                        <div>
                            <button class="btn btn-primary me-2" onclick="printTicket()">
                                <i class="fas fa-print me-1"></i> Cetak
                            </button>
                            <button class="btn btn-success" onclick="completeTransaction()">
                                <i class="fas fa-check me-1"></i> Selesaikan Transaksi
                            </button>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-lg-8">
                            <div class="card">
                                <div class="card-header">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h5 class="card-title mb-0">Karcis Tersedia</h5>
                                        <div class="search-box">
                                            <i class="fas fa-search"></i>
                                            <input type="text" class="form-control form-control-sm" placeholder="Cari karcis..." id="ticketSearchSales" onkeyup="searchTicketsSales()">
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Kode</th>
                                                    <th>Destinasi</th>
                                                    <th>Jenis</th>
                                                    <th>Harga</th>
                                                    <th>Tanggal Berlaku</th>
                                                    <th>Aksi</th>
                                                </tr>
                                            </thead>
                                            <tbody id="availableTicketsTable">
                                                <!-- Available tickets will be loaded here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <div class="card mt-4">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Preview Karcis</h5>
                                </div>
                                <div class="card-body">
                                    <div class="ticket-preview text-center" id="ticketPreviewContent">
                                        <h4>Taman Wisata Alam</h4>
                                        <p>Jl. Raya Wisata No. 123, Kota Pariwisata</p>
                                        <hr>
                                        <div class="barcode-container">
                                            <svg id="barcode-preview"></svg>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <div class="text-start">
                                                <small class="text-muted">Kode Karcis</small>
                                                <p class="mb-0 fw-bold">TWA-001</p>
                                            </div>
                                            <div class="text-end">
                                                <small class="text-muted">Tanggal</small>
                                                <p class="mb-0 fw-bold">10 Jun 2023</p>
                                            </div>
                                        </div>
                                        <hr>
                                        <div class="d-flex justify-content-between">
                                            <div class="text-start">
                                                <small class="text-muted">Harga</small>
                                                <p class="mb-0 fw-bold">Rp50.000</p>
                                            </div>
                                            <div class="text-end">
                                                <small class="text-muted">Status</small>
                                                <p class="mb-0 fw-bold text-success">Valid</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Keranjang Belanja</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-sm">
                                            <thead>
                                                <tr>
                                                    <th>Karcis</th>
                                                    <th>Harga</th>
                                                    <th></th>
                                                </tr>
                                            </thead>
                                            <tbody id="cartItems">
                                                <!-- Cart items will be loaded here -->
                                            </tbody>
                                        </table>
                                    </div>
                                    <hr>
                                    <div class="d-flex justify-content-between mb-3 fw-bold">
                                        <span>Total:</span>
                                        <span id="total">Rp0</span>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Pembayaran</label>
                                        <select class="form-select" id="paymentMethod" onchange="updatePaymentMethod()">
                                            <option value="cash">Tunai</option>
                                            <option value="transfer">Transfer Bank</option>
                                            <option value="qris">QRIS</option>
                                            <option value="debit">Kartu Debit</option>
                                        </select>
                                    </div>
                                    <div class="mb-3" id="cashInputContainer">
                                        <label class="form-label">Uang Diterima</label>
                                        <input type="number" class="form-control" id="cashReceived" min="0" value="0" oninput="updateChangeAmount()">
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Kembalian</label>
                                        <input type="text" class="form-control" id="changeAmount" readonly value="Rp0">
                                    </div>
                                    <button class="btn btn-danger w-100 mb-2" onclick="clearCart()">
                                        <i class="fas fa-trash me-1"></i> Kosongkan Keranjang
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Generate Ticket Section -->
                <div id="generate-ticket-section" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3>Generate Karcis</h3>
                        <div>
                            <button class="btn btn-primary me-2" onclick="generateBarcode()">
                                <i class="fas fa-barcode me-1"></i> Generate Barcode
                            </button>
                            <button class="btn btn-success" onclick="printGeneratedTicket()">
                                <i class="fas fa-print me-1"></i> Cetak Karcis
                            </button>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Form Karcis</h5>
                                </div>
                                <div class="card-body">
                                    <form id="ticketForm">
                                        <div class="mb-3">
                                            <label class="form-label">Jenis Karcis</label>
                                            <select class="form-select" id="ticketType" required onchange="updateTicketCode()">
                                                <option value="">Pilih Jenis Karcis</option>
                                                <option value="regular">Reguler</option>
                                                <option value="vip">VIP</option>
                                                <option value="group">Grup</option>
                                                <option value="student">Pelajar/Mahasiswa</option>
                                                <option value="foreigner">Warga Asing</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Destinasi Wisata</label>
                                            <select class="form-select" id="destination" required onchange="updateDestinationDetails()">
                                                <option value="">Pilih Destinasi</option>
                                                <!-- Options will be loaded from products -->
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Harga</label>
                                            <input type="number" class="form-control" id="ticketPrice" required>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Jumlah Karcis</label>
                                            <input type="number" class="form-control" id="ticketQuantity" min="1" value="1" required>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Tanggal Berlaku</label>
                                            <input type="date" class="form-control" id="validDate" required>
                                        </div>
                                        <div class="mb-3 form-check">
                                            <input type="checkbox" class="form-check-input" id="includeTax">
                                            <label class="form-check-label" for="includeTax">Termasuk Pajak</label>
                                        </div>
                                        <button type="submit" class="btn btn-primary w-100" onclick="saveTicket(event)">
                                            <i class="fas fa-save me-1"></i> Simpan Karcis
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Preview Karcis</h5>
                                </div>
                                <div class="card-body">
                                    <div class="ticket-preview text-center" id="ticketPreview">
                                        <h4 id="previewDestination">Taman Wisata Alam</h4>
                                        <p id="previewAddress">Jl. Raya Wisata No. 123, Kota Pariwisata</p>
                                        <hr>
                                        <div class="barcode-container">
                                            <svg id="barcode"></svg>
                                        </div>
                                        <div class="d-flex justify-content-between">
                                            <div class="text-start">
                                                <small class="text-muted">Jenis</small>
                                                <p class="mb-0 fw-bold" id="previewType">Reguler</p>
                                            </div>
                                            <div class="text-end">
                                                <small class="text-muted">Kode</small>
                                                <p class="mb-0 fw-bold" id="previewCode">TWA-001</p>
                                            </div>
                                        </div>
                                        <hr>
                                        <div class="d-flex justify-content-between">
                                            <div class="text-start">
                                                <small class="text-muted">Tanggal</small>
                                                <p class="mb-0 fw-bold" id="previewDate">10 Jun 2023</p>
                                            </div>
                                            <div class="text-end">
                                                <small class="text-muted">Harga</small>
                                                <p class="mb-0 fw-bold" id="previewPrice">Rp50.000</p>
                                            </div>
                                        </div>
                                        <div class="mt-3">
                                            <small class="text-muted">Status</small>
                                            <p class="mb-0 fw-bold text-success" id="previewStatus">Belum Digunakan</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ticket List Section -->
                <div id="ticket-list-section" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3>Daftar Karcis</h3>
                        <div>
                            <button class="btn btn-primary me-2" onclick="exportTickets()">
                                <i class="fas fa-file-export me-1"></i> Export
                            </button>
                            <button class="btn btn-success" onclick="showImportModal()">
                                <i class="fas fa-file-import me-1"></i> Import
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="card-title mb-0">Daftar Karcis</h5>
                                <div class="d-flex">
                                    <div class="search-box me-2">
                                        <i class="fas fa-search"></i>
                                        <input type="text" class="form-control form-control-sm" placeholder="Cari karcis..." id="ticketSearch" onkeyup="searchTickets()">
                                    </div>
                                    <select class="form-select form-select-sm" style="width: 150px;" id="ticketFilter" onchange="filterTickets()">
                                        <option value="all">Semua Status</option>
                                        <option value="valid">Valid</option>
                                        <option value="used">Digunakan</option>
                                        <option value="expired">Kadaluarsa</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Kode</th>
                                            <th>Destinasi</th>
                                            <th>Jenis</th>
                                            <th>Harga</th>
                                            <th>Tanggal</th>
                                            <th>Status</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="ticketTableBody">
                                        <!-- Tickets will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                            <nav aria-label="Page navigation" class="mt-3">
                                <ul class="pagination justify-content-center">
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" tabindex="-1">Previous</a>
                                    </li>
                                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                                    <li class="page-item">
                                        <a class="page-link" href="#">Next</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>

                <!-- Reports Section -->
                <div id="reports-section" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3>Laporan</h3>
                        <div>
                            <button class="btn btn-primary me-2" onclick="generateDailyReport()">
                                <i class="fas fa-file-pdf me-1"></i> Cetak Laporan
                            </button>
                            <button class="btn btn-success" onclick="exportReportData()">
                                <i class="fas fa-file-excel me-1"></i> Export Data
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Filter Laporan</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label">Tanggal Mulai</label>
                                        <input type="date" class="form-control" id="reportStartDate">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label">Tanggal Akhir</label>
                                        <input type="date" class="form-control" id="reportEndDate">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label">Jenis Karcis</label>
                                        <select class="form-select" id="reportTicketType">
                                            <option value="all">Semua Jenis</option>
                                            <option value="regular">Reguler</option>
                                            <option value="vip">VIP</option>
                                            <option value="group">Grup</option>
                                            <option value="student">Pelajar/Mahasiswa</option>
                                            <option value="foreigner">Warga Asing</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label">Destinasi</label>
                                        <select class="form-select" id="reportDestination">
                                            <option value="all">Semua Destinasi</option>
                                            <!-- Options will be loaded from products -->
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-primary" onclick="loadReportData()">
                                <i class="fas fa-filter me-1"></i> Filter Data
                            </button>
                        </div>
                    </div>

                    <div class="card mt-4">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Statistik Penjualan</h5>
                        </div>
                        <div class="card-body">
                            <canvas id="reportChart" height="300"></canvas>
                        </div>
                    </div>

                    <div class="card mt-4">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Detail Transaksi</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID Transaksi</th>
                                            <th>Tanggal</th>
                                            <th>Karcis</th>
                                            <th>Jumlah</th>
                                            <th>Harga</th>
                                            <th>Total</th>
                                            <th>Kasir</th>
                                        </tr>
                                    </thead>
                                    <tbody id="reportTableBody">
                                        <!-- Report data will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                            <nav aria-label="Page navigation" class="mt-3">
                                <ul class="pagination justify-content-center">
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" tabindex="-1">Previous</a>
                                    </li>
                                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                                    <li class="page-item">
                                        <a class="page-link" href="#">Next</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>

                <!-- Products Section -->
                <div id="products-section" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3>Produk Wisata</h3>
                        <button class="btn btn-primary" onclick="showAddProductModal()">
                            <i class="fas fa-plus me-1"></i> Tambah Produk
                        </button>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="card-title mb-0">Daftar Produk Wisata</h5>
                                <div class="search-box">
                                    <i class="fas fa-search"></i>
                                    <input type="text" class="form-control form-control-sm" placeholder="Cari produk..." id="productSearch" onkeyup="searchProducts()">
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Kode</th>
                                            <th>Nama</th>
                                            <th>Lokasi</th>
                                            <th>Harga Reguler</th>
                                            <th>Status</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="productTableBody">
                                        <!-- Products will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                            <nav aria-label="Page navigation" class="mt-3">
                                <ul class="pagination justify-content-center">
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" tabindex="-1">Previous</a>
                                    </li>
                                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                                    <li class="page-item">
                                        <a class="page-link" href="#">Next</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>

                <!-- Users Section -->
                <div id="users-section" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3>Manajemen Pengguna</h3>
                        <button class="btn btn-primary" onclick="showAddUserModal()">
                            <i class="fas fa-plus me-1"></i> Tambah Pengguna
                        </button>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="card-title mb-0">Daftar Pengguna</h5>
                                <div class="search-box">
                                    <i class="fas fa-search"></i>
                                    <input type="text" class="form-control form-control-sm" placeholder="Cari pengguna..." id="userSearch" onkeyup="searchUsers()">
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Nama</th>
                                            <th>Username</th>
                                            <th>Role</th>
                                            <th>Status</th>
                                            <th>Terakhir Login</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="userTableBody">
                                        <!-- Users will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                            <nav aria-label="Page navigation" class="mt-3">
                                <ul class="pagination justify-content-center">
                                    <li class="page-item disabled">
                                        <a class="page-link" href="#" tabindex="-1">Previous</a>
                                    </li>
                                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                                    <li class="page-item">
                                        <a class="page-link" href="#">Next</a>
                                    </li>
                                </ul>
                            </nav>
                        </div>
                    </div>
                </div>

                <!-- Settings Section -->
                <div id="settings-section" style="display: none;">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h3>Pengaturan Sistem</h3>
                        <button class="btn btn-primary" onclick="saveSettings()">
                            <i class="fas fa-save me-1"></i> Simpan Pengaturan
                        </button>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Pengaturan Umum</h5>
                                </div>
                                <div class="card-body">
                                    <form id="generalSettingsForm">
                                        <div class="mb-3">
                                            <label class="form-label">Nama Aplikasi</label>
                                            <input type="text" class="form-control" id="appName" value="TourTick">
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Timezone</label>
                                            <select class="form-select" id="timezone">
                                                <option value="Asia/Jakarta">WIB (Asia/Jakarta)</option>
                                                <option value="Asia/Makassar">WITA (Asia/Makassar)</option>
                                                <option value="Asia/Jayapura">WIT (Asia/Jayapura)</option>
                                            </select>
                                        </div>
                                        <div class="mb-3 form-check">
                                            <input type="checkbox" class="form-check-input" id="enableTax">
                                            <label class="form-check-label" for="enableTax">Aktifkan Pajak</label>
                                        </div>
                                        <div class="mb-3" id="taxRateContainer" style="display: none;">
                                            <label class="form-label">Persentase Pajak (%)</label>
                                            <input type="number" class="form-control" id="taxRate" value="10" min="0" max="100">
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5 class="card-title mb-0">Pengaturan Cetak</h5>
                                </div>
                                <div class="card-body">
                                    <form id="printSettingsForm">
                                        <div class="mb-3">
                                            <label class="form-label">Header Struk</label>
                                            <textarea class="form-control" id="receiptHeader" rows="2">Terima kasih telah berkunjung</textarea>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Footer Struk</label>
                                            <textarea class="form-control" id="receiptFooter" rows="2">Barang yang sudah dibeli tidak dapat dikembalikan</textarea>
                                        </div>
                                        <div class="mb-3 form-check">
                                            <input type="checkbox" class="form-check-input" id="printLogo" checked>
                                            <label class="form-check-label" for="printLogo">Cetak Logo pada Struk</label>
                                        </div>
                                        <div class="mb-3 form-check">
                                            <input type="checkbox" class="form-check-input" id="printAddress" checked>
                                            <label class="form-check-label" for="printAddress">Cetak Alamat pada Struk</label>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card mt-4">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Preview Struk</h5>
                        </div>
                        <div class="card-body">
                            <div class="receipt" id="receiptPreview">
                                <div class="header">
                                    <img src="https://raw.githubusercontent.com/LKS-88/anekamarket/refs/heads/main/Logo-Anekamarketku.png" alt="TourTick Logo" style="max-width: 100px; margin-bottom: 10px;">
                                    <h5 id="previewReceiptTitle">TourTick</h5>
                                    <small id="previewReceiptAddress">Jl. Raya Wisata No. 123, Kota Pariwisata</small>
                                </div>
                                <div class="divider"></div>
                                <div class="item">
                                    <span>Karcis Reguler</span>
                                    <span>Rp50.000</span>
                                </div>
                                <div class="item">
                                    <span>Karcis Pelajar</span>
                                    <span>Rp30.000</span>
                                </div>
                                <div class="divider"></div>
                                <div class="item">
                                    <span>Subtotal</span>
                                    <span>Rp80.000</span>
                                </div>
                                <div class="item">
                                    <span>Pajak (10%)</span>
                                    <span>Rp8.000</span>
                                </div>
                                <div class="item fw-bold">
                                    <span>Total</span>
                                    <span>Rp88.000</span>
                                </div>
                                <div class="divider"></div>
                                <div class="receipt-barcode">
                                    <svg id="receiptBarcode"></svg>
                                </div>
                                <div class="footer">
                                    <p id="previewReceiptFooter">Terima kasih telah berkunjung</p>
                                    <small>12 Jun 2023 14:30:45</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Role Permissions Section -->
                    <div class="card mt-4">
                        <div class="card-header">
                            <h5 class="card-title mb-0">Pengaturan Hak Akses Role</h5>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <strong>Perhatian!</strong> Masukkan password admin untuk mengubah pengaturan hak akses.
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Password Admin</label>
                                <input type="password" class="form-control" id="adminPasswordForPermissions" placeholder="Masukkan password admin">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Pilih Role</label>
                                <select class="form-select" id="roleSelector" onchange="loadRolePermissions()">
                                    <option value="admin">Admin</option>
                                    <option value="manager">Manager</option>
                                    <option value="cashier">Kasir</option>
                                    <option value="operator">Operator</option>
                                </select>
                            </div>
                            <div id="permissionsContainer">
                                <div class="permission-group">
                                    <h6>Hak Akses Menu</h6>
                                    <div class="permission-item">
                                        <input type="checkbox" class="permission-checkbox" id="permDashboard" checked disabled>
                            // Generate barcode image
            const barcodeCanvas = document.createElement('canvas');
            JsBarcode(barcodeCanvas, transaction.transactionCode, {
                format: 'CODE128',
                lineColor: '#000',
                width: 1,
                height: 30,
                displayValue: false
            });
            
            // Add barcode to PDF
            y += 10;
            doc.addImage(barcodeCanvas, 'PNG', 25, y, 30, 15);
            y += 20;
            
            // Add footer
            doc.setFontSize(7);
            doc.text(document.getElementById('receiptFooter').value || 'Terima kasih telah berkunjung', 40, y, { align: 'center' });
            
            // Save or print the PDF
            doc.save(`receipt_${transaction.id}.pdf`);
        }

        // Print ticket
        function printTicket() {
            if (cart.length === 0) {
                alert('Tidak ada tiket yang dipilih untuk dicetak!');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: [80, 100] // Ticket size
            });

            // Set font
            doc.setFont('helvetica', 'normal');
            
            // Add logo
            try {
                const logoUrl = 'https://raw.githubusercontent.com/LKS-88/anekamarket/refs/heads/main/Logo-Anekamarketku.png';
                doc.addImage(logoUrl, 'PNG', 25, 5, 30, 10);
            } catch (e) {
                console.error('Error loading logo:', e);
            }
            
            // Add header
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            doc.text('TourTick - Tiket Wisata', 40, 20, { align: 'center' });
            
            // Add divider
            doc.setDrawColor(0, 0, 0);
            doc.line(5, 25, 75, 25);
            
            // Add ticket info
            const ticket = cart[0];
            const product = products.find(p => p.name === ticket.destination);
            
            doc.setFontSize(10);
            doc.text(ticket.destination, 40, 30, { align: 'center' });
            doc.setFontSize(8);
            doc.text(product?.location || '', 40, 35, { align: 'center' });
            
            // Add divider
            doc.line(5, 40, 75, 40);
            
            // Generate barcode image
            const barcodeCanvas = document.createElement('canvas');
            JsBarcode(barcodeCanvas, ticket.code, {
                format: 'CODE128',
                lineColor: '#000',
                width: 1,
                height: 30,
                displayValue: true
            });
            
            // Add barcode to PDF
            doc.addImage(barcodeCanvas, 'PNG', 20, 45, 40, 20);
            
            // Add ticket details
            doc.setFontSize(8);
            doc.text(`Jenis: ${ticket.type === 'regular' ? 'Reguler' : 
                                    ticket.type === 'vip' ? 'VIP' : 
                                    ticket.type === 'student' ? 'Pelajar' : 
                                    ticket.type === 'foreigner' ? 'WNA' : 'Grup'}`, 5, 70);
            doc.text(`Harga: Rp${ticket.price.toLocaleString()}`, 5, 75);
            doc.text(`Tanggal: ${new Date(ticket.validDate).toLocaleDateString('id-ID')}`, 5, 80);
            
            // Add footer
            doc.setFontSize(7);
            doc.text('Tiket ini hanya berlaku untuk 1 orang', 40, 90, { align: 'center' });
            
            // Save or print the PDF
            doc.save(`ticket_${ticket.code}.pdf`);
        }

        // Update ticket code based on selections
        function updateTicketCode() {
            const ticketType = document.getElementById('ticketType').value;
            const destination = document.getElementById('destination').value;
            
            if (!ticketType || !destination) return;
            
            const product = products.find(p => p.code === destination);
            if (!product) return;
            
            // Generate a random 3-digit number
            const randomNum = Math.floor(Math.random() * 900) + 100;
            const ticketCode = `${product.code}-${randomNum}`;
            
            // Update preview
            document.getElementById('previewCode').textContent = ticketCode;
            document.getElementById('previewType').textContent = 
                ticketType === 'regular' ? 'Reguler' : 
                ticketType === 'vip' ? 'VIP' : 
                ticketType === 'student' ? 'Pelajar/Mahasiswa' : 
                ticketType === 'foreigner' ? 'Warga Asing' : 'Grup';
            
            // Update barcode
            document.getElementById('barcode').innerHTML = '';
            JsBarcode('#barcode', ticketCode, {
                format: 'CODE128',
                lineColor: '#000',
                width: 2,
                height: 50,
                displayValue: true
            });
        }

        // Update destination details in preview
        function updateDestinationDetails() {
            const destination = document.getElementById('destination').value;
            const product = products.find(p => p.code === destination);
            
            if (product) {
                document.getElementById('previewDestination').textContent = product.name;
                document.getElementById('previewAddress').textContent = product.location;
                
                // Update price based on ticket type
                const ticketType = document.getElementById('ticketType').value;
                let price = 0;
                
                if (ticketType === 'regular') price = product.regularPrice;
                else if (ticketType === 'vip') price = product.vipPrice || product.regularPrice * 1.5;
                else if (ticketType === 'student') price = product.regularPrice * 0.6; // 40% discount
                else if (ticketType === 'foreigner') price = product.regularPrice * 2; // Double price
                else if (ticketType === 'group') price = product.regularPrice * 0.8; // 20% discount for groups
                
                document.getElementById('ticketPrice').value = price;
                document.getElementById('previewPrice').textContent = `Rp${price.toLocaleString()}`;
            }
        }

        // Generate barcode for new ticket
        function generateBarcode() {
            const ticketType = document.getElementById('ticketType').value;
            const destination = document.getElementById('destination').value;
            
            if (!ticketType || !destination) {
                alert('Silakan pilih jenis karcis dan destinasi terlebih dahulu!');
                return;
            }
            
            updateTicketCode();
        }

        // Save ticket to database
        function saveTicket(e) {
            e.preventDefault();
            
            if (!hasPermission(PERMISSIONS.FEATURE_CREATE_TICKET)) {
                alert('Anda tidak memiliki izin untuk membuat tiket baru!');
                return;
            }
            
            const ticketType = document.getElementById('ticketType').value;
            const destination = document.getElementById('destination').value;
            const price = parseFloat(document.getElementById('ticketPrice').value);
            const quantity = parseInt(document.getElementById('ticketQuantity').value);
            const validDate = document.getElementById('validDate').value;
            
            if (!ticketType || !destination || !price || !quantity || !validDate) {
                alert('Silakan lengkapi semua field!');
                return;
            }
            
            const product = products.find(p => p.code === destination);
            if (!product) {
                alert('Destinasi tidak valid!');
                return;
            }
            
            // Create multiple tickets if quantity > 1
            for (let i = 0; i < quantity; i++) {
                const randomNum = Math.floor(Math.random() * 900) + 100;
                const ticketCode = `${product.code}-${randomNum}`;
                
                const newTicket = {
                    code: ticketCode,
                    type: ticketType,
                    destination: product.name,
                    price: price,
                    validDate: validDate,
                    status: 'valid'
                };
                
                tickets.push(newTicket);
            }
            
            alert(`Berhasil membuat ${quantity} tiket baru!`);
            
            // Reset form
            document.getElementById('ticketForm').reset();
            document.getElementById('validDate').value = new Date().toISOString().split('T')[0];
            
            // Update preview
            updateTicketCode();
            
            // Refresh ticket list
            loadTicketList();
        }

        // Print generated ticket
        function printGeneratedTicket() {
            const ticketType = document.getElementById('ticketType').value;
            const destination = document.getElementById('destination').value;
            
            if (!ticketType || !destination) {
                alert('Silakan pilih jenis karcis dan destinasi terlebih dahulu!');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: [80, 100] // Ticket size
            });

            // Set font
            doc.setFont('helvetica', 'normal');
            
            // Add logo
            try {
                const logoUrl = 'https://raw.githubusercontent.com/LKS-88/anekamarket/refs/heads/main/Logo-Anekamarketku.png';
                doc.addImage(logoUrl, 'PNG', 25, 5, 30, 10);
            } catch (e) {
                console.error('Error loading logo:', e);
            }
            
            // Add header
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            doc.text('TourTick - Tiket Wisata', 40, 20, { align: 'center' });
            
            // Add divider
            doc.setDrawColor(0, 0, 0);
            doc.line(5, 25, 75, 25);
            
            // Add ticket info
            const product = products.find(p => p.code === destination);
            const ticketCode = document.getElementById('previewCode').textContent;
            
            doc.setFontSize(10);
            doc.text(product?.name || '', 40, 30, { align: 'center' });
            doc.setFontSize(8);
            doc.text(product?.location || '', 40, 35, { align: 'center' });
            
            // Add divider
            doc.line(5, 40, 75, 40);
            
            // Generate barcode image
            const barcodeCanvas = document.createElement('canvas');
            JsBarcode(barcodeCanvas, ticketCode, {
                format: 'CODE128',
                lineColor: '#000',
                width: 1,
                height: 30,
                displayValue: true
            });
            
            // Add barcode to PDF
            doc.addImage(barcodeCanvas, 'PNG', 20, 45, 40, 20);
            
            // Add ticket details
            doc.setFontSize(8);
            doc.text(`Jenis: ${ticketType === 'regular' ? 'Reguler' : 
                                    ticketType === 'vip' ? 'VIP' : 
                                    ticketType === 'student' ? 'Pelajar/Mahasiswa' : 
                                    ticketType === 'foreigner' ? 'Warga Asing' : 'Grup'}`, 5, 70);
            doc.text(`Harga: Rp${document.getElementById('ticketPrice').value.toLocaleString()}`, 5, 75);
            doc.text(`Tanggal: ${new Date(document.getElementById('validDate').value).toLocaleDateString('id-ID')}`, 5, 80);
            
            // Add footer
            doc.setFontSize(7);
            doc.text('Tiket ini hanya berlaku untuk 1 orang', 40, 90, { align: 'center' });
            
            // Save or print the PDF
            doc.save(`ticket_${ticketCode}.pdf`);
        }

        // Load ticket list
        function loadTicketList() {
            const ticketTableBody = document.getElementById('ticketTableBody');
            const filter = document.getElementById('ticketFilter').value;
            
            let filteredTickets = tickets;
            
            if (filter === 'valid') {
                filteredTickets = tickets.filter(t => t.status === 'valid');
            } else if (filter === 'used') {
                filteredTickets = tickets.filter(t => t.status === 'used');
            } else if (filter === 'expired') {
                filteredTickets = tickets.filter(t => t.status === 'expired');
            }
            
            ticketTableBody.innerHTML = filteredTickets.map(ticket => `
                <tr>
                    <td>${ticket.code}</td>
                    <td>${ticket.destination}</td>
                    <td>${ticket.type === 'regular' ? 'Reguler' : 
                         ticket.type === 'vip' ? 'VIP' : 
                         ticket.type === 'student' ? 'Pelajar' : 
                         ticket.type === 'foreigner' ? 'WNA' : 'Grup'}</td>
                    <td>Rp${ticket.price.toLocaleString()}</td>
                    <td>${new Date(ticket.validDate).toLocaleDateString('id-ID')}</td>
                    <td>
                        <span class="badge ${ticket.status === 'valid' ? 'badge-valid' : 
                                            ticket.status === 'used' ? 'badge-used' : 'badge-expired'}">
                            ${ticket.status === 'valid' ? 'Valid' : 
                             ticket.status === 'used' ? 'Digunakan' : 'Kadaluarsa'}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-primary me-1" onclick="viewTicket('${ticket.code}')">
                            <i class="fas fa-eye"></i>
                        </button>
                        ${hasPermission(PERMISSIONS.FEATURE_DELETE_TICKET) ? `
                        <button class="btn btn-sm btn-danger" onclick="deleteTicket('${ticket.code}')">
                            <i class="fas fa-trash"></i>
                        </button>
                        ` : ''}
                    </td>
                </tr>
            `).join('');
        }

        // View ticket details
        function viewTicket(ticketCode) {
            const ticket = tickets.find(t => t.code === ticketCode);
            if (!ticket) return;
            
            const product = products.find(p => p.name === ticket.destination);
            
            document.getElementById('viewTicketDestination').textContent = ticket.destination;
            document.getElementById('viewTicketAddress').textContent = product?.location || '';
            document.getElementById('viewTicketType').textContent = 
                ticket.type === 'regular' ? 'Reguler' : 
                ticket.type === 'vip' ? 'VIP' : 
                ticket.type === 'student' ? 'Pelajar/Mahasiswa' : 
                ticket.type === 'foreigner' ? 'Warga Asing' : 'Grup';
            document.getElementById('viewTicketCode').textContent = ticket.code;
            document.getElementById('viewTicketDate').textContent = new Date(ticket.validDate).toLocaleDateString('id-ID');
            document.getElementById('viewTicketPrice').textContent = `Rp${ticket.price.toLocaleString()}`;
            document.getElementById('viewTicketStatus').textContent = 
                ticket.status === 'valid' ? 'Valid' : 
                ticket.status === 'used' ? 'Digunakan' : 'Kadaluarsa';
            document.getElementById('viewTicketStatus').className = 
                ticket.status === 'valid' ? 'mb-0 fw-bold text-success' : 
                ticket.status === 'used' ? 'mb-0 fw-bold text-info' : 'mb-0 fw-bold text-danger';
            
            // Update barcode
            document.getElementById('viewTicketBarcode').innerHTML = '';
            JsBarcode('#viewTicketBarcode', ticket.code, {
                format: 'CODE128',
                lineColor: '#000',
                width: 2,
                height: 50,
                displayValue: true
            });
            
            // Show modal
            const viewTicketModal = new bootstrap.Modal(document.getElementById('viewTicketModal'));
            viewTicketModal.show();
        }

        // Delete ticket
        function deleteTicket(ticketCode) {
            if (!hasPermission(PERMISSIONS.FEATURE_DELETE_TICKET)) {
                alert('Anda tidak memiliki izin untuk menghapus tiket!');
                return;
            }
            
            if (confirm('Apakah Anda yakin ingin menghapus tiket ini?')) {
                tickets = tickets.filter(t => t.code !== ticketCode);
                loadTicketList();
                alert('Tiket berhasil dihapus!');
            }
        }

        // Search tickets
        function searchTickets() {
            const searchTerm = document.getElementById('ticketSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#ticketTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // Filter tickets
        function filterTickets() {
            loadTicketList();
        }

        // Export tickets to Excel
        function exportTickets() {
            if (!hasPermission(PERMISSIONS.FEATURE_EXPORT_TICKET)) {
                alert('Anda tidak memiliki izin untuk mengekspor data tiket!');
                return;
            }
            
            const filter = document.getElementById('ticketFilter').value;
            let filteredTickets = tickets;
            
            if (filter === 'valid') {
                filteredTickets = tickets.filter(t => t.status === 'valid');
            } else if (filter === 'used') {
                filteredTickets = tickets.filter(t => t.status === 'used');
            } else if (filter === 'expired') {
                filteredTickets = tickets.filter(t => t.status === 'expired');
            }
            
            // Prepare data for export
            const exportData = filteredTickets.map(ticket => ({
                'Kode Tiket': ticket.code,
                'Destinasi': ticket.destination,
                'Jenis Tiket': ticket.type === 'regular' ? 'Reguler' : 
                              ticket.type === 'vip' ? 'VIP' : 
                              ticket.type === 'student' ? 'Pelajar' : 
                              ticket.type === 'foreigner' ? 'WNA' : 'Grup',
                'Harga': ticket.price,
                'Tanggal Berlaku': ticket.validDate,
                'Status': ticket.status === 'valid' ? 'Valid' : 
                          ticket.status === 'used' ? 'Digunakan' : 'Kadaluarsa'
            }));
            
            // Create worksheet
            const ws = XLSX.utils.json_to_sheet(exportData);
            
            // Create workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Daftar Tiket');
            
            // Export to file
            XLSX.writeFile(wb, `daftar_tiket_${new Date().toISOString().split('T')[0]}.xlsx`);
        }

        // Show import modal
        function showImportModal() {
            if (!hasPermission(PERMISSIONS.FEATURE_IMPORT_TICKET)) {
                alert('Anda tidak memiliki izin untuk mengimpor data tiket!');
                return;
            }
            
            const importModal = new bootstrap.Modal(document.getElementById('importTicketsModal'));
            importModal.show();
        }

        // Download import template
        function downloadImportTemplate() {
            const templateData = [{
                'Kode Tiket': 'TWA-001',
                'Destinasi': 'Taman Wisata Alam',
                'Jenis Tiket': 'regular',
                'Harga': 50000,
                'Tanggal Berlaku': '2023-06-15',
                'Status': 'valid'
            }];
            
            // Create worksheet
            const ws = XLSX.utils.json_to_sheet(templateData);
            
            // Create workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Template');
            
            // Export to file
            XLSX.writeFile(wb, 'template_import_tiket.xlsx');
        }

        // Import tickets from Excel
        function importTickets() {
            const fileInput = document.getElementById('ticketImportFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('Silakan pilih file terlebih dahulu!');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // Get first sheet
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    if (jsonData.length === 0) {
                        alert('File tidak berisi data!');
                        return;
                    }
                    
                    // Validate and import tickets
                    let importedCount = 0;
                    let skippedCount = 0;
                    
                    jsonData.forEach(row => {
                        // Validate required fields
                        if (!row['Kode Tiket'] || !row['Destinasi'] || !row['Jenis Tiket'] || 
                            !row['Harga'] || !row['Tanggal Berlaku'] || !row['Status']) {
                            skippedCount++;
                            return;
                        }
                        
                        // Check if ticket already exists
                        if (tickets.some(t => t.code === row['Kode Tiket'])) {
                            skippedCount++;
                            return;
                        }
                        
                        // Add new ticket
                        tickets.push({
                            code: row['Kode Tiket'],
                            destination: row['Destinasi'],
                            type: row['Jenis Tiket'],
                            price: row['Harga'],
                            validDate: row['Tanggal Berlaku'],
                            status: row['Status']
                        });
                        
                        importedCount++;
                    });
                    
                    alert(`Berhasil mengimpor ${importedCount} tiket. ${skippedCount} tiket dilewati karena data tidak valid atau duplikat.`);
                    
                    // Close modal and refresh list
                    bootstrap.Modal.getInstance(document.getElementById('importTicketsModal')).hide();
                    loadTicketList();
                    
                } catch (error) {
                    console.error('Error importing tickets:', error);
                    alert('Terjadi kesalahan saat mengimpor data. Pastikan format file benar.');
                }
            };
            
            reader.readAsArrayBuffer(file);
        }

        // Print single ticket
        function printSingleTicket() {
            const ticketCode = document.getElementById('viewTicketCode').textContent;
            const ticket = tickets.find(t => t.code === ticketCode);
            
            if (!ticket) return;
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: [80, 100] // Ticket size
            });

            // Set font
            doc.setFont('helvetica', 'normal');
            
            // Add logo
            try {
                const logoUrl = 'https://raw.githubusercontent.com/LKS-88/anekamarket/refs/heads/main/Logo-Anekamarketku.png';
                doc.addImage(logoUrl, 'PNG', 25, 5, 30, 10);
            } catch (e) {
                console.error('Error loading logo:', e);
            }
            
            // Add header
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            doc.text('TourTick - Tiket Wisata', 40, 20, { align: 'center' });
            
            // Add divider
            doc.setDrawColor(0, 0, 0);
            doc.line(5, 25, 75, 25);
            
            // Add ticket info
            const product = products.find(p => p.name === ticket.destination);
            
            doc.setFontSize(10);
            doc.text(ticket.destination, 40, 30, { align: 'center' });
            doc.setFontSize(8);
            doc.text(product?.location || '', 40, 35, { align: 'center' });
            
            // Add divider
            doc.line(5, 40, 75, 40);
            
            // Generate barcode image
            const barcodeCanvas = document.createElement('canvas');
            JsBarcode(barcodeCanvas, ticket.code, {
                format: 'CODE128',
                lineColor: '#000',
                width: 1,
                height: 30,
                displayValue: true
            });
            
            // Add barcode to PDF
            doc.addImage(barcodeCanvas, 'PNG', 20, 45, 40, 20);
            
            // Add ticket details
            doc.setFontSize(8);
            doc.text(`Jenis: ${ticket.type === 'regular' ? 'Reguler' : 
                                    ticket.type === 'vip' ? 'VIP' : 
                                    ticket.type === 'student' ? 'Pelajar/Mahasiswa' : 
                                    ticket.type === 'foreigner' ? 'Warga Asing' : 'Grup'}`, 5, 70);
            doc.text(`Harga: Rp${ticket.price.toLocaleString()}`, 5, 75);
            doc.text(`Tanggal: ${new Date(ticket.validDate).toLocaleDateString('id-ID')}`, 5, 80);
            
            // Add footer
            doc.setFontSize(7);
            doc.text('Tiket ini hanya berlaku untuk 1 orang', 40, 90, { align: 'center' });
            
            // Save or print the PDF
            doc.save(`ticket_${ticket.code}.pdf`);
            
            // Close modal
            bootstrap.Modal.getInstance(document.getElementById('viewTicketModal')).hide();
        }

        // Load report data
        function loadReportData() {
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            const ticketType = document.getElementById('reportTicketType').value;
            const destination = document.getElementById('reportDestination').value;
            
            // Filter transactions
            let filteredTransactions = transactions.filter(trx => {
                const trxDate = trx.date.split(' ')[0];
                return trxDate >= startDate && trxDate <= endDate;
            });
            
            // Filter by ticket type if specified
            if (ticketType !== 'all') {
                filteredTransactions = filteredTransactions.filter(trx => {
                    return trx.items.some(item => {
                        const ticket = tickets.find(t => t.code === item.ticket);
                        return ticket && ticket.type === ticketType;
                    });
                });
            }
            
            // Filter by destination if specified
            if (destination !== 'all') {
                filteredTransactions = filteredTransactions.filter(trx => {
                    return trx.items.some(item => {
                        const ticket = tickets.find(t => t.code === item.ticket);
                        const product = products.find(p => p.name === ticket?.destination);
                        return product && product.code === destination;
                    });
                });
            }
            
            // Update report table
            const reportTableBody = document.getElementById('reportTableBody');
            reportTableBody.innerHTML = filteredTransactions.map(trx => `
                <tr>
                    <td>${trx.id}</td>
                    <td>${trx.date}</td>
                    <td>${trx.items.map(item => {
                        const ticket = tickets.find(t => t.code === item.ticket);
                        return ticket ? `${ticket.destination} (${ticket.type})` : 'Unknown';
                    }).join(', ')}</td>
                    <td>${trx.items.length}</td>
                    <td>Rp${trx.items.reduce((sum, item) => sum + item.price, 0).toLocaleString()}</td>
                    <td>Rp${trx.total.toLocaleString()}</td>
                    <td>${trx.cashier}</td>
                </tr>
            `).join('');
            
            // Initialize report chart
            initReportChart(filteredTransactions);
        }

        // Initialize report chart
        function initReportChart(transactions) {
            const reportCtx = document.getElementById('reportChart').getContext('2d');
            
            // Group transactions by date
            const transactionsByDate = {};
            transactions.forEach(trx => {
                const date = trx.date.split(' ')[0];
                if (!transactionsByDate[date]) {
                    transactionsByDate[date] = {
                        count: 0,
                        revenue: 0
                    };
                }
                transactionsByDate[date].count += trx.items.length;
                transactionsByDate[date].revenue += trx.total;
            });
            
            const dates = Object.keys(transactionsByDate).sort();
            const counts = dates.map(date => transactionsByDate[date].count);
            const revenues = dates.map(date => transactionsByDate[date].revenue);
            
            // Destroy previous chart if exists
            if (window.reportChart) {
                window.reportChart.destroy();
            }
            
            // Create new chart
            window.reportChart = new Chart(reportCtx, {
                type: 'bar',
                data: {
                    labels: dates,
                    datasets: [
                        {
                            label: 'Jumlah Tiket',
                            data: counts,
                            backgroundColor: 'rgba(52, 152, 219, 0.7)',
                            yAxisID: 'y'
                        },
                        {
                            label: 'Pendapatan (Rp)',
                            data: revenues,
                            backgroundColor: 'rgba(46, 204, 113, 0.7)',
                            type: 'line',
                            yAxisID: 'y1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Jumlah Tiket'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Pendapatan (Rp)'
                            },
                            grid: {
                                drawOnChartArea: false
                            }
                        }
                    }
                }
            });
        }

        // Generate daily report PDF
        function generateDailyReport() {
            if (!hasPermission(PERMISSIONS.FEATURE_EXPORT_TICKET)) {
                alert('Anda tidak memiliki izin untuk membuat laporan!');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Set font
            doc.setFont('helvetica', 'normal');
            
            // Add logo
            try {
                const logoUrl = 'https://raw.githubusercontent.com/LKS-88/anekamarket/refs/heads/main/Logo-Anekamarketku.png';
                doc.addImage(logoUrl, 'PNG', 10, 10, 30, 10);
            } catch (e) {
                console.error('Error loading logo:', e);
            }
            
            // Add title
            doc.setFontSize(16);
            doc.setTextColor(0, 0, 0);
            doc.text('Laporan Harian TourTick', 105, 20, { align: 'center' });
            
            // Add date range
            doc.setFontSize(12);
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            doc.text(`Periode: ${startDate} hingga ${endDate}`, 105, 30, { align: 'center' });
            
            // Add generated date
            const now = new Date();
            doc.text(`Dibuat pada: ${now.toLocaleDateString('id-ID')} ${now.toLocaleTimeString('id-ID')}`, 105, 35, { align: 'center' });
            
            // Add divider
            doc.setDrawColor(0, 0, 0);
            doc.line(10, 40, 200, 40);
            
            // Add summary
            doc.setFontSize(14);
            doc.text('Ringkasan', 10, 50);
            
            // Get filtered transactions
            const startDateFilter = document.getElementById('reportStartDate').value;
            const endDateFilter = document.getElementById('reportEndDate').value;
            const ticketTypeFilter = document.getElementById('reportTicketType').value;
            const destinationFilter = document.getElementById('reportDestination').value;
            
            let filteredTransactions = transactions.filter(trx => {
                const trxDate = trx.date.split(' ')[0];
                return trxDate >= startDateFilter && trxDate <= endDateFilter;
            });
            
            if (ticketTypeFilter !== 'all') {
                filteredTransactions = filteredTransactions.filter(trx => {
                    return trx.items.some(item => {
                        const ticket = tickets.find(t => t.code === item.ticket);
                        return ticket && ticket.type === ticketTypeFilter;
                    });
                });
            }
            
            if (destinationFilter !== 'all') {
                filteredTransactions = filteredTransactions.filter(trx => {
                    return trx.items.some(item => {
                        const ticket = tickets.find(t => t.code === item.ticket);
                        const product = products.find(p => p.name === ticket?.destination);
                        return product && product.code === destinationFilter;
                    });
                });
            }
            
            // Calculate summary
            const totalTransactions = filteredTransactions.length;
            const totalTickets = filteredTransactions.reduce((sum, trx) => sum + trx.items.length, 0);
            const totalRevenue = filteredTransactions.reduce((sum, trx) => sum + trx.total, 0);
            
            doc.setFontSize(10);
            doc.text(`Total Transaksi: ${totalTransactions}`, 10, 60);
            doc.text(`Total Tiket Terjual: ${totalTickets}`, 10, 65);
            doc.text(`Total Pendapatan: Rp${totalRevenue.toLocaleString()}`, 10, 70);
            
            // Add transaction details
            doc.setFontSize(14);
            doc.text('Detail Transaksi', 10, 80);
            
            // Create table
            const headers = ['ID', 'Tanggal', 'Tiket', 'Jumlah', 'Total', 'Kasir'];
            const data = filteredTransactions.map(trx => [
                trx.id,
                trx.date,
                trx.items.map(item => {
                    const ticket = tickets.find(t => t.code === item.ticket);
                    return ticket ? `${ticket.destination} (${ticket.type})` : 'Unknown';
                }).join(', '),
                trx.items.length,
                `Rp${trx.total.toLocaleString()}`,
                trx.cashier
            ]);
            
            // Add table
            doc.autoTable({
                startY: 85,
                head: [headers],
                body: data,
                margin: { left: 10 },
                styles: { fontSize: 8 },
                headStyles: { fillColor: [52, 152, 219] }
            });
            
            // Add footer
            doc.setFontSize(8);
            doc.text('Dibuat oleh TourTick - Sistem Karcis Pariwisata', 105, doc.internal.pageSize.height - 10, { align: 'center' });
            
            // Save PDF
            doc.save(`laporan_tourtick_${startDate}_${endDate}.pdf`);
        }

        // Export report data to Excel
        function exportReportData() {
            if (!hasPermission(PERMISSIONS.FEATURE_EXPORT_TICKET)) {
                alert('Anda tidak memiliki izin untuk mengekspor data laporan!');
                return;
            }
            
            const startDate = document.getElementById('reportStartDate').value;
            const endDate = document.getElementById('reportEndDate').value;
            const ticketType = document.getElementById('reportTicketType').value;
            const destination = document.getElementById('reportDestination').value;
            
            // Filter transactions
            let filteredTransactions = transactions.filter(trx => {
                const trxDate = trx.date.split(' ')[0];
                return trxDate >= startDate && trxDate <= endDate;
            });
            
            if (ticketType !== 'all') {
                filteredTransactions = filteredTransactions.filter(trx => {
                    return trx.items.some(item => {
                        const ticket = tickets.find(t => t.code === item.ticket);
                        return ticket && ticket.type === ticketType;
                    });
                });
            }
            
            if (destination !== 'all') {
                filteredTransactions = filteredTransactions.filter(trx => {
                    return trx.items.some(item => {
                        const ticket = tickets.find(t => t.code === item.ticket);
                        const product = products.find(p => p.name === ticket?.destination);
                        return product && product.code === destination;
                    });
                });
            }
            
            // Prepare data for export
            const exportData = filteredTransactions.map(trx => ({
                'ID Transaksi': trx.id,
                'Tanggal': trx.date,
                'Tiket': trx.items.map(item => {
                    const ticket = tickets.find(t => t.code === item.ticket);
                    return ticket ? `${ticket.destination} (${ticket.type})` : 'Unknown';
                }).join(', '),
                'Jumlah Tiket': trx.items.length,
                'Total': trx.total,
                'Kasir': trx.cashier
            }));
            
            // Create worksheet
            const ws = XLSX.utils.json_to_sheet(exportData);
            
            // Create workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Laporan Transaksi');
            
            // Export to file
            XLSX.writeFile(wb, `laporan_transaksi_${startDate}_${endDate}.xlsx`);
        }

        // Load products
        function loadProducts() {
            const productTableBody = document.getElementById('productTableBody');
            
            productTableBody.innerHTML = products.map(product => `
                <tr>
                    <td>${product.code}</td>
                    <td>${product.name}</td>
                    <td>${product.location}</td>
                    <td>Rp${product.regularPrice.toLocaleString()}</td>
                    <td>
                        <span class="badge ${product.status === 'active' ? 'badge-valid' : 'badge-expired'}">
                            ${product.status === 'active' ? 'Aktif' : 'Nonaktif'}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-primary me-1" onclick="editProduct('${product.code}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        ${hasPermission(PERMISSIONS.FEATURE_DELETE_PRODUCT) ? `
                        <button class="btn btn-sm btn-danger" onclick="deleteProduct('${product.code}')">
                            <i class="fas fa-trash"></i>
                        </button>
                        ` : ''}
                    </td>
                </tr>
            `).join('');
        }

        // Show add product modal
        function showAddProductModal() {
            if (!hasPermission(PERMISSIONS.FEATURE_CREATE_PRODUCT)) {
                alert('Anda tidak memiliki izin untuk menambahkan produk!');
                return;
            }
            
            document.getElementById('addProductForm').reset();
            const addProductModal = new bootstrap.Modal(document.getElementById('addProductModal'));
            addProductModal.show();
        }

        // Edit product
        function editProduct(productCode) {
            if (!hasPermission(PERMISSIONS.FEATURE_EDIT_PRODUCT)) {
                alert('Anda tidak memiliki izin untuk mengedit produk!');
                return;
            }
            
            const product = products.find(p => p.code === productCode);
            if (!product) return;
            
            document.getElementById('productCode').value = product.code;
            document.getElementById('productName').value = product.name;
            document.getElementById('productLocation').value = product.location;
            document.getElementById('productDescription').value = product.description || '';
            document.getElementById('productRegularPrice').value = product.regularPrice;
            document.getElementById('productVipPrice').value = product.vipPrice || '';
            document.getElementById('productStatus').checked = product.status === 'active';
            
            const addProductModal = new bootstrap.Modal(document.getElementById('addProductModal'));
            addProductModal.show();
        }

        // Save product
        function saveProduct() {
            const code = document.getElementById('productCode').value;
            const name = document.getElementById('productName').value;
            const location = document.getElementById('productLocation').value;
            const description = document.getElementById('productDescription').value;
            const regularPrice = parseFloat(document.getElementById('productRegularPrice').value);
            const vipPrice = parseFloat(document.getElementById('productVipPrice').value) || null;
            const status = document.getElementById('productStatus').checked ? 'active' : 'inactive';
            
            if (!code || !name || !location || !regularPrice) {
                alert('Silakan lengkapi semua field yang wajib diisi!');
                return;
            }
            
            // Check if product exists (edit mode)
            const existingIndex = products.findIndex(p => p.code === code);
            
            if (existingIndex >= 0) {
                if (!hasPermission(PERMISSIONS.FEATURE_EDIT_PRODUCT)) {
                    alert('Anda tidak memiliki izin untuk mengedit produk!');
                    return;
                }
                
                // Update existing product
                products[existingIndex] = {
                    ...products[existingIndex],
                    name: name,
                    location: location,
                    description: description,
                    regularPrice: regularPrice,
                    vipPrice: vipPrice,
                    status: status
                };
                
                alert('Produk berhasil diperbarui!');
            } else {
                if (!hasPermission(PERMISSIONS.FEATURE_CREATE_PRODUCT)) {
                    alert('Anda tidak memiliki izin untuk menambahkan produk!');
                    return;
                }
                
                // Add new product
                products.push({
                    code: code,
                    name: name,
                    location: location,
                    description: description,
                    regularPrice: regularPrice,
                    vipPrice: vipPrice,
                    status: status
                });
                
                alert('Produk berhasil ditambahkan!');
            }
            
            // Close modal and refresh list
            bootstrap.Modal.getInstance(document.getElementById('addProductModal')).hide();
            loadProducts();
            populateDestinationDropdowns();
        }

        // Delete product
        function deleteProduct(productCode) {
            if (!hasPermission(PERMISSIONS.FEATURE_DELETE_PRODUCT)) {
                alert('Anda tidak memiliki izin untuk menghapus produk!');
                return;
            }
            
            if (confirm('Apakah Anda yakin ingin menghapus produk ini? Aksi ini tidak dapat dibatalkan!')) {
                products = products.filter(p => p.code !== productCode);
                loadProducts();
                populateDestinationDropdowns();
                alert('Produk berhasil dihapus!');
            }
        }

        // Search products
        function searchProducts() {
            const searchTerm = document.getElementById('productSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#productTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // Load users
        function loadUsers() {
            const userTableBody = document.getElementById('userTableBody');
            
            userTableBody.innerHTML = users.map(user => `
                <tr>
                    <td>${user.fullName}</td>
                    <td>${user.username}</td>
                    <td>
                        ${user.role === 'admin' ? 'Admin' : 
                         user.role === 'cashier' ? 'Kasir' : 
                         user.role === 'manager' ? 'Manager' : 'Operator'}
                    </td>
                    <td>
                        <span class="badge ${user.status === 'active' ? 'badge-valid' : 'badge-expired'}">
                            ${user.status === 'active' ? 'Aktif' : 'Nonaktif'}
                        </span>
                    </td>
                    <td>${user.lastLogin || 'Belum pernah login'}</td>
                    <td>
                        <button class="btn btn-sm btn-primary me-1" onclick="editUser('${user.username}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        ${hasPermission(PERMISSIONS.FEATURE_DELETE_USER) && currentUser.username !== user.username ? `
                        <button class="btn btn-sm btn-danger" onclick="deleteUser('${user.username}')">
                            <i class="fas fa-trash"></i>
                        </button>
                        ` : ''}
                    </td>
                </tr>
            `).join('');
        }

        // Show add user modal
        function showAddUserModal() {
            if (!hasPermission(PERMISSIONS.FEATURE_CREATE_USER)) {
                alert('Anda tidak memiliki izin untuk menambahkan pengguna!');
                return;
            }
            
            document.getElementById('addUserForm').reset();
            const addUserModal = new bootstrap.Modal(document.getElementById('addUserModal'));
            addUserModal.show();
        }

        // Edit user
        function editUser(username) {
            if (!hasPermission(PERMISSIONS.FEATURE_EDIT_USER)) {
                alert('Anda tidak memiliki izin untuk mengedit pengguna!');
                return;
            }
            
            const user = users.find(u => u.username === username);
            if (!user) return;
            
            document.getElementById('userFullName').value = user.fullName;
            document.getElementById('userUsername').value = user.username;
            document.getElementById('userUsername').readOnly = true;
            document.getElementById('userPassword').value = '';
            document.getElementById('userPassword').required = false;
            document.getElementById('userRole').value = user.role;
            document.getElementById('userStatus').checked = user.status === 'active';
            
            const addUserModal = new bootstrap.Modal(document.getElementById('addUserModal'));
            addUserModal.show();
        }

        // Save user
        function saveUser() {
            const fullName = document.getElementById('userFullName').value;
            const username = document.getElementById('userUsername').value;
            const password = document.getElementById('userPassword').value;
            const role = document.getElementById('userRole').value;
            const status = document.getElementById('userStatus').checked ? 'active' : 'inactive';
            
            if (!fullName || !username || !role) {
                alert('Silakan lengkapi semua field yang wajib diisi!');
                return;
            }
            
            // Check if user exists (edit mode)
            const existingIndex = users.findIndex(u => u.username === username);
            
            if (existingIndex >= 0) {
                if (!hasPermission(PERMISSIONS.FEATURE_EDIT_USER)) {
                    alert('Anda tidak memiliki izin untuk mengedit pengguna!');
                    return;
                }
                
                // Update existing user
                const updatedUser = {
                    ...users[existingIndex],
                    fullName: fullName,
                    role: role,
                    status: status
                };
                
                // Update password if provided
                if (password) {
                    updatedUser.password = CryptoJS.SHA256(password).toString();
                }
                
                users[existingIndex] = updatedUser;
                
                // If editing current user, update sidebar
                if (currentUser.username === username) {
                    currentUser = updatedUser;
                    document.getElementById('userName').textContent = updatedUser.fullName;
                    document.getElementById('userRole').textContent = 
                        updatedUser.role === 'admin' ? 'Super User' : 
                        updatedUser.role === 'cashier' ? 'Kasir' : 
                        updatedUser.role === 'manager' ? 'Manager' : 'Operator';
                    
                    // Update menu items based on new permissions
                    updateMenuItems();
                }
                
                alert('Pengguna berhasil diperbarui!');
            } else {
                if (!hasPermission(PERMISSIONS.FEATURE_CREATE_USER)) {
                    alert('Anda tidak memiliki izin untuk menambahkan pengguna!');
                    return;
                }
                
                if (!password) {
                    alert('Silakan masukkan password untuk pengguna baru!');
                    return;
                }
                
                // Add new user
                users.push({
                    fullName: fullName,
                    username: username,
                    password: CryptoJS.SHA256(password).toString(),
                    role: role,
                    status: status,
                    lastLogin: null,
                    permissions: DEFAULT_ROLE_PERMISSIONS[role] || DEFAULT_ROLE_PERMISSIONS.cashier
                });
                
                alert('Pengguna berhasil ditambahkan!');
            }
            
            // Close modal and refresh list
            bootstrap.Modal.getInstance(document.getElementById('addUserModal')).hide();
            loadUsers();
        }

        // Delete user
        function deleteUser(username) {
            if (!hasPermission(PERMISSIONS.FEATURE_DELETE_USER)) {
                alert('Anda tidak memiliki izin untuk menghapus pengguna!');
                return;
            }
            
            if (currentUser.username === username) {
                alert('Anda tidak dapat menghapus akun sendiri!');
                return;
            }
            
            if (confirm('Apakah Anda yakin ingin menghapus pengguna ini? Aksi ini tidak dapat dibatalkan!')) {
                users = users.filter(u => u.username !== username);
                loadUsers();
                alert('Pengguna berhasil dihapus!');
            }
        }

        // Search users
        function searchUsers() {
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#userTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        // Save settings
        function saveSettings() {
            if (!hasPermission(PERMISSIONS.FEATURE_UPDATE_SETTINGS)) {
                alert('Anda tidak memiliki izin untuk menyimpan pengaturan!');
                return;
            }
            
            // In a real app, this would save to database
            alert('Pengaturan berhasil disimpan!');
        }

        // Load role permissions
        function loadRolePermissions() {
            const role = document.getElementById('roleSelector').value;
            const rolePermissions = DEFAULT_ROLE_PERMISSIONS[role] || {};
            
            // Set checkbox states based on permissions
            document.getElementById('permTicketSales').checked = rolePermissions[PERMISSIONS.MENU_TICKET_SALES] || false;
            document.getElementById('permGenerateTicket').checked = rolePermissions[PERMISSIONS.MENU_GENERATE_TICKET] || false;
            document.getElementById('permTicketList').checked = rolePermissions[PERMISSIONS.MENU_TICKET_LIST] || false;
            document.getElementById('permReports').checked = rolePermissions[PERMISSIONS.MENU_REPORTS] || false;
            document.getElementById('permProducts').checked = rolePermissions[PERMISSIONS.MENU_PRODUCTS] || false;
            document.getElementById('permUsers').checked = rolePermissions[PERMISSIONS.MENU_USERS] || false;
            document.getElementById('permSettings').checked = rolePermissions[PERMISSIONS.MENU_SETTINGS] || false;
            document.getElementById('permBackup').checked = rolePermissions[PERMISSIONS.MENU_BACKUP] || false;
            
            document.getElementById('permRestore').checked = rolePermissions[PERMISSIONS.FEATURE_RESTORE] || false;
            document.getElementById('permReset').checked = rolePermissions[PERMISSIONS.FEATURE_RESET] || false;
            document.getElementById('permDeleteTicket').checked = rolePermissions[PERMISSIONS.FEATURE_DELETE_TICKET] || false;
            document.getElementById('permDeleteProduct').checked = rolePermissions[PERMISSIONS.FEATURE_DELETE_PRODUCT] || false;
            document.getElementById('permDeleteUser').checked = rolePermissions[PERMISSIONS.FEATURE_DELETE_USER] || false;
        }

        // Save role permissions
        function saveRolePermissions() {
            if (!hasPermission(PERMISSIONS.FEATURE_MANAGE_PERMISSIONS)) {
                alert('Anda tidak memiliki izin untuk mengubah hak akses!');
                return;
            }
            
            const adminPassword = document.getElementById('adminPasswordForPermissions').value;
            if (!adminPassword || CryptoJS.SHA256(adminPassword).toString() !== users.find(u => u.role === 'admin')?.password) {
                alert('Password admin salah!');
                return;
            }
            
            const role = document.getElementById('roleSelector').value;
            
            // Update permissions for this role
            DEFAULT_ROLE_PERMISSIONS[role] = {
                // Menu permissions
                [PERMISSIONS.MENU_DASHBOARD]: true, // Always enabled
                [PERMISSIONS.MENU_TICKET_SALES]: document.getElementById('permTicketSales').checked,
                [PERMISSIONS.MENU_GENERATE_TICKET]: document.getElementById('permGenerateTicket').checked,
                [PERMISSIONS.MENU_TICKET_LIST]: document.getElementById('permTicketList').checked,
                [PERMISSIONS.MENU_REPORTS]: document.getElementById('permReports').checked,
                [PERMISSIONS.MENU_PRODUCTS]: document.getElementById('permProducts').checked,
                [PERMISSIONS.MENU_USERS]: document.getElementById('permUsers').checked,
                [PERMISSIONS.MENU_SETTINGS]: document.getElementById('permSettings').checked,
                [PERMISSIONS.MENU_BACKUP]: document.getElementById('permBackup').checked,
                
                // Feature permissions
                [PERMISSIONS.FEATURE_CREATE_TICKET]: document.getElementById('permGenerateTicket').checked,
                [PERMISSIONS.FEATURE_DELETE_TICKET]: document.getElementById('permDeleteTicket').checked,
                [PERMISSIONS.FEATURE_IMPORT_TICKET]: document.getElementById('permTicketList').checked,
                [PERMISSIONS.FEATURE_EXPORT_TICKET]: document.getElementById('permTicketList').checked,
                [PERMISSIONS.FEATURE_CREATE_PRODUCT]: document.getElementById('permProducts').checked,
                [PERMISSIONS.FEATURE_EDIT_PRODUCT]: document.getElementById('permProducts').checked,
                [PERMISSIONS.FEATURE_DELETE_PRODUCT]: document.getElementById('permDeleteProduct').checked,
                [PERMISSIONS.FEATURE_CREATE_USER]: document.getElementById('permUsers').checked,
                [PERMISSIONS.FEATURE_EDIT_USER]: document.getElementById('permUsers').checked,
                [PERMISSIONS.FEATURE_DELETE_USER]: document.getElementById('permDeleteUser').checked,
                [PERMISSIONS.FEATURE_BACKUP]: document.getElementById('permBackup').checked,
                [PERMISSIONS.FEATURE_RESTORE]: document.getElementById('permRestore').checked,
                [PERMISSIONS.FEATURE_RESET]: document.getElementById('permReset').checked,
                [PERMISSIONS.FEATURE_UPDATE_SETTINGS]: document.getElementById('permSettings').checked,
                [PERMISSIONS.FEATURE_MANAGE_PERMISSIONS]: false // Only admin can manage permissions
            };
            
            // Update all users with this role
            users.forEach(user => {
                if (user.role === role) {
                    user.permissions = DEFAULT_ROLE_PERMISSIONS[role];
                }
            });
            
            // If current user's role was updated, refresh permissions
            if (currentUser.role === role) {
                currentUser.permissions = DEFAULT_ROLE_PERMISSIONS[role];
                updateMenuItems();
            }
            
            alert('Hak akses berhasil disimpan!');
        }

        // Load backup history
        function loadBackupHistory() {
            const backupHistoryTable = document.getElementById('backupHistoryTable');
            
            backupHistoryTable.innerHTML = backupHistory.map(backup => `
                <tr>
                    <td>${backup.date}</td>
                    <td>${backup.type === 'manual' ? 'Manual' : 'Otomatis'}</td>
                    <td>${backup.size}</td>
                    <td>${backup.by}</td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="downloadBackup('${backup.date}')">
                            <i class="fas fa-download"></i> Unduh
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Backup data
        function backupData() {
            if (!hasPermission(PERMISSIONS.FEATURE_BACKUP)) {
                alert('Anda tidak memiliki izin untuk melakukan backup data!');
                return;
            }
            
            const now = new Date();
            const backupDate = now.toISOString().split('T')[0] + ' ' + now.toTimeString().split(' ')[0];
            
            // Create backup data
            const backup = {
                date: new Date().toISOString(),
                tickets: tickets,
                products: products,
                users: users.map(u => {
                    const user = {...u};
                    delete user.password; // Don't backup passwords
                    return user;
                }),
                transactions: transactions,
                settings: {
                    appName: document.getElementById('appName').value,
                    timezone: document.getElementById('timezone').value,
                    enableTax: document.getElementById('enableTax').checked,
                    taxRate: document.getElementById('taxRate').value,
                    receiptHeader: document.getElementById('receiptHeader').value,
                    receiptFooter: document.getElementById('receiptFooter').value,
                    printLogo: document.getElementById('printLogo').checked,
                    printAddress: document.getElementById('printAddress').checked
                }
            };
            
            // Create blob and download
            const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `tourtick_backup_${backupDate.replace(/[: ]/g, '-')}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // Add to backup history
            backupHistory.unshift({
                date: backupDate,
                type: 'manual',
                size: `${Math.round(blob.size / 1024)} KB`,
                by: currentUser.fullName
            });
            
            loadBackupHistory();
            alert('Backup data berhasil dibuat!');
        }

        // Show restore modal
        function showRestoreModal() {
            if (!hasPermission(PERMISSIONS.FEATURE_RESTORE)) {
                alert('Anda tidak memiliki izin untuk melakukan restore data!');
                return;
            }
            
            document.getElementById('restoreFile').value = '';
            document.getElementById('adminPassword').value = '';
            const restoreModal = new bootstrap.Modal(document.getElementById('restoreModal'));
            restoreModal.show();
        }

        // Restore data from backup
        function restoreData() {
            const fileInput = document.getElementById('restoreFile');
            const file = fileInput.files[0];
            const adminPassword = document.getElementById('adminPassword').value;
            
            if (!file) {
                alert('Silakan pilih file backup terlebih dahulu!');
                return;
            }
            
            if (!adminPassword || CryptoJS.SHA256(adminPassword).toString() !== users.find(u => u.role === 'admin')?.password) {
                alert('Password admin salah!');
                return;
            }
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const backup = JSON.parse(e.target.result);
                    
                    // Validate backup structure
                    if (!backup.tickets || !backup.products || !backup.users || !backup.transactions) {
                        alert('File backup tidak valid!');
                        return;
                    }
                    
                    if (confirm('PERINGATAN: Ini akan menggantikan semua data saat ini dengan data dari backup. Lanjutkan?')) {
                        // Restore data
                        tickets = backup.tickets || [];
                        products = backup.products || [];
                        users = backup.users || [];
                        transactions = backup.transactions || [];
                        
                        // Restore settings
                        if (backup.settings) {
                            document.getElementById('appName').value = backup.settings.appName || 'TourTick';
                            document.getElementById('timezone').value = backup.settings.timezone || 'Asia/Jakarta';
                            document.getElementById('enableTax').checked = backup.settings.enableTax || false;
                            document.getElementById('taxRate').value = backup.settings.taxRate || '10';
                            document.getElementById('taxRateContainer').style.display = backup.settings.enableTax ? 'block' : 'none';
                            document.getElementById('receiptHeader').value = backup.settings.receiptHeader || 'Terima kasih telah berkunjung';
                            document.getElementById('receiptFooter').value = backup.settings.receiptFooter || 'Barang yang sudah dibeli tidak dapat dikembalikan';
                            document.getElementById('printLogo').checked = backup.settings.printLogo !== false;
                            document.getElementById('printAddress').checked = backup.settings.printAddress !== false;
                        }
                        
                        // Add to backup history
                        const now = new Date();
                        const backupDate = now.toISOString().split('T')[0] + ' ' + now.toTimeString().split(' ')[0];
                        
                        backupHistory.unshift({
                            date: backupDate,
                            type: 'restore',
                            size: `${Math.round(file.size / 1024)} KB`,
                            by: currentUser.fullName
                        });
                        
                        // Close modal and refresh data
                        bootstrap.Modal.getInstance(document.getElementById('restoreModal')).hide();
                        loadBackupHistory();
                        
                        // Refresh all sections
                        refreshDashboard();
                        loadTicketList();
                        loadProducts();
                        loadUsers();
                        
                        alert('Data berhasil direstore dari backup!');
                    }
                } catch (error) {
                    console.error('Error restoring backup:', error);
                    alert('Terjadi kesalahan saat memproses file backup. Pastikan file valid.');
                }
            };
            
            reader.readAsText(file);
        }

        // Show reset confirmation
        function showResetConfirmation() {
            if (!hasPermission(PERMISSIONS.FEATURE_RESET)) {
                alert('Anda tidak memiliki izin untuk mereset data!');
                return;
            }
            
            document.getElementById('resetAdminPassword').value = '';
            const resetModal = new bootstrap.Modal(document.getElementById('resetConfirmationModal'));
            resetModal.show();
        }

        // Reset data to initial state
        function resetData() {
            const adminPassword = document.getElementById('resetAdminPassword').value;
            
            if (!adminPassword || CryptoJS.SHA256(adminPassword).toString() !== users.find(u => u.role === 'admin')?.password) {
                alert('Password admin salah!');
                return;
            }
            
            if (confirm('PERINGATAN: Ini akan menghapus SEMUA DATA dan mengembalikan ke pengaturan awal. Lanjutkan?')) {
                // Reset all data
                tickets = [];
                products = [];
                transactions = [];
                backupHistory = [];
                
                // Keep only admin user
                const adminUser = users.find(u => u.role === 'admin');
                users = adminUser ? [adminUser] : [];
                
                // Reset settings to defaults
                document.getElementById('appName').value = 'TourTick';
                document.getElementById('timezone').value = 'Asia/Jakarta';
                document.getElementById('enableTax').checked = false;
                document.getElementById('taxRate').value = '10';
                document.getElementById('taxRateContainer').style.display = 'none';
                document.getElementById('receiptHeader').value = 'Terima kasih telah berkunjung';
                document.getElementById('receiptFooter').value = 'Barang yang sudah dibeli tidak dapat dikembalikan';
                document.getElementById('printLogo').checked = true;
                document.getElementById('printAddress').checked = true;
                
                // Add to backup history
                const now = new Date();
                const resetDate = now.toISOString().split('T')[0] + ' ' + now.toTimeString().split(' ')[0];
                
                backupHistory.unshift({
                    date: resetDate,
                    type: 'reset',
                    size: '0 KB',
                    by: currentUser.fullName
                });
                
                // Close modal and refresh data
                bootstrap.Modal.getInstance(document.getElementById('resetConfirmationModal')).hide();
                loadBackupHistory();
                
                // Refresh all sections
                refreshDashboard();
                loadTicketList();
                loadProducts();
                loadUsers();
                
                alert('Data berhasil direset ke pengaturan awal!');
            }
        }

        // Download backup
        function downloadBackup(backupDate) {
            // In a real app, this would download the specific backup file
            alert(`Fitur download backup spesifik belum diimplementasikan. Backup tanggal ${backupDate} akan di-download.`);
            backupData();
        }

        // Search tickets in sales section
        function searchTicketsSales() {
            const searchTerm = document.getElementById('ticketSearchSales').value.toLowerCase();
            const rows = document.querySelectorAll('#availableTicketsTable tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }
    </script>
</body>
</html>
