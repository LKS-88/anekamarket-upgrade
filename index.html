<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Manajemen Hotel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        :root {
            --primary-color: #2a4365;
            --secondary-color: #4299e1;
            --accent-color: #e53e3e;
            --light-color: #ebf8ff;
            --dark-color: #1a365d;
            --admin-color: #805ad5;
            --supervisor-color: #38a169;
            --manager-color: #d69e2e;
            --staff-color: #3182ce;
            --success-color: #38a169;
            --warning-color: #dd6b20;
            --info-color: #00b5d8;
            --danger-color: #e53e3e;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #f7fafc;
            color: var(--dark-color);
        }
        
        .sidebar {
            background: linear-gradient(180deg, var(--primary-color) 0%, #1e3a8a 100%);
            color: white;
            min-height: 100vh;
            transition: all 0.3s;
            box-shadow: 2px 0 15px rgba(0, 0, 0, 0.1);
        }
        
        .sidebar .nav-link {
            color: rgba(255, 255, 255, 0.85);
            border-radius: 6px;
            margin-bottom: 6px;
            transition: all 0.2s;
            font-weight: 500;
        }
        
        .sidebar .nav-link:hover, .sidebar .nav-link.active {
            background-color: var(--secondary-color);
            color: white;
            transform: translateX(5px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .sidebar .nav-link.admin {
            background-color: var(--admin-color);
        }
        
        .sidebar .nav-link.supervisor {
            background-color: var(--supervisor-color);
        }
        
        .sidebar .nav-link.manager {
            background-color: var(--manager-color);
        }
        
        .sidebar .nav-link.staff {
            background-color: var(--staff-color);
        }
        
        .sidebar .nav-link i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        .main-content {
            padding: 25px;
            background-color: #fff;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.05);
        }
        
        .card {
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
            border: none;
            transition: transform 0.3s, box-shadow 0.3s;
            overflow: hidden;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .card-header {
            background: linear-gradient(90deg, var(--primary-color) 0%, #2c5282 100%);
            color: white;
            border-radius: 12px 12px 0 0 !important;
            padding: 16px 20px;
            border-bottom: none;
        }
        
        .btn {
            border-radius: 8px;
            padding: 8px 16px;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }
        
        .btn-primary:hover {
            background-color: #3182ce;
            border-color: #3182ce;
        }
        
        .btn-success {
            background-color: var(--success-color);
            border-color: var(--success-color);
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            border-color: var(--danger-color);
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            border-color: var(--warning-color);
        }
        
        .btn-info {
            background-color: var(--info-color);
            border-color: var(--info-color);
        }
        
        .btn-admin {
            background-color: var(--admin-color);
            border-color: var(--admin-color);
        }
        
        .btn-supervisor {
            background-color: var(--supervisor-color);
            border-color: var(--supervisor-color);
        }
        
        .btn-manager {
            background-color: var(--manager-color);
            border-color: var(--manager-color);
        }
        
        .btn-staff {
            background-color: var(--staff-color);
            border-color: var(--staff-color);
        }
        
        .table-responsive {
            overflow-x: auto;
            border-radius: 8px;
        }
        
        .table {
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .table th {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
        }
        
        .table-hover tbody tr:hover {
            background-color: rgba(66, 153, 225, 0.08);
        }
        
        /* Premium Invoice Styling */
        .nota-container {
            background-color: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 35px;
            max-width: 800px;
            margin: 0 auto;
            box-shadow: 0 0 25px rgba(0,0,0,0.08);
            position: relative;
        }
        
        .nota-header {
            text-align: center;
            margin-bottom: 35px;
            border-bottom: 2px dashed #e2e8f0;
            padding-bottom: 25px;
        }
        
        .hotel-logo {
            max-width: 150px;
            margin-bottom: 15px;
        }
        
        .nota-footer {
            margin-top: 35px;
            border-top: 2px dashed #e2e8f0;
            padding-top: 25px;
            text-align: center;
            font-style: italic;
            color: #718096;
        }
        
        .barcode-container {
            text-align: center;
            margin: 35px 0;
            padding: 20px;
            background-color: #f8fafc;
            border-radius: 8px;
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            padding: 10px 12px;
            border: 1px solid #e2e8f0;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 0.25rem rgba(66, 153, 225, 0.25);
        }
        
        .alert {
            border-radius: 8px;
            padding: 12px 16px;
        }
        
        .badge {
            font-weight: 600;
            padding: 6px 12px;
            border-radius: 8px;
        }
        
        .bg-primary {
            background-color: var(--primary-color) !important;
        }
        
        .bg-secondary {
            background-color: var(--secondary-color) !important;
        }
        
        .bg-success {
            background-color: var(--success-color) !important;
        }
        
        .bg-danger {
            background-color: var(--danger-color) !important;
        }
        
        .bg-warning {
            background-color: var(--warning-color) !important;
        }
        
        .bg-info {
            background-color: var(--info-color) !important;
        }
        
        .bg-admin {
            background-color: var(--admin-color) !important;
        }
        
        .bg-supervisor {
            background-color: var(--supervisor-color) !important;
        }
        
        .bg-manager {
            background-color: var(--manager-color) !important;
        }
        
        .bg-staff {
            background-color: var(--staff-color) !important;
        }
        
        /* Footer styling */
        .app-footer {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 0;
            text-align: center;
            font-size: 14px;
            position: fixed;
            bottom: 0;
            width: 100%;
        }
        
        .app-footer a {
            color: #a0aec0;
            text-decoration: none;
            transition: color 0.2s;
        }
        
        .app-footer a:hover {
            color: white;
        }
        
        /* Shift indicator */
        .shift-indicator {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
        }
        
        /* Modern scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #cbd5e0;
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a0aec0;
        }
        
        /* Print styling */
        @media print {
            body * {
                visibility: hidden;
            }
            .nota-container, .nota-container *,
            .report-container, .report-container * {
                visibility: visible;
            }
            .nota-container, .report-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                border: none;
                box-shadow: none;
                padding: 0;
                margin: 0;
            }
            .no-print {
                display: none !important;
            }
            .app-footer {
                display: none;
            }
            .nota-header {
                padding-top: 0;
                margin-top: 0;
            }
            .nota-footer {
                margin-bottom: 0;
                padding-bottom: 0;
            }
        }
        
        /* Responsive design */
        @media (max-width: 768px) {
            .sidebar {
                min-height: auto;
                margin-bottom: 20px;
            }
            .main-content {
                padding: 18px;
            }
            .table-responsive {
                font-size: 0.85rem;
            }
            .card-body {
                padding: 1.25rem;
            }
            .btn {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }
            .app-footer {
                position: static;
                padding: 12px 0;
            }
            .nota-container {
                padding: 20px;
            }
        }
        
        /* Payment section */
        .payment-section {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .payment-method {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .payment-method label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            transition: all 0.2s;
        }

        .payment-method label:hover {
            background-color: #e9ecef;
        }

        .payment-method input[type="radio"] {
            margin: 0;
        }

        .payment-details {
            margin-top: 15px;
            display: none;
        }

        .payment-details.active {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Login Sistem</h5>
                </div>
                <div class="modal-body">
                    <form id="login-form">
                        <div class="mb-3">
                            <label for="login-username" class="form-label">Username</label>
                            <input type="text" class="form-control" id="login-username" required autocomplete="off">
                        </div>
                        <div class="mb-3">
                            <label for="login-password" class="form-label">Password</label>
                            <input type="password" class="form-control" id="login-password" required autocomplete="new-password">
                        </div>
                        <button type="submit" class="btn btn-primary w-100">
                            <i class="fas fa-sign-in-alt me-2"></i> Login
                        </button>
                    </form>
                </div>
                <div class="modal-footer">
                    <small class="text-muted">Sistem Manajemen Hotel © 2025 Lentera Karya Situbondo</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Password Modal -->
    <div class="modal fade" id="adminPasswordModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-admin text-white">
                    <h5 class="modal-title">Verifikasi Admin</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="admin-password-form">
                        <div class="mb-3">
                            <label for="admin-password" class="form-label">Password Admin</label>
                            <input type="password" class="form-control" id="admin-password" required autocomplete="new-password">
                        </div>
                        <div class="d-flex justify-content-end gap-2">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                            <button type="submit" class="btn btn-admin">
                                <i class="fas fa-check-circle me-2"></i> Verifikasi
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Database Backup Modal -->
    <div class="modal fade" id="databaseModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-admin text-white">
                    <h5 class="modal-title" id="databaseModalTitle">Backup Data</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="database-form">
                        <input type="hidden" id="database-action">
                        <div class="mb-3">
                            <label for="database-password" class="form-label">Password Admin</label>
                            <input type="password" class="form-control" id="database-password" required>
                        </div>
                        <div id="backup-section">
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i> Backup akan menyimpan semua data saat ini ke file JSON.
                            </div>
                        </div>
                        <div id="restore-section" class="d-none">
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i> Restore akan mengganti semua data saat ini dengan data dari file.
                            </div>
                            <div class="mb-3">
                                <label for="restore-file" class="form-label">Pilih File Backup</label>
                                <input type="file" class="form-control" id="restore-file" accept=".json">
                            </div>
                        </div>
                        <div id="reset-section" class="d-none">
                            <div class="alert alert-danger">
                                <i class="fas fa-exclamation-triangle me-2"></i> <strong>PERINGATAN:</strong> Reset akan menghapus semua data dan mengembalikan ke pengaturan awal!
                            </div>
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="checkbox" id="confirm-reset" required>
                                <label class="form-check-label" for="confirm-reset">
                                    Saya mengerti bahwa semua data akan dihapus
                                </label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" id="confirm-database-action">
                        <i class="fas fa-check-circle me-2"></i> Konfirmasi
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="modal fade" id="paymentModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Pembayaran</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Total Pembayaran</label>
                        <h4 id="payment-total">Rp 0</h4>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Metode Pembayaran</label>
                        <div class="payment-method">
                            <label>
                                <input type="radio" name="payment-method" value="cash" checked>
                                <i class="fas fa-money-bill-wave"></i>
                                <span>Tunai</span>
                            </label>
                            <label>
                                <input type="radio" name="payment-method" value="transfer">
                                <i class="fas fa-university"></i>
                                <span>Transfer Bank</span>
                            </label>
                            <label>
                                <input type="radio" name="payment-method" value="ewallet">
                                <i class="fas fa-wallet"></i>
                                <span>E-Wallet</span>
                            </label>
                            <label>
                                <input type="radio" name="payment-method" value="qris">
                                <i class="fas fa-qrcode"></i>
                                <span>QRIS</span>
                            </label>
                        </div>
                    </div>
                    
                    <div id="cash-details" class="payment-details active">
                        <div class="mb-3">
                            <label for="cash-amount" class="form-label">Uang Diterima</label>
                            <input type="number" class="form-control" id="cash-amount" min="0">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Kembalian</label>
                            <h5 id="cash-change">Rp 0</h5>
                        </div>
                    </div>
                    
                    <div id="transfer-details" class="payment-details">
                        <div class="mb-3">
                            <label for="bank-name" class="form-label">Nama Bank</label>
                            <input type="text" class="form-control" id="bank-name">
                        </div>
                        <div class="mb-3">
                            <label for="account-number" class="form-label">Nomor Rekening</label>
                            <input type="text" class="form-control" id="account-number">
                        </div>
                        <div class="mb-3">
                            <label for="transfer-proof" class="form-label">Bukti Transfer</label>
                            <input type="file" class="form-control" id="transfer-proof" accept="image/*,.pdf">
                        </div>
                    </div>
                    
                    <div id="ewallet-details" class="payment-details">
                        <div class="mb-3">
                            <label for="ewallet-provider" class="form-label">Provider</label>
                            <select class="form-select" id="ewallet-provider">
                                <option value="gopay">GoPay</option>
                                <option value="ovo">OVO</option>
                                <option value="dana">DANA</option>
                                <option value="linkaja">LinkAja</option>
                                <option value="shopeepay">ShopeePay</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="ewallet-number" class="form-label">Nomor Telepon</label>
                            <input type="text" class="form-control" id="ewallet-number">
                        </div>
                    </div>
                    
                    <div id="qris-details" class="payment-details text-center">
                        <div class="mb-3">
                            <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=hotelpayment" alt="QR Code" class="img-fluid" style="max-width: 200px;">
                            <p class="mt-2">Scan QR Code untuk pembayaran</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" id="confirm-payment">
                        <i class="fas fa-check-circle me-2"></i> Konfirmasi Pembayaran
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 d-md-block sidebar collapse no-print" id="sidebarMenu">
                <div class="position-sticky pt-3">
                    <div class="text-center mb-4">
                        <h4><i class="fas fa-hotel me-2"></i> Hotel System</h4>
                        <small id="current-user-role" class="badge bg-secondary mt-2"></small>
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" id="dashboard-tab">
                                <i class="fas fa-tachometer-alt"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="checkin-tab">
                                <i class="fas fa-sign-in-alt"></i> Check-In
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="checkout-tab">
                                <i class="fas fa-sign-out-alt"></i> Check-Out
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="transaksi-tab">
                                <i class="fas fa-cash-register"></i> Transaksi
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="nota-tab">
                                <i class="fas fa-receipt"></i> Buat Nota
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link admin" href="#" id="kamar-tab">
                                <i class="fas fa-bed"></i> Manajemen Kamar
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link admin" href="#" id="fasilitas-tab">
                                <i class="fas fa-utensils"></i> Fasilitas
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="tamu-tab">
                                <i class="fas fa-users"></i> Data Tamu
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link supervisor" href="#" id="laporan-tab">
                                <i class="fas fa-chart-bar"></i> Laporan
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link manager" href="https://lks-88.github.io/database-karyawan" id="karyawan-tab" target="_blank">
                                <i class="fas fa-user-tie"></i> Kelola Karyawan
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="backup-tab">
                                <i class="fas fa-database"></i> Backup Data
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link admin" href="#" id="admin-tab">
                                <i class="fas fa-user-shield"></i> Admin Panel
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" id="logout-tab">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 main-content">
                <!-- Dashboard Section -->
                <div class="tab-content" id="dashboard-content">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-tachometer-alt me-2"></i> Dashboard</h1>
                        <div id="current-shift" class="shift-indicator bg-secondary"></div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-3">
                            <div class="card text-white bg-primary mb-3">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h5 class="card-title">Tamu Hari Ini</h5>
                                            <h2 class="card-text" id="today-guests">0</h2>
                                        </div>
                                        <i class="fas fa-users fa-3x opacity-50"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-white bg-success mb-3">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h5 class="card-title">Kamar Terisi</h5>
                                            <h2 class="card-text" id="occupied-rooms">0</h2>/<span id="total-rooms">0</span>
                                        </div>
                                        <i class="fas fa-bed fa-3x opacity-50"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-white bg-warning mb-3">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h5 class="card-title">Pendapatan Hari Ini</h5>
                                            <h2 class="card-text" id="today-income">Rp 0</h2>
                                        </div>
                                        <i class="fas fa-money-bill-wave fa-3x opacity-50"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card text-white bg-info mb-3">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h5 class="card-title">Karyawan Aktif</h5>
                                            <h2 class="card-text" id="active-staff">0</h2>
                                        </div>
                                        <i class="fas fa-user-clock fa-3x opacity-50"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-chart-line me-2"></i> Statistik Bulan Ini</h5>
                                </div>
                                <div class="card-body">
                                    <canvas id="monthlyChart" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header">
                                    <h5><i class="fas fa-bell me-2"></i> Notifikasi</h5>
                                </div>
                                <div class="card-body">
                                    <div class="list-group" id="notification-list">
                                        <a href="#" class="list-group-item list-group-item-action">
                                            <div class="d-flex w-100 justify-content-between">
                                                <h6 class="mb-1">Selamat datang di sistem</h6>
                                                <small>Baru saja</small>
                                            </div>
                                            <p class="mb-1">Sistem siap digunakan</p>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Check-In Section -->
                <div class="tab-content d-none" id="checkin-content">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-sign-in-alt me-2"></i> Check-In Tamu</h1>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Form Check-In</h5>
                                </div>
                                <div class="card-body">
                                    <form id="checkin-form">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="checkin-name" class="form-label">Nama Tamu</label>
                                                <input type="text" class="form-control" id="checkin-name" required>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="checkin-identity" class="form-label">No. Identitas (KTP/SIM/Passport)</label>
                                                <input type="text" class="form-control" id="checkin-identity" required>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="checkin-phone" class="form-label">No. Telepon</label>
                                                <input type="tel" class="form-control" id="checkin-phone" required>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="checkin-room" class="form-label">Kamar</label>
                                                <select class="form-select" id="checkin-room" required>
                                                    <option value="">Pilih Kamar</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="checkin-duration" class="form-label">Durasi Menginap (hari)</label>
                                                <input type="number" class="form-control" id="checkin-duration" min="1" value="1" required>
                                            </div>
                                            <div class="col-md-6">
                                                <label class="form-label">Total Biaya</label>
                                                <h4 id="checkin-total">Rp 0</h4>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Layanan Tambahan</label>
                                            <div id="additional-services-container" class="mb-3">
                                                <!-- Services will be added here based on settings -->
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="checkin-notes" class="form-label">Catatan</label>
                                            <textarea class="form-control" id="checkin-notes" rows="2"></textarea>
                                        </div>
                                        <button type="submit" class="btn btn-primary w-100">
                                            <i class="fas fa-sign-in-alt me-2"></i> Proses Check-In
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Tamu Hari Ini</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover">
                                            <thead>
                                                <tr>
                                                    <th>No.</th>
                                                    <th>Nama</th>
                                                    <th>Kamar</th>
                                                    <th>Check-In</th>
                                                    <th>Check-Out</th>
                                                    <th>Status</th>
                                                    <th>Aksi</th>
                                                </tr>
                                            </thead>
                                            <tbody id="today-guests-list">
                                                <!-- Today's guests will be loaded here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Check-Out Section -->
                <div class="tab-content d-none" id="checkout-content">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-sign-out-alt me-2"></i> Check-Out Tamu</h1>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h5>Daftar Tamu yang Sedang Menginap</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>No.</th>
                                            <th>Nama Tamu</th>
                                            <th>No. Identitas</th>
                                            <th>Kamar</th>
                                            <th>Check-In</th>
                                            <th>Check-Out</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="checkout-guests-list">
                                        <!-- Checked-in guests will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Transaksi Section -->
                <div class="tab-content d-none" id="transaksi-content">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-cash-register me-2"></i> Transaksi</h1>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Tambah Transaksi Baru</h5>
                                </div>
                                <div class="card-body">
                                    <form id="transaction-form">
                                        <div class="row mb-3">
                                            <div class="col-md-6">
                                                <label for="transaction-guest" class="form-label">Tamu</label>
                                                <select class="form-select" id="transaction-guest" required>
                                                    <option value="">Pilih Tamu</option>
                                                </select>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="transaction-type" class="form-label">Jenis Transaksi</label>
                                                <select class="form-select" id="transaction-type" required>
                                                    <option value="room">Biaya Kamar</option>
                                                    <option value="food">Makanan & Minuman</option>
                                                    <option value="facility">Fasilitas</option>
                                                    <option value="laundry">Laundry</option>
                                                    <option value="other">Lainnya</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row mb-3" id="facility-select-container" style="display: none;">
                                            <div class="col-md-12">
                                                <label for="transaction-facility" class="form-label">Pilih Fasilitas</label>
                                                <select class="form-select" id="transaction-facility">
                                                    <option value="">Pilih Fasilitas</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="row mb-3">
                                            <div class="col-md-4">
                                                <label for="transaction-amount" class="form-label">Jumlah (Rp)</label>
                                                <input type="number" class="form-control" id="transaction-amount" required>
                                            </div>
                                            <div class="col-md-4">
                                                <label for="transaction-quantity" class="form-label">Kuantitas</label>
                                                <input type="number" class="form-control" id="transaction-quantity" min="1" value="1">
                                            </div>
                                            <div class="col-md-4">
                                                <label class="form-label">Subtotal</label>
                                                <h5 id="transaction-subtotal">Rp 0</h5>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="transaction-notes" class="form-label">Keterangan</label>
                                            <input type="text" class="form-control" id="transaction-notes">
                                        </div>
                                        <button type="submit" class="btn btn-primary w-100">
                                            <i class="fas fa-save me-2"></i> Simpan Transaksi
                                        </button>
                                    </form>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Filter Transaksi</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label for="transaction-date-filter" class="form-label">Tanggal</label>
                                        <input type="date" class="form-control" id="transaction-date-filter">
                                    </div>
                                    <div class="mb-3">
                                        <label for="transaction-type-filter" class="form-label">Jenis Transaksi</label>
                                        <select class="form-select" id="transaction-type-filter">
                                            <option value="">Semua</option>
                                            <option value="room">Biaya Kamar</option>
                                            <option value="food">Makanan & Minuman</option>
                                            <option value="facility">Fasilitas</option>
                                            <option value="laundry">Laundry</option>
                                            <option value="other">Lainnya</option>
                                        </select>
                                    </div>
                                    <button id="filter-transactions" class="btn btn-primary w-100">
                                        <i class="fas fa-filter me-2"></i> Filter
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h5>Daftar Transaksi</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>No.</th>
                                            <th>Tanggal</th>
                                            <th>Tamu</th>
                                            <th>Jenis</th>
                                            <th>Keterangan</th>
                                            <th>Jumlah</th>
                                            <th>Kasir</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="transactions-list">
                                        <!-- Transactions will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Nota Section -->
                <div class="tab-content d-none" id="nota-content">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-receipt me-2"></i> Buat Nota</h1>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Cari Tamu</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label for="invoice-search" class="form-label">Cari (Nama/No. Identitas/Kamar)</label>
                                        <input type="text" class="form-control" id="invoice-search">
                                    </div>
                                    <div class="mb-3">
                                        <label for="invoice-date-filter" class="form-label">Tanggal Check-In</label>
                                        <input type="date" class="form-control" id="invoice-date-filter">
                                    </div>
                                    <button id="filter-invoice-guests" class="btn btn-primary w-100">
                                        <i class="fas fa-search me-2"></i> Cari
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Daftar Tamu</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Nama</th>
                                                    <th>No. Identitas</th>
                                                    <th>Kamar</th>
                                                    <th>Status</th>
                                                    <th>Aksi</th>
                                                </tr>
                                            </thead>
                                            <tbody id="invoice-guests-list">
                                                <!-- Guests will be loaded here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-none" id="invoice-container">
                        <div class="nota-container">
                            <div class="nota-header">
                                <img src="https://raw.githubusercontent.com/LKS-88/anekamarket/refs/heads/main/Logo-Anekamarketku.png" alt="Hotel Logo" class="hotel-logo">
                                <h3 id="hotel-name-header">HOTEL MEWAH</h3>
                                <p id="hotel-address-header">Jl. Raya No. 123, Kota Anda</p>
                                <p id="hotel-contact-header">Telp: (021) 1234567 | Email: info@hotelmewah.com</p>
                                <hr>
                                <h4>NOTA PEMBAYARAN</h4>
                            </div>
                            
                            <div class="row mb-4">
                                <div class="col-md-6">
                                    <p><strong>No. Nota:</strong> <span id="invoice-number">INV-20230001</span></p>
                                    <p><strong>Tanggal:</strong> <span id="invoice-date">01 Januari 2023, 10:00</span></p>
                                    <p><strong>Kasir:</strong> <span id="invoice-cashier">Admin</span></p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Nama Tamu:</strong> <span id="invoice-guest-name">John Doe</span></p>
                                    <p><strong>No. Kamar:</strong> <span id="invoice-room-number">101</span></p>
                                    <p><strong>No. Identitas:</strong> <span id="invoice-guest-id">1234567890</span></p>
                                </div>
                            </div>
                            
                            <div class="barcode-container">
                                <svg id="invoice-barcode"></svg>
                            </div>
                            
                            <div class="table-responsive">
                                <table class="table table-bordered">
                                    <thead>
                                        <tr>
                                            <th>No.</th>
                                            <th>Deskripsi</th>
                                            <th>Jumlah</th>
                                            <th>Harga</th>
                                            <th>Total</th>
                                        </tr>
                                    </thead>
                                    <tbody id="invoice-items">
                                        <!-- Invoice items will be added here -->
                                    </tbody>
                                </table>
                            </div>
                            
                            <div class="row justify-content-end mt-4">
                                <div class="col-md-6">
                                    <table class="table table-borderless">
                                        <tr>
                                            <td><strong>Subtotal:</strong></td>
                                            <td class="text-end" id="invoice-subtotal">Rp 0</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Pajak (10%):</strong></td>
                                            <td class="text-end" id="invoice-tax">Rp 0</td>
                                        </tr>
                                        <tr class="table-active">
                                            <td><strong>Total:</strong></td>
                                            <td class="text-end" id="invoice-total">Rp 0</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Metode Pembayaran:</strong></td>
                                            <td class="text-end" id="invoice-payment-method">-</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Dibayar:</strong></td>
                                            <td class="text-end" id="invoice-amount-paid">Rp 0</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Kembalian:</strong></td>
                                            <td class="text-end" id="invoice-change">Rp 0</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>
                            
                            <div class="nota-footer">
                                <p>Terima kasih atas kunjungan Anda</p>
                                <p>Nota ini sah tanpa tanda tangan dan stempel</p>
                            </div>
                            
                            <input type="hidden" id="invoice-guest">
                        </div>
                        
                        <div class="d-flex justify-content-center gap-2 mt-4 no-print">
                            <button id="print-invoice" class="btn btn-primary">
                                <i class="fas fa-print me-2"></i> Cetak Nota
                            </button>
                            <button id="download-invoice-pdf" class="btn btn-danger">
                                <i class="fas fa-file-pdf me-2"></i> Download PDF
                            </button>
                            <button id="save-invoice" class="btn btn-success">
                                <i class="fas fa-save me-2"></i> Simpan Nota
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Kamar Section -->
                <div class="tab-content d-none" id="kamar-content">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-bed me-2"></i> Manajemen Kamar</h1>
                        <button class="btn btn-primary" id="add-room-btn"><i class="fas fa-plus me-2"></i> Tambah Kamar</button>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h5>Daftar Kamar</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>No.</th>
                                            <th>Nomor Kamar</th>
                                            <th>Tipe</th>
                                            <th>Harga/Hari</th>
                                            <th>Status</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="rooms-list">
                                        <!-- Rooms will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Modal Tambah/Ubah Kamar -->
                    <div class="modal fade" id="roomModal" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="roomModalTitle">Tambah Kamar Baru</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="room-form">
                                        <input type="hidden" id="room-id">
                                        <div class="mb-3">
                                            <label for="room-number" class="form-label">Nomor Kamar</label>
                                            <input type="text" class="form-control" id="room-number" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="room-type" class="form-label">Tipe Kamar</label>
                                            <select class="form-select" id="room-type" required>
                                                <option value="standard">Standard</option>
                                                <option value="deluxe">Deluxe</option>
                                                <option value="suite">Suite</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label for="room-price" class="form-label">Harga per Hari (Rp)</label>
                                            <input type="number" class="form-control" id="room-price" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="room-status" class="form-label">Status</label>
                                            <select class="form-select" id="room-status" required>
                                                <option value="available">Tersedia</option>
                                                <option value="occupied">Terisi</option>
                                                <option value="maintenance">Perbaikan</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label for="room-notes" class="form-label">Catatan</label>
                                            <textarea class="form-control" id="room-notes" rows="2"></textarea>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                                    <button type="button" class="btn btn-primary" id="save-room">Simpan</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Fasilitas Section -->
                <div class="tab-content d-none" id="fasilitas-content">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-utensils me-2"></i> Manajemen Fasilitas</h1>
                        <button class="btn btn-primary" id="add-facility-btn"><i class="fas fa-plus me-2"></i> Tambah Fasilitas</button>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h5>Daftar Fasilitas</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>No.</th>
                                            <th>Nama</th>
                                            <th>Kategori</th>
                                            <th>Harga</th>
                                            <th>Status</th>
                                            <th>Deskripsi</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="facilities-list">
                                        <!-- Facilities will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Modal Tambah/Ubah Fasilitas -->
                    <div class="modal fade" id="facilityModal" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="facilityModalTitle">Tambah Fasilitas Baru</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="facility-form">
                                        <input type="hidden" id="facility-id">
                                        <div class="mb-3">
                                            <label for="facility-name" class="form-label">Nama Fasilitas</label>
                                            <input type="text" class="form-control" id="facility-name" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="facility-category" class="form-label">Kategori</label>
                                            <select class="form-select" id="facility-category" required>
                                                <option value="food">Makanan</option>
                                                <option value="beverage">Minuman</option>
                                                <option value="service">Layanan</option>
                                                <option value="other">Lainnya</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label for="facility-price" class="form-label">Harga (Rp)</label>
                                            <input type="number" class="form-control" id="facility-price" required>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Status</label>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="facility-status" id="facility-available" value="available" checked>
                                                <label class="form-check-label" for="facility-available">
                                                    Tersedia
                                                </label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="facility-status" id="facility-unavailable" value="unavailable">
                                                <label class="form-check-label" for="facility-unavailable">
                                                    Tidak Tersedia
                                                </label>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="facility-description" class="form-label">Deskripsi</label>
                                            <textarea class="form-control" id="facility-description" rows="2"></textarea>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                                    <button type="button" class="btn btn-primary" id="save-facility">Simpan</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tamu Section -->
                <div class="tab-content d-none" id="tamu-content">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-users me-2"></i> Data Tamu</h1>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Filter Tamu</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label for="guest-search" class="form-label">Cari (Nama/No. Identitas/Telepon)</label>
                                        <input type="text" class="form-control" id="guest-search">
                                    </div>
                                    <div class="mb-3">
                                        <label for="guest-status-filter" class="form-label">Status</label>
                                        <select class="form-select" id="guest-status-filter">
                                            <option value="">Semua</option>
                                            <option value="checked-in">Check-In</option>
                                            <option value="checked-out">Check-Out</option>
                                        </select>
                                    </div>
                                    <button id="filter-guests" class="btn btn-primary w-100">
                                        <i class="fas fa-filter me-2"></i> Filter
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Daftar Tamu</h5>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover">
                                            <thead>
                                                <tr>
                                                    <th>No.</th>
                                                    <th>Nama</th>
                                                    <th>No. Identitas</th>
                                                    <th>No. Telepon</th>
                                                    <th>Kamar</th>
                                                    <th>Status</th>
                                                    <th>Aksi</th>
                                                </tr>
                                            </thead>
                                            <tbody id="guests-list">
                                                <!-- Guests will be loaded here -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Laporan Section -->
                <div class="tab-content d-none" id="laporan-content">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-chart-bar me-2"></i> Laporan</h1>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Filter Laporan</h5>
                                </div>
                                <div class="card-body">
                                    <div class="mb-3">
                                        <label for="report-type" class="form-label">Jenis Laporan</label>
                                        <select class="form-select" id="report-type">
                                            <option value="daily">Harian</option>
                                            <option value="weekly">Mingguan</option>
                                            <option value="monthly">Bulanan</option>
                                            <option value="custom">Custom</option>
                                        </select>
                                    </div>
                                    
                                    <div id="report-date-container">
                                        <div class="mb-3">
                                            <label for="report-date" class="form-label">Tanggal</label>
                                            <input type="date" class="form-control" id="report-date">
                                        </div>
                                    </div>
                                    
                                    <div id="report-week-container" class="d-none">
                                        <div class="mb-3">
                                            <label for="report-week" class="form-label">Minggu</label>
                                            <input type="week" class="form-control" id="report-week">
                                        </div>
                                    </div>
                                    
                                    <div id="report-month-container" class="d-none">
                                        <div class="mb-3">
                                            <label for="report-month" class="form-label">Bulan</label>
                                            <input type="month" class="form-control" id="report-month">
                                        </div>
                                    </div>
                                    
                                    <div id="report-custom-container" class="d-none">
                                        <div class="mb-3">
                                            <label for="report-start-date" class="form-label">Tanggal Mulai</label>
                                            <input type="date" class="form-control" id="report-start-date">
                                        </div>
                                        <div class="mb-3">
                                            <label for="report-end-date" class="form-label">Tanggal Selesai</label>
                                            <input type="date" class="form-control" id="report-end-date">
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="report-category" class="form-label">Kategori</label>
                                        <select class="form-select" id="report-category">
                                            <option value="all">Semua</option>
                                            <option value="room">Biaya Kamar</option>
                                            <option value="food">Makanan & Minuman</option>
                                            <option value="facility">Fasilitas</option>
                                            <option value="laundry">Laundry</option>
                                            <option value="other">Lainnya</option>
                                        </select>
                                    </div>
                                    
                                    <button id="generate-report" class="btn btn-primary w-100">
                                        <i class="fas fa-chart-pie me-2"></i> Generate Laporan
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="card">
                                <div class="card-header">
                                    <h5>Hasil Laporan</h5>
                                </div>
                                <div class="card-body">
                                    <div id="report-result" class="d-none">
                                        <div id="report-content">
                                            <!-- Report content will be generated here -->
                                        </div>
                                        
                                        <div class="d-flex justify-content-end gap-2 mt-4 no-print">
                                            <button id="print-report" class="btn btn-primary">
                                                <i class="fas fa-print me-2"></i> Cetak
                                            </button>
                                            <button id="export-report-pdf" class="btn btn-danger">
                                                <i class="fas fa-file-pdf me-2"></i> Export PDF
                                            </button>
                                            <button id="export-report-excel" class="btn btn-success">
                                                <i class="fas fa-file-excel me-2"></i> Export Excel
                                            </button>
                                        </div>
                                    </div>
                                    <div id="report-empty" class="text-center py-5">
                                        <i class="fas fa-chart-bar fa-4x text-muted mb-3"></i>
                                        <h5>Tidak ada data laporan</h5>
                                        <p class="text-muted">Silahkan generate laporan terlebih dahulu</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Backup Section -->
                <div class="tab-content d-none" id="backup-content">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-database me-2"></i> Backup & Restore Data</h1>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header bg-primary text-white">
                                    <h5><i class="fas fa-download me-2"></i> Backup Data</h5>
                                </div>
                                <div class="card-body">
                                    <p>Backup semua data sistem ke file JSON.</p>
                                    <button id="backup-data" class="btn btn-primary w-100">
                                        <i class="fas fa-file-export me-2"></i> Buat Backup
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header bg-warning text-white">
                                    <h5><i class="fas fa-upload me-2"></i> Restore Data</h5>
                                </div>
                                <div class="card-body">
                                    <p>Restore data dari file backup JSON.</p>
                                    <button id="restore-data" class="btn btn-warning w-100">
                                        <i class="fas fa-file-import me-2"></i> Restore Backup
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header bg-danger text-white">
                                    <h5><i class="fas fa-trash-alt me-2"></i> Reset Data</h5>
                                </div>
                                <div class="card-body">
                                    <p>Reset semua data ke pengaturan awal.</p>
                                    <button id="reset-data" class="btn btn-danger w-100">
                                        <i class="fas fa-broom me-2"></i> Reset Sistem
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card mt-4">
                        <div class="card-header">
                            <h5><i class="fas fa-history me-2"></i> Riwayat Backup</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>No.</th>
                                            <th>Tanggal Backup</th>
                                            <th>Nama File</th>
                                            <th>Ukuran</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="backup-history">
                                        <!-- Backup history will be loaded here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Admin Section -->
                <div class="tab-content d-none" id="admin-content">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2"><i class="fas fa-user-shield me-2"></i> Admin Panel</h1>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header bg-admin text-white">
                                    <h5><i class="fas fa-users-cog me-2"></i> Manajemen Pengguna</h5>
                                </div>
                                <div class="card-body">
                                    <p>Kelola akun pengguna sistem.</p>
                                    <button id="manage-users" class="btn btn-admin w-100">
                                        <i class="fas fa-users me-2"></i> Kelola Pengguna
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header bg-admin text-white">
                                    <h5><i class="fas fa-key me-2"></i> Role & Permissions</h5>
                                </div>
                                <div class="card-body">
                                    <p>Kelola role dan permissions sistem.</p>
                                    <button id="manage-permissions" class="btn btn-admin w-100">
                                        <i class="fas fa-user-tag me-2"></i> Kelola Permissions
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-header bg-admin text-white">
                                    <h5><i class="fas fa-cog me-2"></i> Pengaturan Sistem</h5>
                                </div>
                                <div class="card-body">
                                    <p>Pengaturan dasar sistem.</p>
                                    <button id="system-settings" class="btn btn-admin w-100">
                                        <i class="fas fa-sliders-h me-2"></i> Pengaturan Sistem
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- User Management Modal -->
                    <div class="modal fade" id="userManagementModal" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header bg-admin text-white">
                                    <h5 class="modal-title">Manajemen Pengguna</h5>
                                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover">
                                            <thead>
                                                <tr>
                                                    <th>No.</th>
                                                    <th>Username</th>
                                                    <th>Nama</th>
                                                    <th>Role</th>
                                                    <th>Status</th>
                                                    <th>Login Terakhir</th>
                                                    <th>Aksi</th>
                                                </tr>
                                            </thead>
                                            <tbody id="users-list">
                                                <!-- Users will be loaded here -->
                                            </tbody>
                                        </table>
                                    </div>
                                    
                                    <button id="add-user-btn" class="btn btn-primary mt-3">
                                        <i class="fas fa-plus me-2"></i> Tambah Pengguna
                                    </button>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Add/Edit User Modal -->
                    <div class="modal fade" id="userModal" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="userModalTitle">Tambah Pengguna Baru</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="user-form">
                                        <input type="hidden" id="user-id">
                                        <div class="mb-3">
                                            <label for="user-username" class="form-label">Username</label>
                                            <input type="text" class="form-control" id="user-username" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="user-name" class="form-label">Nama Lengkap</label>
                                            <input type="text" class="form-control" id="user-name" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="user-role" class="form-label">Role</label>
                                            <select class="form-select" id="user-role" required>
                                                <option value="admin">Admin</option>
                                                <option value="supervisor">Supervisor</option>
                                                <option value="manager">Manager</option>
                                                <option value="staff">Staff</option>
                                            </select>
                                        </div>
                                        <div class="mb-3">
                                            <label for="user-password" class="form-label">Password</label>
                                            <input type="password" class="form-control" id="user-password" required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="user-status" class="form-label">Status</label>
                                            <select class="form-select" id="user-status" required>
                                                <option value="active">Aktif</option>
                                                <option value="inactive">Nonaktif</option>
                                            </select>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                                    <button type="button" class="btn btn-primary" id="save-user">Simpan</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <footer class="app-footer no-print">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-6">
                    <span>Sistem Manajemen Hotel © 2025 Lentera Karya Situbondo</span>
                </div>
                <div class="col-md-6 text-md-end">
                    <span>Versi 1.0.0 | Shift: <span id="footer-shift">-</span></span>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Inisialisasi variabel global untuk menyimpan data
        let currentUser = null;
        let rooms = [];
        let guests = [];
        let transactions = [];
        let facilities = [];
        let users = [];
        let backups = [];
        let settings = {
            hotelName: "Hotel Mewah",
            hotelAddress: "Jl. Raya No. 123, Kota Anda",
            hotelContact: "Telp: (021) 1234567 | Email: info@hotelmewah.com",
            taxRate: 10,
            additionalServices: [
                { id: 1, name: "Sarapan", price: 50000 },
                { id: 2, name: "Laundry", price: 30000 },
                { id: 3, name: "Extra Bed", price: 100000 }
            ]
        };

        // Fungsi untuk memuat data dari localStorage
        function loadData() {
            const savedData = localStorage.getItem('hotelSystemData');
            if (savedData) {
                const data = JSON.parse(savedData);
                currentUser = data.currentUser || null;
                rooms = data.rooms || [];
                guests = data.guests || [];
                transactions = data.transactions || [];
                facilities = data.facilities || [];
                users = data.users || [];
                backups = data.backups || [];
                settings = data.settings || settings;
            } else {
                // Data default jika tidak ada data tersimpan
                initializeDefaultData();
            }
            
            updateUI();
        }

        // Fungsi untuk menginisialisasi data default
        function initializeDefaultData() {
            // Data kamar default
            rooms = [
                { id: 1, number: "101", type: "standard", price: 350000, status: "available", notes: "" },
                { id: 2, number: "102", type: "standard", price: 350000, status: "available", notes: "" },
                { id: 3, number: "201", type: "deluxe", price: 500000, status: "available", notes: "" },
                { id: 4, number: "202", type: "deluxe", price: 500000, status: "available", notes: "" },
                { id: 5, number: "301", type: "suite", price: 800000, status: "available", notes: "View bagus" }
            ];

            // Data fasilitas default
            facilities = [
                { id: 1, name: "Sarapan Pagi", category: "food", price: 50000, status: "available", description: "Menu sarapan lengkap" },
                { id: 2, name: "Laundry Kiloan", category: "service", price: 30000, status: "available", description: "Laundry per kg" },
                { id: 3, name: "Extra Bed", category: "other", price: 100000, status: "available", description: "Tempat tidur tambahan" },
                { id: 4, name: "Air Mineral", category: "beverage", price: 15000, status: "available", description: "Botol 600ml" }
            ];

            // Data pengguna default
            users = [
                { id: 1, username: "admin", name: "Administrator", role: "admin", password: "admin123", status: "active", lastLogin: null },
                { id: 2, username: "manager", name: "Manager Hotel", role: "manager", password: "manager123", status: "active", lastLogin: null },
                { id: 3, username: "staff", name: "Staff Reception", role: "staff", password: "staff123", status: "active", lastLogin: null }
            ];

            saveData();
        }

        // Fungsi untuk menyimpan data ke localStorage
        function saveData() {
            const data = {
                currentUser,
                rooms,
                guests,
                transactions,
                facilities,
                users,
                backups,
                settings
            };
            localStorage.setItem('hotelSystemData', JSON.stringify(data));
        }

        // Fungsi untuk memperbarui UI berdasarkan data
        function updateUI() {
            if (currentUser) {
                // Update UI untuk pengguna yang login
                $('#current-user-role').text(currentUser.role.toUpperCase());
                $('#current-user-role').removeClass('bg-secondary bg-admin bg-supervisor bg-manager bg-staff');
                
                // Set warna badge berdasarkan role
                switch(currentUser.role) {
                    case 'admin':
                        $('#current-user-role').addClass('bg-admin');
                        break;
                    case 'supervisor':
                        $('#current-user-role').addClass('bg-supervisor');
                        break;
                    case 'manager':
                        $('#current-user-role').addClass('bg-manager');
                        break;
                    case 'staff':
                        $('#current-user-role').addClass('bg-staff');
                        break;
                    default:
                        $('#current-user-role').addClass('bg-secondary');
                }

                // Sembunyikan modal login
                $('#loginModal').modal('hide');

                // Update dashboard stats
                updateDashboardStats();
            } else {
                // Tampilkan modal login jika tidak ada user yang login
                $('#loginModal').modal({backdrop: 'static', keyboard: false});
            }
        }

        // Fungsi untuk memperbarui statistik dashboard
        function updateDashboardStats() {
            // Hitung tamu hari ini
            const today = new Date().toISOString().split('T')[0];
            const todayGuests = guests.filter(guest => 
                guest.checkInDate && guest.checkInDate.split('T')[0] === today
            ).length;
            $('#today-guests').text(todayGuests);

            // Hitung kamar terisi
            const occupiedRooms = rooms.filter(room => 
                room.status === 'occupied'
            ).length;
            $('#occupied-rooms').text(occupiedRooms);
            $('#total-rooms').text(rooms.length);

            // Hitung pendapatan hari ini
            const todayTransactions = transactions.filter(transaction => 
                transaction.date && transaction.date.split('T')[0] === today
            );
            const todayIncome = todayTransactions.reduce((sum, transaction) => 
                sum + (transaction.amount || 0), 0
            );
            $('#today-income').text(formatCurrency(todayIncome));

            // Hitung karyawan aktif
            const activeStaff = users.filter(user => 
                user.status === 'active'
            ).length;
            $('#active-staff').text(activeStaff);

            // Update shift
            updateShiftIndicator();
        }

        // Fungsi untuk memperbarui indikator shift
        function updateShiftIndicator() {
            const now = new Date();
            const hours = now.getHours();
            let shift = '';
            
            if (hours >= 7 && hours < 15) {
                shift = 'Pagi (07:00-15:00)';
            } else if (hours >= 15 && hours < 23) {
                shift = 'Sore (15:00-23:00)';
            } else {
                shift = 'Malam (23:00-07:00)';
            }
            
            $('#current-shift').text(shift);
            $('#footer-shift').text(shift);
        }

        // Fungsi untuk memformat mata uang
        function formatCurrency(amount) {
            return 'Rp ' + (amount || 0).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        // Fungsi untuk menampilkan notifikasi
        function showNotification(type, message) {
            const alertClass = {
                success: 'alert-success',
                error: 'alert-danger',
                warning: 'alert-warning',
                info: 'alert-info'
            }[type] || 'alert-info';

            const notification = `
                <div class="alert ${alertClass} alert-dismissible fade show" role="alert">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            `;
            
            // Tambahkan notifikasi ke bagian atas konten utama
            $('.main-content').prepend(notification);
            
            // Hilangkan notifikasi setelah 5 detik
            setTimeout(() => {
                $('.alert').alert('close');
            }, 5000);
        }

        // Event handler untuk form login
        $('#login-form').submit(function(e) {
            e.preventDefault();
            
            const username = $('#login-username').val();
            const password = $('#login-password').val();
            
            // Cari user yang sesuai
            const user = users.find(u => 
                u.username === username && u.password === password
            );
            
            if (user) {
                if (user.status === 'active') {
                    currentUser = user;
                    
                    // Update last login
                    user.lastLogin = new Date().toISOString();
                    saveData();
                    
                    // Update UI
                    updateUI();
                    
                    // Reset form
                    $('#login-form')[0].reset();
                } else {
                    showNotification('error', 'Akun ini tidak aktif');
                }
            } else {
                showNotification('error', 'Username atau password salah');
            }
        });

        // Event handler untuk logout
        $('#logout-tab').click(function() {
            currentUser = null;
            saveData();
            updateUI();
            
            // Reset semua tab ke dashboard
            $('.tab-content').addClass('d-none');
            $('#dashboard-content').removeClass('d-none');
            $('.nav-link').removeClass('active');
            $('#dashboard-tab').addClass('active');
        });

        // Event handler untuk navigasi tab
        $('.nav-link').click(function(e) {
            e.preventDefault();
            
            const tabId = $(this).attr('id');
            
            // Jika belum login, tampilkan pesan
            if (!currentUser && tabId !== 'login-tab') {
                showNotification('error', 'Silakan login terlebih dahulu');
                return;
            }
            
            // Jika bukan admin, cek apakah tab memerlukan akses admin
            if (currentUser && currentUser.role !== 'admin' && $(this).hasClass('admin')) {
                showNotification('error', 'Anda tidak memiliki akses ke fitur ini');
                return;
            }
            
            // Jika bukan supervisor, cek apakah tab memerlukan akses supervisor
            if (currentUser && currentUser.role !== 'supervisor' && $(this).hasClass('supervisor')) {
                showNotification('error', 'Anda tidak memiliki akses ke fitur ini');
                return;
            }
            
            // Jika bukan manager, cek apakah tab memerlukan akses manager
            if (currentUser && currentUser.role !== 'manager' && $(this).hasClass('manager')) {
                showNotification('error', 'Anda tidak memiliki akses ke fitur ini');
                return;
            }
            
            // Sembunyikan semua konten tab
            $('.tab-content').addClass('d-none');
            
            // Tampilkan konten tab yang dipilih
            const contentId = tabId.replace('-tab', '-content');
            $(`#${contentId}`).removeClass('d-none');
            
            // Update active nav link
            $('.nav-link').removeClass('active');
            $(this).addClass('active');
            
            // Load data spesifik tab jika diperlukan
            switch(contentId) {
                case 'checkin-content':
                    loadCheckInForm();
                    break;
                case 'checkout-content':
                    loadCheckOutList();
                    break;
                case 'transaksi-content':
                    loadTransactions();
                    break;
                case 'nota-content':
                    loadInvoiceGuests();
                    break;
                case 'kamar-content':
                    loadRooms();
                    break;
                case 'fasilitas-content':
                    loadFacilities();
                    break;
                case 'tamu-content':
                    loadGuests();
                    break;
                case 'laporan-content':
                    initReportForm();
                    break;
                case 'backup-content':
                    loadBackupHistory();
                    break;
                case 'admin-content':
                    // Tidak perlu load data khusus
                    break;
            }
        });

        // Fungsi untuk memuat form check-in
        function loadCheckInForm() {
            // Kosongkan dan isi dropdown kamar
            $('#checkin-room').empty().append('<option value="">Pilih Kamar</option>');
            
            rooms.filter(room => room.status === 'available').forEach(room => {
                $('#checkin-room').append(
                    `<option value="${room.id}" data-price="${room.price}">${room.number} (${room.type.toUpperCase()}) - ${formatCurrency(room.price)}/hari</option>`
                );
            });
            
            // Kosongkan dan isi layanan tambahan
            $('#additional-services-container').empty();
            settings.additionalServices.forEach(service => {
                $('#additional-services-container').append(`
                    <div class="form-check">
                        <input class="form-check-input service-checkbox" type="checkbox" value="${service.id}" id="service-${service.id}">
                        <label class="form-check-label" for="service-${service.id}">
                            ${service.name} (${formatCurrency(service.price)})
                        </label>
                    </div>
                `);
            });
            
            // Event handler untuk menghitung total biaya
            $('#checkin-duration, #checkin-room').on('change input', calculateCheckInTotal);
            $('.service-checkbox').on('change', calculateCheckInTotal);
            
            // Load daftar tamu hari ini
            loadTodayGuests();
        }

        // Fungsi untuk menghitung total biaya check-in
        function calculateCheckInTotal() {
            const duration = parseInt($('#checkin-duration').val()) || 0;
            const roomId = $('#checkin-room').val();
            const roomPrice = roomId ? parseInt($('#checkin-room option:selected').data('price')) : 0;
            
            // Hitung biaya layanan tambahan
            let servicesTotal = 0;
            $('.service-checkbox:checked').each(function() {
                const serviceId = parseInt($(this).val());
                const service = settings.additionalServices.find(s => s.id === serviceId);
                if (service) {
                    servicesTotal += service.price * duration;
                }
            });
            
            const total = (roomPrice * duration) + servicesTotal;
            $('#checkin-total').text(formatCurrency(total));
        }

        // Fungsi untuk memuat daftar tamu hari ini
        function loadTodayGuests() {
            const today = new Date().toISOString().split('T')[0];
            const todayGuests = guests.filter(guest => 
                guest.checkInDate && guest.checkInDate.split('T')[0] === today
            );
            
            $('#today-guests-list').empty();
            
            if (todayGuests.length === 0) {
                $('#today-guests-list').append(
                    '<tr><td colspan="7" class="text-center">Tidak ada tamu check-in hari ini</td></tr>'
                );
            } else {
                todayGuests.forEach((guest, index) => {
                    const room = rooms.find(r => r.id === guest.roomId);
                    $('#today-guests-list').append(`
                        <tr>
                            <td>${index + 1}</td>
                            <td>${guest.name}</td>
                            <td>${room ? room.number : '-'}</td>
                            <td>${formatDate(guest.checkInDate)}</td>
                            <td>${formatDate(guest.checkOutDate)}</td>
                            <td><span class="badge bg-success">Check-In</span></td>
                            <td>
                                <button class="btn btn-sm btn-info view-guest-btn" data-id="${guest.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </td>
                        </tr>
                    `);
                });
            }
        }

        // Fungsi untuk memformat tanggal
        function formatDate(dateString) {
            if (!dateString) return '-';
            
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Event handler untuk form check-in
        $('#checkin-form').submit(function(e) {
            e.preventDefault();
            
            // Validasi form
            const name = $('#checkin-name').val();
            const identity = $('#checkin-identity').val();
            const phone = $('#checkin-phone').val();
            const roomId = $('#checkin-room').val();
            const duration = $('#checkin-duration').val();
            const notes = $('#checkin-notes').val();
            
            if (!name || !identity || !phone || !roomId || !duration) {
                showNotification('error', 'Harap isi semua field yang wajib diisi');
                return;
            }
            
            // Dapatkan data kamar
            const room = rooms.find(r => r.id === parseInt(roomId));
            if (!room || room.status !== 'available') {
                showNotification('error', 'Kamar tidak tersedia');
                return;
            }
            
            // Hitung total biaya
            const roomPrice = room.price;
            let servicesTotal = 0;
            const selectedServices = [];
            
            $('.service-checkbox:checked').each(function() {
                const serviceId = parseInt($(this).val());
                const service = settings.additionalServices.find(s => s.id === serviceId);
                if (service) {
                    servicesTotal += service.price * parseInt(duration);
                    selectedServices.push({
                        id: service.id,
                        name: service.name,
                        price: service.price,
                        quantity: parseInt(duration)
                    });
                }
            });
            
            const subtotal = (roomPrice * parseInt(duration)) + servicesTotal;
            const tax = subtotal * (settings.taxRate / 100);
            const total = subtotal + tax;
            
            // Buat data tamu baru
            const now = new Date();
            const checkInDate = now.toISOString();
            
            const checkOutDate = new Date(now);
            checkOutDate.setDate(checkOutDate.getDate() + parseInt(duration));
            const checkOutDateStr = checkOutDate.toISOString();
            
            const newGuest = {
                id: guests.length > 0 ? Math.max(...guests.map(g => g.id)) + 1 : 1,
                name,
                identity,
                phone,
                roomId: parseInt(roomId),
                checkInDate,
                checkOutDate: checkOutDateStr,
                duration: parseInt(duration),
                services: selectedServices,
                subtotal,
                tax,
                total,
                status: 'checked-in',
                notes,
                createdBy: currentUser.id,
                createdAt: checkInDate
            };
            
            // Tambahkan tamu ke daftar
            guests.push(newGuest);
            
            // Update status kamar
            room.status = 'occupied';
            
            // Simpan data
            saveData();
            
            // Reset form
            $('#checkin-form')[0].reset();
            $('#checkin-total').text('Rp 0');
            
            // Update UI
            loadTodayGuests();
            updateDashboardStats();
            
            showNotification('success', 'Check-in tamu berhasil');
        });

        // Fungsi untuk memuat daftar tamu yang perlu check-out
        function loadCheckOutList() {
            const checkedInGuests = guests.filter(guest => 
                guest.status === 'checked-in'
            );
            
            $('#checkout-guests-list').empty();
            
            if (checkedInGuests.length === 0) {
                $('#checkout-guests-list').append(
                    '<tr><td colspan="7" class="text-center">Tidak ada tamu yang sedang menginap</td></tr>'
                );
            } else {
                checkedInGuests.forEach((guest, index) => {
                    const room = rooms.find(r => r.id === guest.roomId);
                    $('#checkout-guests-list').append(`
                        <tr>
                            <td>${index + 1}</td>
                            <td>${guest.name}</td>
                            <td>${guest.identity}</td>
                            <td>${room ? room.number : '-'}</td>
                            <td>${formatDate(guest.checkInDate)}</td>
                            <td>${formatDate(guest.checkOutDate)}</td>
                            <td>
                                <button class="btn btn-sm btn-primary checkout-btn" data-id="${guest.id}">
                                    <i class="fas fa-sign-out-alt"></i> Check-Out
                                </button>
                            </td>
                        </tr>
                    `);
                });
            }
        }

        // Event handler untuk tombol check-out
        $(document).on('click', '.checkout-btn', function() {
            const guestId = parseInt($(this).data('id'));
            const guest = guests.find(g => g.id === guestId);
            
            if (guest) {
                // Tampilkan modal pembayaran
                $('#payment-total').text(formatCurrency(guest.total));
                $('#paymentModal').modal('show');
                
                // Simpan ID tamu di modal
                $('#paymentModal').data('guestId', guestId);
            }
        });

        // Event handler untuk metode pembayaran
        $('input[name="payment-method"]').change(function() {
            // Sembunyikan semua detail pembayaran
            $('.payment-details').removeClass('active');
            
            // Tampilkan detail yang sesuai
            const method = $(this).val();
            $(`#${method}-details`).addClass('active');
            
            // Jika metode tunai, hitung kembalian
            if (method === 'cash') {
                calculateCashChange();
            }
        });

        // Fungsi untuk menghitung kembalian pembayaran tunai
        function calculateCashChange() {
            const totalText = $('#payment-total').text();
            const total = parseFloat(totalText.replace(/[^\d]/g, '')) || 0;
            const cashAmount = parseFloat($('#cash-amount').val()) || 0;
            const change = cashAmount - total;
            
            $('#cash-change').text(formatCurrency(change > 0 ? change : 0));
        }

        // Event handler untuk input uang tunai
        $('#cash-amount').on('input', calculateCashChange);

        // Event handler untuk konfirmasi pembayaran
        $('#confirm-payment').click(function() {
            const guestId = $('#paymentModal').data('guestId');
            const guest = guests.find(g => g.id === guestId);
            
            if (!guest) {
                showNotification('error', 'Data tamu tidak ditemukan');
                return;
            }
            
            const paymentMethod = $('input[name="payment-method"]:checked').val();
            let paymentDetails = {};
            
            // Kumpulkan detail pembayaran berdasarkan metode
            switch(paymentMethod) {
                case 'cash':
                    const cashAmount = parseFloat($('#cash-amount').val()) || 0;
                    if (cashAmount < guest.total) {
                        showNotification('error', 'Uang yang diterima kurang dari total pembayaran');
                        return;
                    }
                    
                    paymentDetails = {
                        amountReceived: cashAmount,
                        change: cashAmount - guest.total
                    };
                    break;
                    
                case 'transfer':
                    const bankName = $('#bank-name').val();
                    const accountNumber = $('#account-number').val();
                    const proofFile = $('#transfer-proof')[0].files[0];
                    
                    if (!bankName || !accountNumber || !proofFile) {
                        showNotification('error', 'Harap isi semua detail transfer');
                        return;
                    }
                    
                    paymentDetails = {
                        bankName,
                        accountNumber,
                        proof: proofFile.name
                    };
                    break;
                    
                case 'ewallet':
                    const provider = $('#ewallet-provider').val();
                    const phoneNumber = $('#ewallet-number').val();
                    
                    if (!phoneNumber) {
                        showNotification('error', 'Harap isi nomor telepon e-wallet');
                        return;
                    }
                    
                    paymentDetails = {
                        provider,
                        phoneNumber
                    };
                    break;
                    
                case 'qris':
                    paymentDetails = {
                        qrCode: 'hotelpayment'
                    };
                    break;
            }
            
            // Update status tamu
            guest.status = 'checked-out';
            guest.paymentMethod = paymentMethod;
            guest.paymentDetails = paymentDetails;
            guest.checkedOutBy = currentUser.id;
            guest.checkedOutAt = new Date().toISOString();
            
            // Kembalikan status kamar
            const room = rooms.find(r => r.id === guest.roomId);
            if (room) {
                room.status = 'available';
            }
            
            // Simpan transaksi
            const transaction = {
                id: transactions.length > 0 ? Math.max(...transactions.map(t => t.id)) + 1 : 1,
                guestId: guest.id,
                type: 'room',
                amount: guest.total,
                quantity: 1,
                notes: 'Pembayaran kamar dan layanan',
                date: new Date().toISOString(),
                createdBy: currentUser.id
            };
            
            transactions.push(transaction);
            
            // Simpan data
            saveData();
            
            // Tutup modal
            $('#paymentModal').modal('hide');
            
            // Update UI
            loadCheckOutList();
            updateDashboardStats();
            
            showNotification('success', 'Check-out tamu berhasil');
            
            // Tampilkan nota
            generateInvoice(guest.id);
            $('#nota-tab').click();
        });

        // Fungsi untuk memuat transaksi
        function loadTransactions() {
            // Kosongkan dan isi dropdown tamu
            $('#transaction-guest').empty().append('<option value="">Pilih Tamu</option>');
            
            guests.filter(guest => guest.status === 'checked-in').forEach(guest => {
                const room = rooms.find(r => r.id === guest.roomId);
                $('#transaction-guest').append(
                    `<option value="${guest.id}">${guest.name} (Kamar: ${room ? room.number : '-'})</option>`
                );
            });
            
            // Kosongkan dan isi dropdown fasilitas
            $('#transaction-facility').empty().append('<option value="">Pilih Fasilitas</option>');
            
            facilities.filter(f => f.status === 'available').forEach(facility => {
                $('#transaction-facility').append(
                    `<option value="${facility.id}" data-price="${facility.price}">${facility.name} (${formatCurrency(facility.price)})</option>`
                );
            });
            
            // Event handler untuk jenis transaksi
            $('#transaction-type').change(function() {
                if ($(this).val() === 'facility') {
                    $('#facility-select-container').show();
                } else {
                    $('#facility-select-container').hide();
                }
            });
            
            // Event handler untuk fasilitas
            $('#transaction-facility').change(function() {
                const facilityId = $(this).val();
                if (facilityId) {
                    const price = parseFloat($('#transaction-facility option:selected').data('price'));
                    $('#transaction-amount').val(price);
                    calculateTransactionSubtotal();
                }
            });
            
            // Event handler untuk hitung subtotal
            $('#transaction-amount, #transaction-quantity').on('input', calculateTransactionSubtotal);
            
            // Load daftar transaksi
            filterTransactions();
        }

        // Fungsi untuk menghitung subtotal transaksi
        function calculateTransactionSubtotal() {
            const amount = parseFloat($('#transaction-amount').val()) || 0;
            const quantity = parseInt($('#transaction-quantity').val()) || 1;
            const subtotal = amount * quantity;
            
            $('#transaction-subtotal').text(formatCurrency(subtotal));
        }

        // Fungsi untuk memfilter transaksi
        function filterTransactions() {
            const dateFilter = $('#transaction-date-filter').val();
            const typeFilter = $('#transaction-type-filter').val();
            
            let filteredTransactions = [...transactions];
            
            if (dateFilter) {
                filteredTransactions = filteredTransactions.filter(t => 
                    t.date && t.date.split('T')[0] === dateFilter
                );
            }
            
            if (typeFilter) {
                filteredTransactions = filteredTransactions.filter(t => 
                    t.type === typeFilter
                );
            }
            
            // Tampilkan transaksi yang difilter
            displayTransactions(filteredTransactions);
        }

        // Fungsi untuk menampilkan transaksi
        function displayTransactions(transactionsToDisplay) {
            $('#transactions-list').empty();
            
            if (transactionsToDisplay.length === 0) {
                $('#transactions-list').append(
                    '<tr><td colspan="8" class="text-center">Tidak ada transaksi</td></tr>'
                );
            } else {
                transactionsToDisplay.forEach((transaction, index) => {
                    const guest = guests.find(g => g.id === transaction.guestId);
                    const user = users.find(u => u.id === transaction.createdBy);
                    
                    $('#transactions-list').append(`
                        <tr>
                            <td>${index + 1}</td>
                            <td>${formatDate(transaction.date)}</td>
                            <td>${guest ? guest.name : '-'}</td>
                            <td>${getTransactionTypeName(transaction.type)}</td>
                            <td>${transaction.notes || '-'}</td>
                            <td>${formatCurrency(transaction.amount)}</td>
                            <td>${user ? user.name : '-'}</td>
                            <td>
                                <button class="btn btn-sm btn-danger delete-transaction-btn" data-id="${transaction.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `);
                });
            }
        }

        // Fungsi untuk mendapatkan nama jenis transaksi
        function getTransactionTypeName(type) {
            const types = {
                'room': 'Biaya Kamar',
                'food': 'Makanan & Minuman',
                'facility': 'Fasilitas',
                'laundry': 'Laundry',
                'other': 'Lainnya'
            };
            
            return types[type] || type;
        }

        // Event handler untuk filter transaksi
        $('#filter-transactions').click(filterTransactions);

        // Event handler untuk form transaksi
        $('#transaction-form').submit(function(e) {
            e.preventDefault();
            
            // Validasi form
            const guestId = $('#transaction-guest').val();
            const type = $('#transaction-type').val();
            const amount = $('#transaction-amount').val();
            const quantity = $('#transaction-quantity').val();
            const notes = $('#transaction-notes').val();
            
            if (!guestId || !type || !amount) {
                showNotification('error', 'Harap isi semua field yang wajib diisi');
                return;
            }
            
            // Jika jenis fasilitas, validasi fasilitas dipilih
            if (type === 'facility' && !$('#transaction-facility').val()) {
                showNotification('error', 'Harap pilih fasilitas');
                return;
            }
            
            // Buat transaksi baru
            const newTransaction = {
                id: transactions.length > 0 ? Math.max(...transactions.map(t => t.id)) + 1 : 1,
                guestId: parseInt(guestId),
                type,
                amount: parseFloat(amount),
                quantity: parseInt(quantity) || 1,
                notes,
                date: new Date().toISOString(),
                createdBy: currentUser.id
            };
            
            // Tambahkan ke daftar transaksi
            transactions.push(newTransaction);
            
            // Simpan data
            saveData();
            
            // Reset form
            $('#transaction-form')[0].reset();
            $('#transaction-subtotal').text('Rp 0');
            $('#facility-select-container').hide();
            
            // Update UI
            filterTransactions();
            updateDashboardStats();
            
            showNotification('success', 'Transaksi berhasil disimpan');
        });

        // Event handler untuk hapus transaksi
        $(document).on('click', '.delete-transaction-btn', function() {
            const transactionId = parseInt($(this).data('id'));
            
            if (confirm('Apakah Anda yakin ingin menghapus transaksi ini?')) {
                // Hapus transaksi
                transactions = transactions.filter(t => t.id !== transactionId);
                
                // Simpan data
                saveData();
                
                // Update UI
                filterTransactions();
                updateDashboardStats();
                
                showNotification('success', 'Transaksi berhasil dihapus');
            }
        });

        // Fungsi untuk memuat tamu untuk nota
        function loadInvoiceGuests() {
            filterInvoiceGuests();
        }

        // Fungsi untuk memfilter tamu nota
        function filterInvoiceGuests() {
            const searchTerm = $('#invoice-search').val().toLowerCase();
            const dateFilter = $('#invoice-date-filter').val();
            
            let filteredGuests = [...guests];
            
            if (searchTerm) {
                filteredGuests = filteredGuests.filter(guest => 
                    (guest.name && guest.name.toLowerCase().includes(searchTerm)) ||
                    (guest.identity && guest.identity.includes(searchTerm)) ||
                    (rooms.find(r => r.id === guest.roomId)?.number.includes(searchTerm))
                );
            }
            
            if (dateFilter) {
                filteredGuests = filteredGuests.filter(guest => 
                    guest.checkInDate && guest.checkInDate.split('T')[0] === dateFilter
                );
            }
            
            // Tampilkan tamu yang difilter
            displayInvoiceGuests(filteredGuests);
        }

        // Fungsi untuk menampilkan tamu nota
        function displayInvoiceGuests(guestsToDisplay) {
            $('#invoice-guests-list').empty();
            
            if (guestsToDisplay.length === 0) {
                $('#invoice-guests-list').append(
                    '<tr><td colspan="5" class="text-center">Tidak ada tamu</td></tr>'
                );
            } else {
                guestsToDisplay.forEach(guest => {
                    const room = rooms.find(r => r.id === guest.roomId);
                    const statusBadge = guest.status === 'checked-in' ? 
                        '<span class="badge bg-success">Check-In</span>' : 
                        '<span class="badge bg-secondary">Check-Out</span>';
                    
                    $('#invoice-guests-list').append(`
                        <tr>
                            <td>${guest.name}</td>
                            <td>${guest.identity}</td>
                            <td>${room ? room.number : '-'}</td>
                            <td>${statusBadge}</td>
                            <td>
                                <button class="btn btn-sm btn-primary generate-invoice-btn" data-id="${guest.id}">
                                    <i class="fas fa-receipt"></i> Buat Nota
                                </button>
                            </td>
                        </tr>
                    `);
                });
            }
        }

        // Event handler untuk filter tamu nota
        $('#filter-invoice-guests').click(filterInvoiceGuests);

        // Event handler untuk tombol buat nota
        $(document).on('click', '.generate-invoice-btn', function() {
            const guestId = parseInt($(this).data('id'));
            generateInvoice(guestId);
        });

                // Fungsi untuk menghasilkan nota
        function generateInvoice(guestId) {
            const guest = guests.find(g => g.id === guestId);
            if (!guest) {
                showNotification('error', 'Data tamu tidak ditemukan');
                return;
            }
            
            const room = rooms.find(r => r.id === guest.roomId);
            const createdByUser = users.find(u => u.id === guest.createdBy);
            const checkedOutByUser = users.find(u => u.id === guest.checkedOutBy);
            
            // Update header hotel
            $('#hotel-name-header').text(settings.hotelName);
            $('#hotel-address-header').text(settings.hotelAddress);
            $('#hotel-contact-header').text(settings.hotelContact);
            
            // Update info nota
            const now = new Date();
            $('#invoice-number').text(`INV-${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2, '0')}${now.getDate().toString().padStart(2, '0')}-${guest.id}`);
            $('#invoice-date').text(formatDate(now.toISOString()));
            $('#invoice-cashier').text(currentUser.name);
            
            // Update info tamu
            $('#invoice-guest-name').text(guest.name);
            $('#invoice-room-number').text(room ? room.number : '-');
            $('#invoice-guest-id').text(guest.identity);
            
            // Generate barcode
            JsBarcode("#invoice-barcode", `HOTEL-${guest.id}`, {
                format: "CODE128",
                lineColor: "#2a4365",
                width: 2,
                height: 50,
                displayValue: true
            });
            
            // Isi item nota
            $('#invoice-items').empty();
            
            // Tambahkan biaya kamar
            $('#invoice-items').append(`
                <tr>
                    <td>1</td>
                    <td>Kamar ${room ? room.number : '-'} (${guest.duration} hari)</td>
                    <td>${guest.duration}</td>
                    <td>${formatCurrency(room ? room.price : 0)}</td>
                    <td>${formatCurrency((room ? room.price : 0) * guest.duration)}</td>
                </tr>
            `);
            
            // Tambahkan layanan tambahan
            let itemNumber = 2;
            if (guest.services && guest.services.length > 0) {
                guest.services.forEach(service => {
                    $('#invoice-items').append(`
                        <tr>
                            <td>${itemNumber++}</td>
                            <td>${service.name}</td>
                            <td>${service.quantity}</td>
                            <td>${formatCurrency(service.price)}</td>
                            <td>${formatCurrency(service.price * service.quantity)}</td>
                        </tr>
                    `);
                });
            }
            
            // Update total
            $('#invoice-subtotal').text(formatCurrency(guest.subtotal));
            $('#invoice-tax').text(formatCurrency(guest.tax));
            $('#invoice-total').text(formatCurrency(guest.total));
            
            // Update info pembayaran
            if (guest.paymentMethod) {
                const paymentMethods = {
                    'cash': 'Tunai',
                    'transfer': 'Transfer Bank',
                    'ewallet': 'E-Wallet',
                    'qris': 'QRIS'
                };
                
                $('#invoice-payment-method').text(paymentMethods[guest.paymentMethod] || guest.paymentMethod);
                
                if (guest.paymentMethod === 'cash' && guest.paymentDetails) {
                    $('#invoice-amount-paid').text(formatCurrency(guest.paymentDetails.amountReceived));
                    $('#invoice-change').text(formatCurrency(guest.paymentDetails.change));
                } else {
                    $('#invoice-amount-paid').text(formatCurrency(guest.total));
                    $('#invoice-change').text('Rp 0');
                }
            } else {
                $('#invoice-payment-method').text('-');
                $('#invoice-amount-paid').text('Rp 0');
                $('#invoice-change').text('Rp 0');
            }
            
            // Simpan ID tamu di form
            $('#invoice-guest').val(guest.id);
            
            // Tampilkan container nota
            $('#invoice-container').removeClass('d-none');
        }
        
        // Event handler untuk cetak nota
        $('#print-invoice').click(function() {
            window.print();
        });
        
        // Event handler untuk download PDF nota
        $('#download-invoice-pdf').click(function() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Tambahkan konten nota ke PDF
            doc.html($('.nota-container')[0], {
                callback: function(doc) {
                    doc.save('nota-hotel.pdf');
                },
                x: 10,
                y: 10,
                width: 190,
                windowWidth: $('.nota-container').width()
            });
        });
        
        // Event handler untuk simpan nota
        $('#save-invoice').click(function() {
            showNotification('success', 'Nota berhasil disimpan');
        });
        
        // Fungsi untuk memuat data kamar
        function loadRooms() {
            $('#rooms-list').empty();
            
            if (rooms.length === 0) {
                $('#rooms-list').append(
                    '<tr><td colspan="6" class="text-center">Tidak ada data kamar</td></tr>'
                );
            } else {
                rooms.forEach((room, index) => {
                    let statusBadge = '';
                    switch(room.status) {
                        case 'available':
                            statusBadge = '<span class="badge bg-success">Tersedia</span>';
                            break;
                        case 'occupied':
                            statusBadge = '<span class="badge bg-danger">Terisi</span>';
                            break;
                        case 'maintenance':
                            statusBadge = '<span class="badge bg-warning">Perbaikan</span>';
                            break;
                        default:
                            statusBadge = '<span class="badge bg-secondary">' + room.status + '</span>';
                    }
                    
                    $('#rooms-list').append(`
                        <tr>
                            <td>${index + 1}</td>
                            <td>${room.number}</td>
                            <td>${room.type.charAt(0).toUpperCase() + room.type.slice(1)}</td>
                            <td>${formatCurrency(room.price)}</td>
                            <td>${statusBadge}</td>
                            <td>
                                <button class="btn btn-sm btn-primary edit-room-btn" data-id="${room.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger delete-room-btn" data-id="${room.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `);
                });
            }
        }
        
        // Event handler untuk tombol tambah kamar
        $('#add-room-btn').click(function() {
            $('#roomModalTitle').text('Tambah Kamar Baru');
            $('#room-form')[0].reset();
            $('#room-id').val('');
            $('#roomModal').modal('show');
        });
        
        // Event handler untuk tombol edit kamar
        $(document).on('click', '.edit-room-btn', function() {
            const roomId = parseInt($(this).data('id'));
            const room = rooms.find(r => r.id === roomId);
            
            if (room) {
                $('#roomModalTitle').text('Edit Kamar');
                $('#room-id').val(room.id);
                $('#room-number').val(room.number);
                $('#room-type').val(room.type);
                $('#room-price').val(room.price);
                $('#room-status').val(room.status);
                $('#room-notes').val(room.notes);
                $('#roomModal').modal('show');
            }
        });
        
        // Event handler untuk tombol simpan kamar
        $('#save-room').click(function() {
            const id = $('#room-id').val();
            const number = $('#room-number').val();
            const type = $('#room-type').val();
            const price = $('#room-price').val();
            const status = $('#room-status').val();
            const notes = $('#room-notes').val();
            
            if (!number || !type || !price || !status) {
                showNotification('error', 'Harap isi semua field yang wajib diisi');
                return;
            }
            
            if (id) {
                // Edit kamar yang ada
                const roomIndex = rooms.findIndex(r => r.id === parseInt(id));
                if (roomIndex !== -1) {
                    rooms[roomIndex] = {
                        ...rooms[roomIndex],
                        number,
                        type,
                        price: parseFloat(price),
                        status,
                        notes
                    };
                }
            } else {
                // Tambah kamar baru
                const newRoom = {
                    id: rooms.length > 0 ? Math.max(...rooms.map(r => r.id)) + 1 : 1,
                    number,
                    type,
                    price: parseFloat(price),
                    status,
                    notes
                };
                rooms.push(newRoom);
            }
            
            // Simpan data
            saveData();
            
            // Tutup modal
            $('#roomModal').modal('hide');
            
            // Update UI
            loadRooms();
            
            showNotification('success', 'Data kamar berhasil disimpan');
        });
        
        // Event handler untuk tombol hapus kamar
        $(document).on('click', '.delete-room-btn', function() {
            const roomId = parseInt($(this).data('id'));
            
            // Cek apakah kamar sedang digunakan
            const isOccupied = guests.some(g => g.roomId === roomId && g.status === 'checked-in');
            
            if (isOccupied) {
                showNotification('error', 'Kamar tidak dapat dihapus karena sedang digunakan');
                return;
            }
            
            if (confirm('Apakah Anda yakin ingin menghapus kamar ini?')) {
                // Hapus kamar
                rooms = rooms.filter(r => r.id !== roomId);
                
                // Simpan data
                saveData();
                
                // Update UI
                loadRooms();
                
                showNotification('success', 'Kamar berhasil dihapus');
            }
        });
        
        // Fungsi untuk memuat data fasilitas
        function loadFacilities() {
            $('#facilities-list').empty();
            
            if (facilities.length === 0) {
                $('#facilities-list').append(
                    '<tr><td colspan="7" class="text-center">Tidak ada data fasilitas</td></tr>'
                );
            } else {
                facilities.forEach((facility, index) => {
                    const statusBadge = facility.status === 'available' ? 
                        '<span class="badge bg-success">Tersedia</span>' : 
                        '<span class="badge bg-secondary">Tidak Tersedia</span>';
                    
                    const categoryNames = {
                        'food': 'Makanan',
                        'beverage': 'Minuman',
                        'service': 'Layanan',
                        'other': 'Lainnya'
                    };
                    
                    $('#facilities-list').append(`
                        <tr>
                            <td>${index + 1}</td>
                            <td>${facility.name}</td>
                            <td>${categoryNames[facility.category] || facility.category}</td>
                            <td>${formatCurrency(facility.price)}</td>
                            <td>${statusBadge}</td>
                            <td>${facility.description || '-'}</td>
                            <td>
                                <button class="btn btn-sm btn-primary edit-facility-btn" data-id="${facility.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger delete-facility-btn" data-id="${facility.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `);
                });
            }
        }
        
        // Event handler untuk tombol tambah fasilitas
        $('#add-facility-btn').click(function() {
            $('#facilityModalTitle').text('Tambah Fasilitas Baru');
            $('#facility-form')[0].reset();
            $('#facility-id').val('');
            $('#facility-available').prop('checked', true);
            $('#facilityModal').modal('show');
        });
        
        // Event handler untuk tombol edit fasilitas
        $(document).on('click', '.edit-facility-btn', function() {
            const facilityId = parseInt($(this).data('id'));
            const facility = facilities.find(f => f.id === facilityId);
            
            if (facility) {
                $('#facilityModalTitle').text('Edit Fasilitas');
                $('#facility-id').val(facility.id);
                $('#facility-name').val(facility.name);
                $('#facility-category').val(facility.category);
                $('#facility-price').val(facility.price);
                $(`#facility-${facility.status}`).prop('checked', true);
                $('#facility-description').val(facility.description);
                $('#facilityModal').modal('show');
            }
        });
        
        // Event handler untuk tombol simpan fasilitas
        $('#save-facility').click(function() {
            const id = $('#facility-id').val();
            const name = $('#facility-name').val();
            const category = $('#facility-category').val();
            const price = $('#facility-price').val();
            const status = $('input[name="facility-status"]:checked').val();
            const description = $('#facility-description').val();
            
            if (!name || !category || !price || !status) {
                showNotification('error', 'Harap isi semua field yang wajib diisi');
                return;
            }
            
            if (id) {
                // Edit fasilitas yang ada
                const facilityIndex = facilities.findIndex(f => f.id === parseInt(id));
                if (facilityIndex !== -1) {
                    facilities[facilityIndex] = {
                        ...facilities[facilityIndex],
                        name,
                        category,
                        price: parseFloat(price),
                        status,
                        description
                    };
                }
            } else {
                // Tambah fasilitas baru
                const newFacility = {
                    id: facilities.length > 0 ? Math.max(...facilities.map(f => f.id)) + 1 : 1,
                    name,
                    category,
                    price: parseFloat(price),
                    status,
                    description
                };
                facilities.push(newFacility);
            }
            
            // Simpan data
            saveData();
            
            // Tutup modal
            $('#facilityModal').modal('hide');
            
            // Update UI
            loadFacilities();
            
            showNotification('success', 'Data fasilitas berhasil disimpan');
        });
        
        // Event handler untuk tombol hapus fasilitas
        $(document).on('click', '.delete-facility-btn', function() {
            const facilityId = parseInt($(this).data('id'));
            
            if (confirm('Apakah Anda yakin ingin menghapus fasilitas ini?')) {
                // Hapus fasilitas
                facilities = facilities.filter(f => f.id !== facilityId);
                
                // Simpan data
                saveData();
                
                // Update UI
                loadFacilities();
                
                showNotification('success', 'Fasilitas berhasil dihapus');
            }
        });
        
        // Fungsi untuk memuat data tamu
        function loadGuests() {
            filterGuests();
        }
        
        // Fungsi untuk memfilter tamu
        function filterGuests() {
            const searchTerm = $('#guest-search').val().toLowerCase();
            const statusFilter = $('#guest-status-filter').val();
            
            let filteredGuests = [...guests];
            
            if (searchTerm) {
                filteredGuests = filteredGuests.filter(guest => 
                    (guest.name && guest.name.toLowerCase().includes(searchTerm)) ||
                    (guest.identity && guest.identity.includes(searchTerm)) ||
                    (guest.phone && guest.phone.includes(searchTerm))
                );
            }
            
            if (statusFilter) {
                filteredGuests = filteredGuests.filter(guest => 
                    guest.status === statusFilter
                );
            }
            
            // Tampilkan tamu yang difilter
            displayGuests(filteredGuests);
        }
        
        // Fungsi untuk menampilkan tamu
        function displayGuests(guestsToDisplay) {
            $('#guests-list').empty();
            
            if (guestsToDisplay.length === 0) {
                $('#guests-list').append(
                    '<tr><td colspan="7" class="text-center">Tidak ada data tamu</td></tr>'
                );
            } else {
                guestsToDisplay.forEach((guest, index) => {
                    const room = rooms.find(r => r.id === guest.roomId);
                    const statusBadge = guest.status === 'checked-in' ? 
                        '<span class="badge bg-success">Check-In</span>' : 
                        '<span class="badge bg-secondary">Check-Out</span>';
                    
                    $('#guests-list').append(`
                        <tr>
                            <td>${index + 1}</td>
                            <td>${guest.name}</td>
                            <td>${guest.identity}</td>
                            <td>${guest.phone}</td>
                            <td>${room ? room.number : '-'}</td>
                            <td>${statusBadge}</td>
                            <td>
                                <button class="btn btn-sm btn-info view-guest-btn" data-id="${guest.id}">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </td>
                        </tr>
                    `);
                });
            }
        }
        
        // Event handler untuk filter tamu
        $('#filter-guests').click(filterGuests);
        
        // Event handler untuk tombol lihat detail tamu
        $(document).on('click', '.view-guest-btn', function() {
            const guestId = parseInt($(this).data('id'));
            const guest = guests.find(g => g.id === guestId);
            
            if (guest) {
                // Tampilkan modal detail tamu
                // (Implementasi modal detail tamu bisa ditambahkan di sini)
                showNotification('info', `Melihat detail tamu: ${guest.name}`);
            }
        });
        
        // Fungsi untuk inisialisasi form laporan
        function initReportForm() {
            // Set tanggal default ke hari ini
            $('#report-date').val(new Date().toISOString().split('T')[0]);
            
            // Event handler untuk jenis laporan
            $('#report-type').change(function() {
                const type = $(this).val();
                
                // Sembunyikan semua container
                $('#report-date-container, #report-week-container, #report-month-container, #report-custom-container').addClass('d-none');
                
                // Tampilkan container yang sesuai
                switch(type) {
                    case 'daily':
                        $('#report-date-container').removeClass('d-none');
                        break;
                    case 'weekly':
                        $('#report-week-container').removeClass('d-none');
                        break;
                    case 'monthly':
                        $('#report-month-container').removeClass('d-none');
                        break;
                    case 'custom':
                        $('#report-custom-container').removeClass('d-none');
                        break;
                }
            });
            
            // Sembunyikan hasil laporan
            $('#report-result').addClass('d-none');
            $('#report-empty').removeClass('d-none');
        }
        
        // Event handler untuk generate laporan
        $('#generate-report').click(function() {
            const type = $('#report-type').val();
            const category = $('#report-category').val();
            
            let filteredTransactions = [...transactions];
            
            // Filter berdasarkan rentang waktu
            switch(type) {
                case 'daily':
                    const date = $('#report-date').val();
                    if (date) {
                        filteredTransactions = filteredTransactions.filter(t => 
                            t.date && t.date.split('T')[0] === date
                        );
                    }
                    break;
                    
                case 'weekly':
                    const week = $('#report-week').val();
                    if (week) {
                        const [year, weekNum] = week.split('-W');
                        const startDate = getDateOfWeek(parseInt(weekNum), parseInt(year));
                        const endDate = new Date(startDate);
                        endDate.setDate(endDate.getDate() + 6);
                        
                        filteredTransactions = filteredTransactions.filter(t => {
                            if (!t.date) return false;
                            const transDate = new Date(t.date);
                            return transDate >= startDate && transDate <= endDate;
                        });
                    }
                    break;
                    
                case 'monthly':
                    const month = $('#report-month').val();
                    if (month) {
                        const [year, monthNum] = month.split('-');
                        const startDate = new Date(parseInt(year), parseInt(monthNum) - 1, 1);
                        const endDate = new Date(parseInt(year), parseInt(monthNum), 0);
                        
                        filteredTransactions = filteredTransactions.filter(t => {
                            if (!t.date) return false;
                            const transDate = new Date(t.date);
                            return transDate >= startDate && transDate <= endDate;
                        });
                    }
                    break;
                    
                case 'custom':
                    const startDate = $('#report-start-date').val();
                    const endDate = $('#report-end-date').val();
                    
                    if (startDate && endDate) {
                        const start = new Date(startDate);
                        const end = new Date(endDate);
                        
                        filteredTransactions = filteredTransactions.filter(t => {
                            if (!t.date) return false;
                            const transDate = new Date(t.date.split('T')[0]);
                            return transDate >= start && transDate <= end;
                        });
                    }
                    break;
            }
            
            // Filter berdasarkan kategori
            if (category !== 'all') {
                filteredTransactions = filteredTransactions.filter(t => t.type === category);
            }
            
            // Generate laporan
            generateReport(filteredTransactions, type);
        });
        
        // Fungsi untuk mendapatkan tanggal awal dari minggu tertentu
        function getDateOfWeek(week, year) {
            const date = new Date(year, 0, 1);
            const dayOffset = date.getDay() === 0 ? 0 : 7 - date.getDay();
            date.setDate(1 + dayOffset + (week - 1) * 7);
            return date;
        }
        
        // Fungsi untuk menghasilkan laporan
        function generateReport(transactions, type) {
            $('#report-content').empty();
            
            if (transactions.length === 0) {
                $('#report-result').addClass('d-none');
                $('#report-empty').removeClass('d-none');
                return;
            }
            
            // Hitung total pendapatan
            const totalIncome = transactions.reduce((sum, t) => sum + t.amount, 0);
            
            // Hitung jumlah transaksi per kategori
            const categories = {};
            transactions.forEach(t => {
                if (!categories[t.type]) {
                    categories[t.type] = 0;
                }
                categories[t.type] += t.amount;
            });
            
            // Buat konten laporan
            let reportDate = '';
            switch(type) {
                case 'daily':
                    reportDate = `Tanggal: ${$('#report-date').val()}`;
                    break;
                case 'weekly':
                    reportDate = `Minggu: ${$('#report-week').val()}`;
                    break;
                case 'monthly':
                    reportDate = `Bulan: ${$('#report-month').val()}`;
                    break;
                case 'custom':
                    reportDate = `Periode: ${$('#report-start-date').val()} s/d ${$('#report-end-date').val()}`;
                    break;
            }
            
            $('#report-content').append(`
                <h4 class="text-center mb-4">Laporan Transaksi Hotel</h4>
                <p class="text-center">${reportDate}</p>
                <p class="text-center">Kategori: ${$('#report-category').val() === 'all' ? 'Semua' : getTransactionTypeName($('#report-category').val())}</p>
                
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Ringkasan</h5>
                                <p>Total Transaksi: ${transactions.length}</p>
                                <p>Total Pendapatan: ${formatCurrency(totalIncome)}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title">Per Kategori</h5>
                                ${Object.entries(categories).map(([type, amount]) => `
                                    <p>${getTransactionTypeName(type)}: ${formatCurrency(amount)}</p>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>No.</th>
                                <th>Tanggal</th>
                                <th>Tamu</th>
                                <th>Jenis</th>
                                <th>Keterangan</th>
                                <th>Jumlah</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${transactions.map((t, index) => {
                                const guest = guests.find(g => g.id === t.guestId);
                                return `
                                    <tr>
                                        <td>${index + 1}</td>
                                        <td>${formatDate(t.date)}</td>
                                        <td>${guest ? guest.name : '-'}</td>
                                        <td>${getTransactionTypeName(t.type)}</td>
                                        <td>${t.notes || '-'}</td>
                                        <td>${formatCurrency(t.amount)}</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
                
                <div class="row mt-4">
                    <div class="col-md-6">
                        <canvas id="reportChart" height="200"></canvas>
                    </div>
                    <div class="col-md-6">
                        <canvas id="categoryChart" height="200"></canvas>
                    </div>
                </div>
            `);
            
            // Buat chart
            createReportCharts(transactions, categories);
            
            // Tampilkan hasil laporan
            $('#report-result').removeClass('d-none');
            $('#report-empty').addClass('d-none');
        }
        
        // Fungsi untuk membuat chart laporan
        function createReportCharts(transactions, categories) {
            // Kelompokkan transaksi per hari untuk chart garis
            const dailyData = {};
            transactions.forEach(t => {
                if (!t.date) return;
                const date = t.date.split('T')[0];
                if (!dailyData[date]) {
                    dailyData[date] = 0;
                }
                dailyData[date] += t.amount;
            });
            
            const dates = Object.keys(dailyData).sort();
            const amounts = dates.map(date => dailyData[date]);
            
            // Chart pendapatan harian
            const reportCtx = document.getElementById('reportChart').getContext('2d');
            new Chart(reportCtx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Pendapatan Harian',
                        data: amounts,
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Pendapatan Harian'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Chart pendapatan per kategori
            const categoryCtx = document.getElementById('categoryChart').getContext('2d');
            new Chart(categoryCtx, {
                type: 'pie',
                data: {
                    labels: Object.keys(categories).map(getTransactionTypeName),
                    datasets: [{
                        data: Object.values(categories),
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.7)',
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 206, 86, 0.7)',
                            'rgba(75, 192, 192, 0.7)',
                            'rgba(153, 102, 255, 0.7)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Pendapatan per Kategori'
                        }
                    }
                }
            });
        }
        
        // Event handler untuk cetak laporan
        $('#print-report').click(function() {
            window.print();
        });
        
        // Event handler untuk export PDF laporan
        $('#export-report-pdf').click(function() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Tambahkan konten laporan ke PDF
            doc.html($('#report-content')[0], {
                callback: function(doc) {
                    doc.save('laporan-hotel.pdf');
                },
                x: 10,
                y: 10,
                width: 190,
                windowWidth: $('#report-content').width()
            });
        });
        
        // Event handler untuk export Excel laporan
        $('#export-report-excel').click(function() {
            // Implementasi export Excel bisa ditambahkan di sini
            showNotification('info', 'Fitur export Excel akan segera tersedia');
        });
        
        // Fungsi untuk memuat riwayat backup
        function loadBackupHistory() {
            $('#backup-history').empty();
            
            if (backups.length === 0) {
                $('#backup-history').append(
                    '<tr><td colspan="5" class="text-center">Tidak ada riwayat backup</td></tr>'
                );
            } else {
                backups.forEach((backup, index) => {
                    $('#backup-history').append(`
                        <tr>
                            <td>${index + 1}</td>
                            <td>${formatDate(backup.date)}</td>
                            <td>${backup.filename}</td>
                            <td>${formatFileSize(backup.size)}</td>
                            <td>
                                <button class="btn btn-sm btn-primary restore-backup-btn" data-id="${backup.id}">
                                    <i class="fas fa-upload"></i> Restore
                                </button>
                                <button class="btn btn-sm btn-danger delete-backup-btn" data-id="${backup.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `);
                });
            }
        }
        
        // Fungsi untuk memformat ukuran file
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2) + ' ' + sizes[i];
        }
        
        // Event handler untuk backup data
        $('#backup-data').click(function() {
            $('#databaseModalTitle').text('Backup Data');
            $('#database-action').val('backup');
            $('#backup-section').removeClass('d-none');
            $('#restore-section').addClass('d-none');
            $('#reset-section').addClass('d-none');
            $('#databaseModal').modal('show');
        });
        
        // Event handler untuk restore data
        $('#restore-data').click(function() {
            $('#databaseModalTitle').text('Restore Data');
            $('#database-action').val('restore');
            $('#backup-section').addClass('d-none');
            $('#restore-section').removeClass('d-none');
            $('#reset-section').addClass('d-none');
            $('#databaseModal').modal('show');
        });
        
        // Event handler untuk reset data
        $('#reset-data').click(function() {
            $('#databaseModalTitle').text('Reset Data');
            $('#database-action').val('reset');
            $('#backup-section').addClass('d-none');
            $('#restore-section').addClass('d-none');
            $('#reset-section').removeClass('d-none');
            $('#databaseModal').modal('show');
        });
        
        // Event handler untuk konfirmasi aksi database
        $('#confirm-database-action').click(function() {
            const action = $('#database-action').val();
            const password = $('#database-password').val();
            
            // Validasi password admin
            const admin = users.find(u => u.role === 'admin' && u.password === password);
            if (!admin) {
                showNotification('error', 'Password admin salah');
                return;
            }
            
            switch(action) {
                case 'backup':
                    createBackup();
                    break;
                    
                case 'restore':
                    restoreBackup();
                    break;
                    
                case 'reset':
                    resetData();
                    break;
            }
            
            // Tutup modal
            $('#databaseModal').modal('hide');
        });
        
        // Fungsi untuk membuat backup
        function createBackup() {
            const now = new Date();
            const backupDate = now.toISOString();
            const filename = `hotel-backup-${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')}.json`;
            
            // Buat objek backup
            const backupData = {
                currentUser,
                rooms,
                guests,
                transactions,
                facilities,
                users,
                backups,
                settings
            };
            
            // Konversi ke JSON
            const jsonData = JSON.stringify(backupData, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            // Buat link download
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            // Tambahkan ke riwayat backup
            const newBackup = {
                id: backups.length > 0 ? Math.max(...backups.map(b => b.id)) + 1 : 1,
                date: backupDate,
                filename,
                size: jsonData.length
            };
            
            backups.push(newBackup);
            saveData();
            
            // Update UI
            loadBackupHistory();
            
            showNotification('success', 'Backup data berhasil dibuat');
        }
        
        // Fungsi untuk restore backup
        function restoreBackup() {
            const fileInput = $('#restore-file')[0];
            
            if (!fileInput.files || fileInput.files.length === 0) {
                showNotification('error', 'Harap pilih file backup');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const backupData = JSON.parse(e.target.result);
                    
                    // Validasi data backup
                    if (!backupData.rooms || !backupData.guests || !backupData.transactions || !backupData.users) {
                        showNotification('error', 'File backup tidak valid');
                        return;
                    }
                    
                    // Restore data
                    rooms = backupData.rooms || [];
                    guests = backupData.guests || [];
                    transactions = backupData.transactions || [];
                    facilities = backupData.facilities || [];
                    users = backupData.users || [];
                    backups = backupData.backups || [];
                    settings = backupData.settings || settings;
                    
                    // Simpan data
                    saveData();
                    
                    // Update UI
                    updateUI();
                    
                    showNotification('success', 'Data berhasil di-restore');
                } catch (error) {
                    showNotification('error', 'Gagal membaca file backup');
                    console.error(error);
                }
            };
            
            reader.readAsText(file);
        }
        
        // Fungsi untuk reset data
        function resetData() {
            if (confirm('Apakah Anda yakin ingin mereset semua data? Semua data akan dihapus dan dikembalikan ke pengaturan awal.')) {
                // Reset data
                initializeDefaultData();
                
                // Logout user
                currentUser = null;
                
                // Simpan data
                saveData();
                
                // Update UI
                updateUI();
                
                showNotification('success', 'Data berhasil di-reset');
            }
        }
        
        // Event handler untuk restore backup dari riwayat
        $(document).on('click', '.restore-backup-btn', function() {
            const backupId = parseInt($(this).data('id'));
            const backup = backups.find(b => b.id === backupId);
            
            if (backup) {
                if (confirm(`Apakah Anda yakin ingin merestore backup dari ${formatDate(backup.date)}?`)) {
                    // Tampilkan modal verifikasi admin
                    $('#adminPasswordModal').modal('show');
                    
                    // Simpan ID backup di modal
                    $('#adminPasswordModal').data('backupId', backupId);
                }
            }
        });
        
        // Event handler untuk hapus backup dari riwayat
        $(document).on('click', '.delete-backup-btn', function() {
            const backupId = parseInt($(this).data('id'));
            
            if (confirm('Apakah Anda yakin ingin menghapus backup ini?')) {
                // Hapus backup
                backups = backups.filter(b => b.id !== backupId);
                
                // Simpan data
                saveData();
                
                // Update UI
                loadBackupHistory();
                
                showNotification('success', 'Backup berhasil dihapus');
            }
        });
        
        // Event handler untuk form password admin
        $('#admin-password-form').submit(function(e) {
            e.preventDefault();
            
            const password = $('#admin-password').val();
            const backupId = $('#adminPasswordModal').data('backupId');
            const backup = backups.find(b => b.id === backupId);
            
            // Validasi password admin
            const admin = users.find(u => u.role === 'admin' && u.password === password);
            if (!admin) {
                showNotification('error', 'Password admin salah');
                return;
            }
            
            if (backup) {
                // Lakukan restore
                // (Implementasi restore dari file lokal bisa ditambahkan di sini)
                showNotification('info', 'Fitur restore dari riwayat akan segera tersedia');
            }
            
            // Tutup modal
            $('#adminPasswordModal').modal('hide');
            $('#admin-password-form')[0].reset();
        });
        
        // Event handler untuk manajemen pengguna
        $('#manage-users').click(function() {
            loadUsers();
            $('#userManagementModal').modal('show');
        });
        
        // Fungsi untuk memuat data pengguna
        function loadUsers() {
            $('#users-list').empty();
            
            if (users.length === 0) {
                $('#users-list').append(
                    '<tr><td colspan="7" class="text-center">Tidak ada data pengguna</td></tr>'
                );
            } else {
                users.forEach((user, index) => {
                    let roleBadge = '';
                    switch(user.role) {
                        case 'admin':
                            roleBadge = '<span class="badge bg-admin">Admin</span>';
                            break;
                        case 'supervisor':
                            roleBadge = '<span class="badge bg-supervisor">Supervisor</span>';
                            break;
                        case 'manager':
                            roleBadge = '<span class="badge bg-manager">Manager</span>';
                            break;
                        case 'staff':
                            roleBadge = '<span class="badge bg-staff">Staff</span>';
                            break;
                        default:
                            roleBadge = '<span class="badge bg-secondary">' + user.role + '</span>';
                    }
                    
                    const statusBadge = user.status === 'active' ? 
                        '<span class="badge bg-success">Aktif</span>' : 
                        '<span class="badge bg-secondary">Nonaktif</span>';
                    
                    $('#users-list').append(`
                        <tr>
                            <td>${index + 1}</td>
                            <td>${user.username}</td>
                            <td>${user.name}</td>
                            <td>${roleBadge}</td>
                            <td>${statusBadge}</td>
                            <td>${user.lastLogin ? formatDate(user.lastLogin) : '-'}</td>
                            <td>
                                <button class="btn btn-sm btn-primary edit-user-btn" data-id="${user.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger delete-user-btn" data-id="${user.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `);
                });
            }
        }
        
        // Event handler untuk tombol tambah pengguna
        $('#add-user-btn').click(function() {
            $('#userModalTitle').text('Tambah Pengguna Baru');
            $('#user-form')[0].reset();
            $('#user-id').val('');
            $('#user-status').val('active');
            $('#userModal').modal('show');
        });
        
        // Event handler untuk tombol edit pengguna
        $(document).on('click', '.edit-user-btn', function() {
            const userId = parseInt($(this).data('id'));
            const user = users.find(u => u.id === userId);
            
            if (user) {
                $('#userModalTitle').text('Edit Pengguna');
                $('#user-id').val(user.id);
                $('#user-username').val(user.username);
                $('#user-name').val(user.name);
                $('#user-role').val(user.role);
                $('#user-password').val(user.password);
                $('#user-status').val(user.status);
                $('#userModal').modal('show');
            }
        });
        
        // Event handler untuk tombol simpan pengguna
        $('#save-user').click(function() {
            const id = $('#user-id').val();
            const username = $('#user-username').val();
            const name = $('#user-name').val();
            const role = $('#user-role').val();
            const password = $('#user-password').val();
            const status = $('#user-status').val();
            
            if (!username || !name || !role || !password || !status) {
                showNotification('error', 'Harap isi semua field yang wajib diisi');
                return;
            }
            
            // Validasi username unik
            if (!id) {
                const existingUser = users.find(u => u.username === username);
                if (existingUser) {
                    showNotification('error', 'Username sudah digunakan');
                    return;
                }
            }
            
            if (id) {
                // Edit pengguna yang ada
                const userIndex = users.findIndex(u => u.id === parseInt(id));
                if (userIndex !== -1) {
                    users[userIndex] = {
                        ...users[userIndex],
                        username,
                        name,
                        role,
                        password,
                        status
                    };
                }
            } else {
                // Tambah pengguna baru
                const newUser = {
                    id: users.length > 0 ? Math.max(...users.map(u => u.id)) + 1 : 1,
                    username,
                    name,
                    role,
                    password,
                    status,
                    lastLogin: null
                };
                users.push(newUser);
            }
            
            // Simpan data
            saveData();
            
            // Tutup modal
            $('#userModal').modal('hide');
            
            // Update UI
            loadUsers();
            
            showNotification('success', 'Data pengguna berhasil disimpan');
        });
        
        // Event handler untuk tombol hapus pengguna
        $(document).on('click', '.delete-user-btn', function() {
            const userId = parseInt($(this).data('id'));
            const user = users.find(u => u.id === userId);
            
            if (!user) return;
            
            // Cek apakah user sedang login
            if (currentUser && currentUser.id === userId) {
                showNotification('error', 'Tidak dapat menghapus akun yang sedang digunakan');
                return;
            }
            
            if (confirm(`Apakah Anda yakin ingin menghapus pengguna ${user.name}?`)) {
                // Hapus pengguna
                users = users.filter(u => u.id !== userId);
                
                // Simpan data
                saveData();
                
                // Update UI
                loadUsers();
                
                showNotification('success', 'Pengguna berhasil dihapus');
            }
        });
        
        // Event handler untuk manajemen permissions
        $('#manage-permissions').click(function() {
            showNotification('info', 'Fitur manajemen permissions akan segera tersedia');
        });
        
        // Event handler untuk pengaturan sistem
        $('#system-settings').click(function() {
            showNotification('info', 'Fitur pengaturan sistem akan segera tersedia');
        });
        
        // Inisialisasi chart dashboard
        function initDashboardChart() {
            const ctx = document.getElementById('monthlyChart').getContext('2d');
            
            // Data dummy untuk chart
            const labels = Array.from({length: 30}, (_, i) => `Hari ${i+1}`);
            const data = Array.from({length: 30}, () => Math.floor(Math.random() * 1000000) + 500000);
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Pendapatan Harian',
                        data: data,
                        backgroundColor: 'rgba(66, 153, 225, 0.7)',
                        borderColor: 'rgba(66, 153, 225, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Pendapatan 30 Hari Terakhir'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return 'Rp ' + value.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Inisialisasi aplikasi saat dokumen siap
        $(document).ready(function() {
            // Load data dari localStorage
            loadData();
            
            // Inisialisasi chart dashboard
            initDashboardChart();
            
            // Tampilkan modal login jika belum login
            if (!currentUser) {
                $('#loginModal').modal({backdrop: 'static', keyboard: false});
            }
            
            // Event handler untuk metode pembayaran
            $('input[name="payment-method"]').change(function() {
                $('.payment-details').removeClass('active');
                $(`#${$(this).val()}-details`).addClass('active');
            });
        });
    </script>
</body>
</html>
