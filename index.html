<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Jadwal Shift & Absensi Karyawan</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4361ee;
            --primary-light: #e6e9ff;
            --secondary-color: #3a0ca3;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --info-color: #3498db;
            --light-color: #f8f9fa;
            --dark-color: #2c3e50;
            --gray-color: #6c757d;
            --border-color: #dee2e6;
            
            --shift-pagi: #2ecc71;
            --shift-sore: #e67e22;
            --shift-malam: #34495e;
            --libur-color: #e74c3c;
            --cuti-color: #9b59b6;
            --sakit-color: #3498db;
            
            --border-radius: 8px;
            --box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Poppins', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f7fa;
            padding: 0;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.5rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        header::before {
            content: '';
            position: absolute;
            top: -50px;
            right: -50px;
            width: 200px;
            height: 200px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }

        header::after {
            content: '';
            position: absolute;
            bottom: -80px;
            left: -80px;
            width: 300px;
            height: 300px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
        }

        h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }

        header p {
            font-size: 0.9rem;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        .tab-container {
            margin-top: 0;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .tab-buttons {
            display: flex;
            background-color: white;
            border-bottom: 1px solid var(--border-color);
            overflow-x: auto;
            scrollbar-width: none;
            padding: 0 1rem;
        }

        .tab-buttons::-webkit-scrollbar {
            display: none;
        }

        .tab-btn {
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            color: var(--gray-color);
            transition: var(--transition);
            position: relative;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            border-bottom: 3px solid transparent;
        }

        .tab-btn:hover {
            color: var(--primary-color);
            background-color: var(--primary-light);
        }

        .tab-btn.active {
            color: var(--primary-color);
            font-weight: 600;
            border-bottom: 3px solid var(--primary-color);
        }

        .tab-content {
            display: none;
            padding: 1.5rem;
            flex: 1;
            overflow-y: auto;
            background-color: #f8fafc;
        }

        .tab-content.active {
            display: flex;
            flex-direction: column;
        }

        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            flex: 1;
            border: 1px solid var(--border-color);
        }

        .card-title {
            font-size: 1.2rem;
            margin-bottom: 1.2rem;
            color: var(--dark-color);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
        }

        .card-title i {
            color: var(--primary-color);
        }

        .form-group {
            margin-bottom: 1.2rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark-color);
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 0.7rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            transition: var(--transition);
            font-family: 'Poppins', sans-serif;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 0.7rem 1.2rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: var(--transition);
            font-family: 'Poppins', sans-serif;
        }

        .btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-success {
            background-color: var(--success-color);
        }

        .btn-success:hover {
            background-color: #27ae60;
        }

        .btn-danger {
            background-color: var(--danger-color);
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .btn-warning {
            background-color: var(--warning-color);
        }

        .btn-warning:hover {
            background-color: #d35400;
        }

        .btn-info {
            background-color: var(--info-color);
        }

        .btn-info:hover {
            background-color: #2980b9;
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
        }

        .btn-outline:hover {
            background-color: var(--primary-light);
        }

        .btn-sm {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
        }

        .table-responsive {
            overflow-x: auto;
            margin-top: 1rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        th, td {
            padding: 0.8rem 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background-color: var(--light-color);
            font-weight: 600;
            color: var(--dark-color);
            position: sticky;
            top: 0;
        }

        tr:hover {
            background-color: rgba(67, 97, 238, 0.05);
        }

        .badge {
            display: inline-block;
            padding: 0.3rem 0.6rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
        }

        .badge-pagi {
            background-color: var(--shift-pagi);
        }

        .badge-sore {
            background-color: var(--shift-sore);
        }

        .badge-malam {
            background-color: var(--shift-malam);
            color: white;
        }

        .badge-libur {
            background-color: var(--libur-color);
        }

        .badge-cuti {
            background-color: var(--cuti-color);
        }

        .badge-sakit {
            background-color: var(--sakit-color);
        }

        .badge-primary {
            background-color: var(--primary-color);
        }

        .badge-success {
            background-color: var(--success-color);
        }

        .badge-danger {
            background-color: var(--danger-color);
        }

        .badge-warning {
            background-color: var(--warning-color);
        }

        .badge-info {
            background-color: var(--info-color);
        }

        .badge-light {
            background-color: var(--light-color);
            color: var(--dark-color);
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .calendar-header {
            font-weight: 600;
            text-align: center;
            padding: 0.6rem;
            background-color: var(--light-color);
            border-radius: var(--border-radius);
            font-size: 0.8rem;
        }

        .calendar-day {
            border: 1px solid var(--border-color);
            padding: 0.6rem;
            min-height: 100px;
            background: white;
            border-radius: var(--border-radius);
            position: relative;
            display: flex;
            flex-direction: column;
            transition: var(--transition);
        }

        .calendar-day:hover {
            box-shadow: var(--box-shadow);
            transform: translateY(-2px);
        }

        .calendar-day.today {
            border: 2px solid var(--primary-color);
            background-color: var(--primary-light);
        }

        .calendar-day.weekend {
            background-color: rgba(231, 76, 60, 0.05);
        }

        .day-number {
            font-weight: 600;
            margin-bottom: 0.3rem;
            align-self: flex-end;
            font-size: 0.9rem;
        }

        .shift-item {
            margin: 0.2rem 0;
            padding: 0.4rem;
            border-radius: 4px;
            font-size: 0.75rem;
            background-color: rgba(67, 97, 238, 0.1);
            overflow: hidden;
            text-overflow: ellipsis;
            transition: var(--transition);
        }

        .shift-item:hover {
            transform: translateX(2px);
        }

        .shift-pagi {
            background-color: rgba(46, 204, 113, 0.15);
            border-left: 3px solid var(--shift-pagi);
        }

        .shift-sore {
            background-color: rgba(230, 126, 34, 0.15);
            border-left: 3px solid var(--shift-sore);
        }

        .shift-malam {
            background-color: rgba(52, 73, 94, 0.15);
            border-left: 3px solid var(--shift-malam);
            color: var(--dark-color);
        }

        .special-note {
            font-size: 0.7rem;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            margin-top: 0.2rem;
            display: inline-block;
        }

        .note-libur {
            background-color: rgba(231, 76, 60, 0.15);
            color: var(--libur-color);
        }

        .note-cuti {
            background-color: rgba(155, 89, 182, 0.15);
            color: var(--cuti-color);
        }

        .note-sakit {
            background-color: rgba(52, 152, 219, 0.15);
            color: var(--sakit-color);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(3px);
        }

        .modal-content {
            background-color: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.2rem;
            padding-bottom: 0.8rem;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-color);
            transition: var(--transition);
            padding: 0 0.5rem;
        }

        .close-btn:hover {
            color: var(--danger-color);
            transform: rotate(90deg);
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .status-active {
            background-color: var(--success-color);
        }

        .status-inactive {
            background-color: var(--danger-color);
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            padding: 0.4rem 0.6rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            transition: var(--transition);
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .edit-btn {
            background-color: var(--warning-color);
            color: white;
        }

        .edit-btn:hover {
            background-color: #e67e22;
        }

        .delete-btn {
            background-color: var(--danger-color);
            color: white;
        }

        .delete-btn:hover {
            background-color: #c0392b;
        }

        .view-btn {
            background-color: var(--primary-color);
            color: white;
        }

        .view-btn:hover {
            background-color: var(--secondary-color);
        }

        .search-filter {
            display: flex;
            gap: 0.8rem;
            margin-bottom: 1.2rem;
            flex-wrap: wrap;
        }

        .search-input {
            flex: 1;
            min-width: 200px;
        }

        .filter-select {
            width: 200px;
            min-width: 150px;
        }

        .absen-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-width: 500px;
            margin: 0 auto;
            padding: 1.5rem;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            border: 1px solid var(--border-color);
        }

        .absen-input {
            padding: 0.8rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            font-size: 1rem;
            text-align: center;
            transition: var(--transition);
        }

        .absen-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
        }

        .absen-btn {
            padding: 0.8rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: var(--transition);
        }

        .absen-btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .absen-result {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: var(--border-radius);
            background: #f8f9fa;
            text-align: center;
            border: 1px solid var(--border-color);
            display: none;
        }

        .absen-success {
            background-color: rgba(46, 204, 113, 0.2);
            color: var(--success-color);
            border-color: rgba(46, 204, 113, 0.3);
        }

        .absen-error {
            background-color: rgba(231, 76, 60, 0.2);
            color: var(--danger-color);
            border-color: rgba(231, 76, 60, 0.3);
        }

        .alert {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            color: white;
            z-index: 10000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            animation: slideIn 0.5s, fadeOut 0.5s 2.5s;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 350px;
        }

        .alert-success {
            background-color: var(--success-color);
        }

        .alert-error {
            background-color: var(--danger-color);
        }

        .alert-warning {
            background-color: var(--warning-color);
        }

        .alert-info {
            background-color: var(--info-color);
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        .row {
            display: flex;
            gap: 1.2rem;
            margin-bottom: 1.2rem;
            flex-wrap: wrap;
        }

        .col {
            flex: 1;
            background: white;
            padding: 1.2rem;
            border-radius: var(--border-radius);
            min-width: 200px;
            border: 1px solid var(--border-color);
            box-shadow: var(--box-shadow);
            transition: var(--transition);
        }

        .col:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .col h3 {
            font-size: 0.9rem;
            margin-bottom: 0.8rem;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--gray-color);
            font-weight: 500;
        }

        .col p {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--dark-color);
        }

        .flex-row {
            display: flex;
            gap: 0.8rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .flex-row .form-control {
            flex: 1;
            min-width: 150px;
        }

        .text-center {
            text-align: center;
        }

        .text-muted {
            color: var(--gray-color);
        }

        .mb-3 {
            margin-bottom: 1rem;
        }

        .mt-3 {
            margin-top: 1rem;
        }

        .p-3 {
            padding: 1rem;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary-color);
        }

        /* Responsive styles */
        @media (max-width: 992px) {
            .container {
                border-radius: 0;
            }
            
            .tab-buttons {
                padding: 0 0.5rem;
            }
            
            .tab-btn {
                padding: 0.8rem 1rem;
                font-size: 0.8rem;
            }
            
            .tab-content {
                padding: 1rem;
            }
            
            .card {
                padding: 1rem;
            }
            
            .col {
                min-width: calc(50% - 1rem);
            }
        }

        @media (max-width: 768px) {
            header {
                padding: 1rem;
            }
            
            h1 {
                font-size: 1.5rem;
            }
            
            .tab-buttons {
                flex-wrap: nowrap;
                overflow-x: auto;
                padding-bottom: 5px;
            }
            
            .tab-btn {
                padding: 0.7rem 0.9rem;
                font-size: 0.8rem;
            }
            
            .search-filter {
                flex-direction: column;
                gap: 0.8rem;
            }
            
            .filter-select, .search-input {
                width: 100%;
            }
            
            .calendar-day {
                min-height: 80px;
                padding: 0.4rem;
            }
            
            .shift-item {
                font-size: 0.7rem;
                padding: 0.3rem;
            }
            
            th, td {
                padding: 0.6rem 0.8rem;
            }
            
            .modal-content {
                width: 95%;
                padding: 1rem;
            }
            
            .col {
                min-width: 100%;
            }
        }

        @media (max-width: 576px) {
            body {
                padding: 0;
            }
            
            header {
                padding: 0.8rem;
            }
            
            h1 {
                font-size: 1.3rem;
            }
            
            header p {
                font-size: 0.8rem;
            }
            
            .tab-content {
                padding: 0.8rem;
            }
            
            .card {
                padding: 0.8rem;
                margin-bottom: 1rem;
            }
            
            .calendar {
                gap: 0.3rem;
            }
            
            .calendar-header {
                padding: 0.4rem;
                font-size: 0.7rem;
            }
            
            .day-number {
                font-size: 0.8rem;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 0.3rem;
            }
            
            .action-btn {
                padding: 0.3rem 0.5rem;
                font-size: 0.7rem;
                width: 100%;
            }
            
            .absen-form {
                padding: 1rem;
            }
            
            .absen-input, .absen-btn {
                padding: 0.7rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-calendar-alt"></i> Sistem Jadwal Shift & Absensi Karyawan</h1>
            <p>Manajemen jadwal kerja shift dan sistem absensi karyawan</p>
        </header>
        
        <div class="tab-container">
            <div class="tab-buttons">
                <button class="tab-btn active" data-tab="dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</button>
                <button class="tab-btn" data-tab="karyawan"><i class="fas fa-users"></i> Data Karyawan</button>
                <button class="tab-btn" data-tab="jadwal"><i class="fas fa-calendar"></i> Jadwal Shift</button>
                <button class="tab-btn" data-tab="absensi"><i class="fas fa-fingerprint"></i> Absensi</button>
                <button class="tab-btn" data-tab="laporan"><i class="fas fa-file-pdf"></i> Laporan</button>
            </div>
            
            <!-- Tab Dashboard -->
            <div id="dashboard" class="tab-content active">
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-chart-pie"></i> Ringkasan</h2>
                    <div class="row">
                        <div class="col">
                            <h3><i class="fas fa-users"></i> Total Karyawan</h3>
                            <p id="total-karyawan">0</p>
                        </div>
                        <div class="col">
                            <h3><i class="fas fa-calendar-check"></i> Shift Hari Ini</h3>
                            <p id="shift-hari-ini">0</p>
                        </div>
                        <div class="col">
                            <h3><i class="fas fa-user-clock"></i> Belum Absen</h3>
                            <p id="belum-absen">0</p>
                        </div>
                        <div class="col">
                            <h3><i class="fas fa-calendar-day"></i> Tanggal Hari Ini</h3>
                            <p id="tanggal-hari-ini">-</p>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-calendar"></i> Kalender Bulan Ini</h2>
                    <div id="mini-calendar"></div>
                </div>
                
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-list"></i> Aktivitas Terkini</h2>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Tanggal</th>
                                    <th>Karyawan</th>
                                    <th>Aktivitas</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="aktivitas-terkini">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Tab Data Karyawan -->
            <div id="karyawan" class="tab-content">
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-users-cog"></i> Manajemen Data Karyawan</h2>
                    <div class="search-filter">
                        <input type="text" id="search-karyawan" class="form-control search-input" placeholder="Cari karyawan...">
                        <select id="filter-status" class="form-control filter-select">
                            <option value="">Semua Status</option>
                            <option value="active">Aktif</option>
                            <option value="inactive">Non-Aktif</option>
                        </select>
                        <button class="btn btn-success" id="tambah-karyawan-btn"><i class="fas fa-plus"></i> Tambah</button>
                    </div>
                    
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID Karyawan</th>
                                    <th>Nama</th>
                                    <th>Posisi</th>
                                    <th>Status</th>
                                    <th>Tanggal Bergabung</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="tabel-karyawan">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Tab Jadwal Shift -->
            <div id="jadwal" class="tab-content">
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-calendar-plus"></i> Pembuatan Jadwal Shift</h2>
                    <div class="form-group">
                        <label for="bulan-jadwal">Pilih Bulan dan Tahun:</label>
                        <div class="flex-row">
                            <input type="month" id="bulan-jadwal" class="form-control">
                            <button class="btn" id="generate-jadwal-btn"><i class="fas fa-sync-alt"></i> Generate</button>
                            <button class="btn btn-success" id="simpan-jadwal-btn"><i class="fas fa-save"></i> Simpan</button>
                            <button class="btn btn-warning" id="copy-jadwal-btn"><i class="fas fa-copy"></i> Copy Bulan Sebelumnya</button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="jumlah-karyawan">Jumlah Karyawan:</label>
                        <input type="number" id="jumlah-karyawan" class="form-control" min="1" value="3">
                    </div>
                    
                    <div class="form-group">
                        <label>Libur Manual:</label>
                        <div class="flex-row">
                            <input type="date" id="libur-tanggal" class="form-control">
                            <button class="btn btn-warning" id="tambah-libur-btn"><i class="fas fa-calendar-minus"></i> Tambah Libur</button>
                        </div>
                        <div id="daftar-libur" style="margin-top: 10px;">
                            <!-- Daftar tanggal libur akan muncul di sini -->
                        </div>
                    </div>
                    
                    <div id="calendar-container" style="margin-top: 20px;">
                        <!-- Kalender akan diisi oleh JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Tab Absensi -->
            <div id="absensi" class="tab-content">
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-fingerprint"></i> Absensi Karyawan</h2>
                    <div class="absen-form">
                        <h3 style="text-align: center;"><i class="fas fa-id-card"></i> Scan ID Karyawan</h3>
                        <input type="text" id="id-karyawan-absen" class="absen-input" placeholder="Masukkan ID Karyawan atau Scan Barcode" autofocus>
                        <button class="absen-btn" id="absen-masuk-btn"><i class="fas fa-sign-in-alt"></i> Absen Masuk</button>
                        <button class="absen-btn" id="absen-pulang-btn"><i class="fas fa-sign-out-alt"></i> Absen Pulang</button>
                        <div id="absen-result" class="absen-result" style="display: none;"></div>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-clipboard-list"></i> Rekap Absensi Harian</h2>
                    <div class="form-group">
                        <label for="tanggal-absensi">Pilih Tanggal:</label>
                        <div class="flex-row">
                            <input type="date" id="tanggal-absensi" class="form-control">
                            <button class="btn" id="load-absensi-btn"><i class="fas fa-search"></i> Tampilkan</button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nama Karyawan</th>
                                    <th>Shift</th>
                                    <th>Jadwal</th>
                                    <th>Absen Masuk</th>
                                    <th>Absen Pulang</th>
                                    <th>Status</th>
                                    <th>Keterangan</th>
                                </tr>
                            </thead>
                            <tbody id="tabel-absensi">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-chart-bar"></i> Rekap Absensi Bulan Ini</h2>
                    <div class="form-group">
                        <label for="bulan-rekap">Pilih Bulan:</label>
                        <input type="month" id="bulan-rekap" class="form-control">
                    </div>
                    <div class="table-responsive">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nama Karyawan</th>
                                    <th>Total Hadir</th>
                                    <th>Total Terlambat</th>
                                    <th>Total Absen</th>
                                    <th>Persentase</th>
                                </tr>
                            </thead>
                            <tbody id="rekap-absensi">
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Tab Laporan -->
            <div id="laporan" class="tab-content">
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-file-export"></i> Generasi Laporan</h2>
                    <div class="form-group">
                        <label for="jenis-laporan">Jenis Laporan:</label>
                        <select id="jenis-laporan" class="form-control">
                            <option value="jadwal">Jadwal Shift</option>
                            <option value="absensi">Rekap Absensi</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="bulan-laporan">Pilih Periode:</label>
                        <input type="month" id="bulan-laporan" class="form-control">
                    </div>
                    
                    <div class="form-group">
                        <label for="format-laporan">Format Laporan:</label>
                        <select id="format-laporan" class="form-control">
                            <option value="pdf">PDF</option>
                            <option value="excel">Excel</option>
                            <option value="cetak">Cetak Langsung</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="filter-karyawan-container" style="display: none;">
                        <label for="filter-karyawan">Filter Karyawan:</label>
                        <select id="filter-karyawan" class="form-control" multiple>
                            <!-- Opsi karyawan akan diisi oleh JavaScript -->
                        </select>
                    </div>
                    
                    <div class="flex-row" style="margin-top: 20px;">
                        <button class="btn" id="generate-laporan-btn"><i class="fas fa-file-export"></i> Generate Laporan</button>
                        <button class="btn btn-success" id="cetak-laporan-btn"><i class="fas fa-print"></i> Cetak</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Tambah/Edit Karyawan -->
    <div id="karyawanModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalKaryawanTitle">Tambah Karyawan Baru</h3>
                <button class="close-btn" id="closeKaryawanModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="modal-nama">Nama Lengkap:</label>
                    <input type="text" id="modal-nama" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="modal-posisi">Posisi/Jabatan:</label>
                    <input type="text" id="modal-posisi" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="modal-departemen">Departemen:</label>
                    <input type="text" id="modal-departemen" class="form-control">
                </div>
                <div class="form-group">
                    <label for="modal-nik">Nomor KTP:</label>
                    <input type="text" id="modal-nik" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="modal-tanggal-bergabung">Tanggal Bergabung:</label>
                    <input type="date" id="modal-tanggal-bergabung" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="modal-status">Status:</label>
                    <select id="modal-status" class="form-control">
                        <option value="active">Aktif</option>
                        <option value="inactive">Non-Aktif</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="modal-no-hp">Nomor HP:</label>
                    <input type="text" id="modal-no-hp" class="form-control" required>
                </div>
                <div class="form-group">
                    <label for="modal-email">Email:</label>
                    <input type="email" id="modal-email" class="form-control">
                </div>
                <div class="form-group">
                    <label for="modal-alamat">Alamat:</label>
                    <textarea id="modal-alamat" class="form-control" rows="3"></textarea>
                </div>
                <input type="hidden" id="modal-karyawan-id">
            </div>
            <div class="modal-footer" style="text-align: right; margin-top: 20px;">
                <button class="btn btn-danger" id="cancelKaryawanModal">Batal</button>
                <button class="btn btn-success" id="simpan-karyawan-btn">Simpan</button>
            </div>
        </div>
    </div>

    <!-- Modal Detail Jadwal -->
    <div id="jadwalModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalJadwalTitle">Detail Jadwal</h3>
                <button class="close-btn" id="closeJadwalModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Tanggal:</label>
                    <p id="modal-jadwal-tanggal"></p>
                </div>
                <div class="form-group">
                    <label for="modal-jadwal-shift">Shift:</label>
                    <select id="modal-jadwal-shift" class="form-control">
                        <option value="pagi">Pagi (07:00 - 15:00)</option>
                        <option value="sore">Sore (15:00 - 23:00)</option>
                        <option value="malam">Malam (23:00 - 07:00)</option>
                        <option value="libur">Libur</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="modal-jadwal-karyawan">Karyawan:</label>
                    <select id="modal-jadwal-karyawan" class="form-control">
                        <!-- Opsi karyawan akan diisi oleh JavaScript -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="modal-jadwal-keterangan">Keterangan:</label>
                    <input type="text" id="modal-jadwal-keterangan" class="form-control" placeholder="Misal: Cuti, Sakit, dll.">
                </div>
                <input type="hidden" id="modal-jadwal-id">
            </div>
            <div class="modal-footer" style="text-align: right; margin-top: 20px;">
                <button class="btn btn-danger" id="cancelJadwalModal">Batal</button>
                <button class="btn btn-success" id="simpan-detail-jadwal-btn">Simpan</button>
            </div>
        </div>
    </div>

    <!-- Modal Absensi -->
    <div id="absensiModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalAbsensiTitle">Rekam Absensi</h3>
                <button class="close-btn" id="closeAbsensiModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Karyawan:</label>
                    <p id="modal-absensi-nama"></p>
                </div>
                <div class="form-group">
                    <label>Shift:</label>
                    <p id="modal-absensi-shift"></p>
                </div>
                <div class="form-group">
                    <label>Tanggal:</label>
                    <p id="modal-absensi-tanggal"></p>
                </div>
                <div class="form-group">
                    <label for="modal-absensi-masuk">Jam Masuk:</label>
                    <input type="time" id="modal-absensi-masuk" class="form-control">
                </div>
                <div class="form-group">
                    <label for="modal-absensi-pulang">Jam Pulang:</label>
                    <input type="time" id="modal-absensi-pulang" class="form-control">
                </div>
                <div class="form-group">
                    <label for="modal-absensi-status">Status:</label>
                    <select id="modal-absensi-status" class="form-control">
                        <option value="hadir">Hadir</option>
                        <option value="terlambat">Terlambat</option>
                        <option value="izin">Izin</option>
                        <option value="sakit">Sakit</option>
                        <option value="cuti">Cuti</option>
                        <option value="alpa">Tanpa Keterangan</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="modal-absensi-keterangan">Keterangan:</label>
                    <textarea id="modal-absensi-keterangan" class="form-control" rows="3"></textarea>
                </div>
                <input type="hidden" id="modal-absensi-id">
            </div>
            <div class="modal-footer" style="text-align: right; margin-top: 20px;">
                <button class="btn btn-danger" id="cancelAbsensiModal">Batal</button>
                <button class="btn btn-success" id="simpan-absensi-btn">Simpan</button>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let karyawan = [];
        let jadwal = {};
        let absensi = {};
        let liburManual = [];
        
        // Load data from localStorage when page loads
        function loadData() {
            const karyawanData = localStorage.getItem('karyawanData');
            const jadwalData = localStorage.getItem('jadwalData');
            const absensiData = localStorage.getItem('absensiData');
            const liburManualData = localStorage.getItem('liburManualData');
            
            if (karyawanData) karyawan = JSON.parse(karyawanData);
            if (jadwalData) jadwal = JSON.parse(jadwalData);
            if (absensiData) absensi = JSON.parse(absensiData);
            if (liburManualData) liburManual = JSON.parse(liburManualData);
            
            // If no data, initialize with sample data
            if (karyawan.length === 0) {
                karyawan = [
                    {
                        id: 'EMP001',
                        nama: 'John Doe',
                        posisi: 'Manager',
                        departemen: 'Operasional',
                        nik: '1234567890123456',
                        tanggalBergabung: '2020-01-15',
                        status: 'active',
                        noHp: '081234567890',
                        email: 'john.doe@example.com',
                        alamat: 'Jl. Contoh No. 123, Jakarta'
                    },
                    {
                        id: 'EMP002',
                        nama: 'Jane Smith',
                        posisi: 'Supervisor',
                        departemen: 'Marketing',
                        nik: '2345678901234567',
                        tanggalBergabung: '2021-03-20',
                        status: 'active',
                        noHp: '082345678901',
                        email: 'jane.smith@example.com',
                        alamat: 'Jl. Contoh No. 456, Jakarta'
                    },
                    {
                        id: 'EMP003',
                        nama: 'Bob Johnson',
                        posisi: 'Staff',
                        departemen: 'IT',
                        nik: '3456789012345678',
                        tanggalBergabung: '2022-05-10',
                        status: 'active',
                        noHp: '083456789012',
                        email: 'bob.johnson@example.com',
                        alamat: 'Jl. Contoh No. 789, Jakarta'
                    }
                ];
                saveData();
            }
        }
        
        // Save data to localStorage
        function saveData() {
            localStorage.setItem('karyawanData', JSON.stringify(karyawan));
            localStorage.setItem('jadwalData', JSON.stringify(jadwal));
            localStorage.setItem('absensiData', JSON.stringify(absensi));
            localStorage.setItem('liburManualData', JSON.stringify(liburManual));
        }
        
        // Show alert message
        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            
            // Add icon based on alert type
            let icon = '';
            switch(type) {
                case 'success': icon = '<i class="fas fa-check-circle"></i>'; break;
                case 'error': icon = '<i class="fas fa-exclamation-circle"></i>'; break;
                case 'warning': icon = '<i class="fas fa-exclamation-triangle"></i>'; break;
                default: icon = '<i class="fas fa-info-circle"></i>';
            }
            
            alertDiv.innerHTML = `${icon} ${message}`;
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 3000);
        }
        
        // Initialize the application
        function initSampleData() {
            const today = new Date();
            const currentMonth = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0');
            
            // Set default values for month inputs
            document.getElementById('bulan-jadwal').value = currentMonth;
            document.getElementById('bulan-laporan').value = currentMonth;
            document.getElementById('tanggal-absensi').value = today.toISOString().split('T')[0];
            document.getElementById('bulan-rekap').value = currentMonth;
            
            // Set today's date in dashboard
            document.getElementById('tanggal-hari-ini').textContent = formatTanggal(today.toISOString().split('T')[0]);
            
            updateDashboard();
            updateTabelKaryawan();
            updateDaftarLibur();
            generateJadwal();
        }
        
        // Tab functionality
        function setupTabNavigation() {
            const tabButtons = document.querySelectorAll('.tab-btn');
            tabButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    
                    // Remove active class from all tabs and buttons
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.querySelectorAll('.tab-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    // Add active class to clicked tab and button
                    document.getElementById(tabName).classList.add('active');
                    this.classList.add('active');
                    
                    // Load specific tab data if needed
                    if (tabName === 'absensi') {
                        const today = new Date();
                        document.getElementById('tanggal-absensi').value = today.toISOString().split('T')[0];
                        loadAbsensi();
                        loadRekapAbsensi();
                    } else if (tabName === 'jadwal') {
                        const today = new Date();
                        const currentMonth = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0');
                        document.getElementById('bulan-jadwal').value = currentMonth;
                        generateJadwal();
                    } else if (tabName === 'laporan') {
                        setupFilterKaryawan();
                    }
                });
            });
        }
        
        // Modal functions
        function setupModalFunctionality() {
            // Open modal buttons
            document.getElementById('tambah-karyawan-btn').addEventListener('click', tambahKaryawanModal);
            
            // Close modal buttons
            document.getElementById('closeKaryawanModal').addEventListener('click', () => {
                closeModal('karyawanModal');
                resetKaryawanForm();
            });
            document.getElementById('closeJadwalModal').addEventListener('click', () => closeModal('jadwalModal'));
            document.getElementById('closeAbsensiModal').addEventListener('click', () => closeModal('absensiModal'));
            
            // Modal cancel buttons
            document.getElementById('cancelKaryawanModal').addEventListener('click', () => {
                closeModal('karyawanModal');
                resetKaryawanForm();
            });
            document.getElementById('cancelJadwalModal').addEventListener('click', () => closeModal('jadwalModal'));
            document.getElementById('cancelAbsensiModal').addEventListener('click', () => closeModal('absensiModal'));
            
            // Save buttons
            document.getElementById('simpan-karyawan-btn').addEventListener('click', simpanKaryawan);
            document.getElementById('simpan-detail-jadwal-btn').addEventListener('click', simpanDetailJadwal);
            document.getElementById('simpan-absensi-btn').addEventListener('click', simpanAbsensi);
            
            // Other buttons
            document.getElementById('generate-jadwal-btn').addEventListener('click', generateJadwal);
            document.getElementById('simpan-jadwal-btn').addEventListener('click', simpanJadwal);
            document.getElementById('copy-jadwal-btn').addEventListener('click', copyJadwalBulanSebelumnya);
            document.getElementById('load-absensi-btn').addEventListener('click', loadAbsensi);
            document.getElementById('generate-laporan-btn').addEventListener('click', generateLaporan);
            document.getElementById('cetak-laporan-btn').addEventListener('click', cetakLaporan);
            document.getElementById('tambah-libur-btn').addEventListener('click', tambahLiburManual);
            
            // Absensi buttons
            document.getElementById('absen-masuk-btn').addEventListener('click', () => rekamAbsen('masuk'));
            document.getElementById('absen-pulang-btn').addEventListener('click', () => rekamAbsen('pulang'));
            
            // Search and filter
            document.getElementById('search-karyawan').addEventListener('input', updateTabelKaryawan);
            document.getElementById('filter-status').addEventListener('change', updateTabelKaryawan);
            
            // Rekap absensi bulan
            document.getElementById('bulan-rekap').addEventListener('change', loadRekapAbsensi);
            
            // Jenis laporan change
            document.getElementById('jenis-laporan').addEventListener('change', function() {
                const filterContainer = document.getElementById('filter-karyawan-container');
                filterContainer.style.display = this.value === 'absensi' ? 'block' : 'none';
                if (this.value === 'absensi') {
                    setupFilterKaryawan();
                }
            });
        }
        
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // Karyawan functions
        function resetKaryawanForm() {
            document.getElementById('modalKaryawanTitle').textContent = 'Tambah Karyawan Baru';
            document.getElementById('modal-nama').value = '';
            document.getElementById('modal-posisi').value = '';
            document.getElementById('modal-departemen').value = '';
            document.getElementById('modal-nik').value = '';
            document.getElementById('modal-tanggal-bergabung').value = '';
            document.getElementById('modal-status').value = 'active';
            document.getElementById('modal-no-hp').value = '';
            document.getElementById('modal-email').value = '';
            document.getElementById('modal-alamat').value = '';
            document.getElementById('modal-karyawan-id').value = '';
        }
        
        function tambahKaryawanModal() {
            resetKaryawanForm();
            openModal('karyawanModal');
        }
        
        function editKaryawanModal(id) {
            const karyawanEdit = karyawan.find(k => k.id === id);
            if (karyawanEdit) {
                document.getElementById('modalKaryawanTitle').textContent = 'Edit Data Karyawan';
                document.getElementById('modal-nama').value = karyawanEdit.nama;
                document.getElementById('modal-posisi').value = karyawanEdit.posisi;
                document.getElementById('modal-departemen').value = karyawanEdit.departemen || '';
                document.getElementById('modal-nik').value = karyawanEdit.nik || '';
                document.getElementById('modal-tanggal-bergabung').value = karyawanEdit.tanggalBergabung;
                document.getElementById('modal-status').value = karyawanEdit.status || 'active';
                document.getElementById('modal-no-hp').value = karyawanEdit.noHp || '';
                document.getElementById('modal-email').value = karyawanEdit.email || '';
                document.getElementById('modal-alamat').value = karyawanEdit.alamat || '';
                document.getElementById('modal-karyawan-id').value = karyawanEdit.id;
                
                openModal('karyawanModal');
            }
        }
        
        function generateEmployeeID(nik) {
            if (!nik || nik.length < 16) return 'EMP' + Math.floor(1000 + Math.random() * 9000);
            
            // Take last 4 digits of birth year (assuming NIK digits 11-14 are birth year)
            const tahunLahir = nik.substr(10, 4);
            // Take last 3 digits of NIK
            const nikAkhir = nik.substr(13, 3);
            
            return 'EMP' + tahunLahir + nikAkhir;
        }
        
        function validateKaryawanForm() {
            const nama = document.getElementById('modal-nama').value.trim();
            const posisi = document.getElementById('modal-posisi').value.trim();
            const nik = document.getElementById('modal-nik').value.trim();
            const tanggalBergabung = document.getElementById('modal-tanggal-bergabung').value;
            const noHp = document.getElementById('modal-no-hp').value.trim();
            const email = document.getElementById('modal-email').value.trim();

            if (!nama || nama.length < 3) {
                showAlert('Nama harus diisi (minimal 3 karakter)', 'error');
                return false;
            }

            if (!posisi) {
                showAlert('Posisi harus diisi', 'error');
                return false;
            }

            if (!nik || nik.length < 16) {
                showAlert('NIK harus diisi (16 digit)', 'error');
                return false;
            }

            if (!tanggalBergabung) {
                showAlert('Tanggal bergabung harus diisi', 'error');
                return false;
            }

            if (!noHp || noHp.length < 10) {
                showAlert('Nomor HP harus diisi (minimal 10 digit)', 'error');
                return false;
            }

            if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                showAlert('Format email tidak valid', 'error');
                return false;
            }

            return true;
        }
        
        function simpanKaryawan() {
            if (!validateKaryawanForm()) return;
            
            const id = document.getElementById('modal-karyawan-id').value;
            const nama = document.getElementById('modal-nama').value.trim();
            const posisi = document.getElementById('modal-posisi').value.trim();
            const departemen = document.getElementById('modal-departemen').value.trim();
            const nik = document.getElementById('modal-nik').value.trim();
            const tanggalBergabung = document.getElementById('modal-tanggal-bergabung').value;
            const status = document.getElementById('modal-status').value;
            const noHp = document.getElementById('modal-no-hp').value.trim();
            const email = document.getElementById('modal-email').value.trim();
            const alamat = document.getElementById('modal-alamat').value.trim();
            
            let newId = id;
            if (!id) {
                // Generate new ID if adding new employee
                newId = generateEmployeeID(nik);
            }
            
            const karyawanData = {
                id: newId,
                nama,
                posisi,
                departemen,
                nik,
                tanggalBergabung,
                status,
                noHp,
                email,
                alamat
            };
            
            if (id) {
                // Edit existing employee
                const index = karyawan.findIndex(k => k.id === id);
                if (index !== -1) {
                    karyawan[index] = karyawanData;
                }
            } else {
                // Add new employee
                karyawan.push(karyawanData);
            }
            
            saveData();
            updateTabelKaryawan();
            updateDashboard();
            closeModal('karyawanModal');
            resetKaryawanForm();
            showAlert('Data karyawan berhasil disimpan', 'success');
        }
        
        function hapusKaryawan(id) {
            if (confirm('Apakah Anda yakin ingin menghapus karyawan ini?')) {
                karyawan = karyawan.filter(k => k.id !== id);
                saveData();
                updateTabelKaryawan();
                updateDashboard();
                showAlert('Karyawan berhasil dihapus', 'success');
            }
        }
        
        function updateTabelKaryawan() {
            const tbody = document.querySelector('#tabel-karyawan tbody');
            tbody.innerHTML = '';
            
            const searchTerm = document.getElementById('search-karyawan').value.toLowerCase();
            const statusFilter = document.getElementById('filter-status').value;
            
            const filteredKaryawan = karyawan.filter(k => {
                const matchesSearch = k.nama.toLowerCase().includes(searchTerm) || 
                                    k.posisi.toLowerCase().includes(searchTerm) ||
                                    k.id.toLowerCase().includes(searchTerm) ||
                                    (k.departemen && k.departemen.toLowerCase().includes(searchTerm)) ||
                                    (k.nik && k.nik.toLowerCase().includes(searchTerm));
                const matchesStatus = !statusFilter || k.status === statusFilter;
                return matchesSearch && matchesStatus;
            });
            
            if (filteredKaryawan.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">Tidak ada data karyawan</td></tr>';
                return;
            }
            
            filteredKaryawan.forEach(k => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${k.id}</td>
                    <td>${k.nama}</td>
                    <td>${k.posisi}</td>
                    <td>
                        <span class="status-indicator ${k.status === 'active' ? 'status-active' : 'status-inactive'}"></span>
                        ${k.status === 'active' ? 'Aktif' : 'Non-Aktif'}
                    </td>
                    <td>${formatTanggal(k.tanggalBergabung)}</td>
                    <td class="action-buttons">
                        <button class="action-btn edit-btn" onclick="editKaryawanModal('${k.id}')"><i class="fas fa-edit"></i> Edit</button>
                        <button class="action-btn delete-btn" onclick="hapusKaryawan('${k.id}')"><i class="fas fa-trash"></i> Hapus</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            document.getElementById('total-karyawan').textContent = karyawan.filter(k => k.status === 'active').length;
        }
        
        // Jadwal functions
        function renderCalendar(bulanInput) {
            const [tahun, bulan] = bulanInput.split('-');
            const hariDalamBulan = new Date(tahun, bulan, 0).getDate();
            const tanggalPertama = new Date(tahun, bulan - 1, 1);
            const hariPertama = tanggalPertama.getDay(); // 0 = Minggu, 1 = Senin, dst.
            
            const container = document.getElementById('calendar-container');
            container.innerHTML = '<h3 style="margin-bottom: 1rem;">Jadwal Bulan ' + getNamaBulan(bulan - 1) + ' ' + tahun + '</h3>';
            
            const calendar = document.createElement('div');
            calendar.className = 'calendar';
            
            // Header hari
            const hariMinggu = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
            hariMinggu.forEach(hari => {
                const header = document.createElement('div');
                header.className = 'calendar-header';
                header.textContent = hari;
                calendar.appendChild(header);
            });
            
            // Hari kosong di awal bulan
            for (let i = 0; i < hariPertama; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                calendar.appendChild(emptyDay);
            }
            
            // Tampilkan jadwal untuk setiap hari
            for (let tanggal = 1; tanggal <= hariDalamBulan; tanggal++) {
                const dateStr = bulanInput + '-' + String(tanggal).padStart(2, '0');
                const dayOfWeek = new Date(tahun, bulan - 1, tanggal).getDay();
                
                const day = document.createElement('div');
                day.className = `calendar-day ${dayOfWeek === 0 || dayOfWeek === 6 ? 'weekend' : ''}`;
                day.innerHTML = `<div class="day-number">${tanggal}</div>`;
                
                // Tampilkan jadwal untuk hari ini jika ada
                if (jadwal[bulanInput] && jadwal[bulanInput][dateStr]) {
                    jadwal[bulanInput][dateStr].forEach(item => {
                        const karyawanData = karyawan.find(k => k.id === item.karyawanId);
                        if (!karyawanData) return;
                        
                        const shiftItem = document.createElement('div');
                        shiftItem.className = `shift-item shift-${item.shift}`;
                        shiftItem.innerHTML = `
                            <strong>${karyawanData.nama}</strong>
                            <span class="badge badge-${item.shift}">${item.shift.toUpperCase()}</span>
                            ${item.keterangan ? `<div class="special-note note-${item.keterangan.toLowerCase().includes('cuti') ? 'cuti' : item.keterangan.toLowerCase().includes('sakit') ? 'sakit' : 'libur'}">${item.keterangan}</div>` : ''}
                        `;
                        
                        // Tambahkan tombol edit
                        const editBtn = document.createElement('button');
                        editBtn.className = 'action-btn edit-btn';
                        editBtn.style.marginTop = '5px';
                        editBtn.style.width = '100%';
                        editBtn.innerHTML = '<i class="fas fa-edit"></i> Edit';
                        editBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            editJadwalModal(dateStr, item.karyawanId);
                        });
                        
                        shiftItem.appendChild(editBtn);
                        day.appendChild(shiftItem);
                    });
                }
                
                calendar.appendChild(day);
            }
            
            container.appendChild(calendar);
        }
        
        function generateJadwal() {
            const bulanInput = document.getElementById('bulan-jadwal').value;
            if (!bulanInput) {
                showAlert('Pilih bulan terlebih dahulu!', 'error');
                return;
            }

            const [tahun, bulan] = bulanInput.split('-');
            const hariDalamBulan = new Date(tahun, bulan, 0).getDate();
            const tanggalPertama = new Date(tahun, bulan - 1, 1);
            const hariPertama = tanggalPertama.getDay();

            const jumlahKaryawan = parseInt(document.getElementById('jumlah-karyawan').value) || 3;
            const activeKaryawan = karyawan.filter(k => k.status === 'active').slice(0, jumlahKaryawan);

            if (activeKaryawan.length === 0) {
                showAlert('Tidak ada karyawan aktif!', 'error');
                return;
            }

            // Inisialisasi jadwal untuk bulan ini jika belum ada
            if (!jadwal[bulanInput]) {
                jadwal[bulanInput] = {};
            }

            // Generate jadwal dengan rotasi yang lebih baik
            for (let tanggal = 1; tanggal <= hariDalamBulan; tanggal++) {
                const dateStr = bulanInput + '-' + String(tanggal).padStart(2, '0');
                const dayOfWeek = new Date(tahun, bulan - 1, tanggal).getDay();
                
                // Skip jika sudah ada jadwal atau hari libur
                if (jadwal[bulanInput][dateStr] || liburManual.includes(dateStr)) continue;

                jadwal[bulanInput][dateStr] = [];
                
                activeKaryawan.forEach((k, index) => {
                    // Sistem rotasi shift yang lebih adil
                    const shiftIndex = (Math.floor(tanggal / activeKaryawan.length) + index) % 3;
                    let shift;
                    
                    switch (shiftIndex) {
                        case 0: shift = 'pagi'; break;
                        case 1: shift = 'sore'; break;
                        case 2: shift = 'malam'; break;
                        default: shift = 'pagi';
                    }
                    
                    // Libur di akhir pekan (Sabtu dan Minggu)
                    if (dayOfWeek === 0 || dayOfWeek === 6) {
                        shift = 'libur';
                    }
                    
                    jadwal[bulanInput][dateStr].push({
                        karyawanId: k.id,
                        shift: shift,
                        keterangan: ''
                    });
                });
            }

            renderCalendar(bulanInput);
            saveData();
            showAlert('Jadwal berhasil digenerate!', 'success');
        }
        
        function copyJadwalBulanSebelumnya() {
            const bulanInput = document.getElementById('bulan-jadwal').value;
            if (!bulanInput) {
                showAlert('Pilih bulan terlebih dahulu!', 'error');
                return;
            }
            
            const [tahun, bulan] = bulanInput.split('-');
            let prevMonth = parseInt(bulan) - 1;
            let prevYear = tahun;
            
            if (prevMonth < 1) {
                prevMonth = 12;
                prevYear = parseInt(tahun) - 1;
            }
            
            const prevBulanInput = `${prevYear}-${String(prevMonth).padStart(2, '0')}`;
            
            if (!jadwal[prevBulanInput]) {
                showAlert('Tidak ada jadwal untuk bulan sebelumnya!', 'error');
                return;
            }
            
            // Inisialisasi jadwal untuk bulan ini jika belum ada
            if (!jadwal[bulanInput]) {
                jadwal[bulanInput] = {};
            }
            
            // Copy jadwal dari bulan sebelumnya
            const hariDalamBulan = new Date(tahun, bulan, 0).getDate();
            
            for (let tanggal = 1; tanggal <= hariDalamBulan; tanggal++) {
                const dateStr = bulanInput + '-' + String(tanggal).padStart(2, '0');
                const prevDateStr = prevBulanInput + '-' + String(tanggal).padStart(2, '0');
                
                if (jadwal[prevBulanInput][prevDateStr]) {
                    jadwal[bulanInput][dateStr] = JSON.parse(JSON.stringify(jadwal[prevBulanInput][prevDateStr]));
                }
            }
            
            renderCalendar(bulanInput);
            saveData();
            showAlert('Jadwal berhasil dicopy dari bulan sebelumnya!', 'success');
        }
        
        function simpanJadwal() {
            const bulanInput = document.getElementById('bulan-jadwal').value;
            if (!bulanInput) {
                showAlert('Pilih bulan terlebih dahulu!', 'error');
                return;
            }
            
            saveData();
            showAlert('Jadwal berhasil disimpan!', 'success');
        }
        
        function tambahLiburManual() {
            const tanggalLibur = document.getElementById('libur-tanggal').value;
            if (!tanggalLibur) {
                showAlert('Pilih tanggal terlebih dahulu!', 'error');
                return;
            }
            
            if (!liburManual.includes(tanggalLibur)) {
                liburManual.push(tanggalLibur);
                saveData();
                updateDaftarLibur();
                generateJadwal();
                showAlert('Tanggal libur berhasil ditambahkan', 'success');
            } else {
                showAlert('Tanggal ini sudah ditandai sebagai libur!', 'warning');
            }
        }
        
        function updateDaftarLibur() {
            const daftarLibur = document.getElementById('daftar-libur');
            daftarLibur.innerHTML = '';
            
            if (liburManual.length === 0) {
                daftarLibur.innerHTML = '<p class="text-muted">Belum ada tanggal libur manual</p>';
                return;
            }
            
            const list = document.createElement('ul');
            list.style.listStyle = 'none';
            list.style.padding = '0';
            
            liburManual.forEach(tanggal => {
                const item = document.createElement('li');
                item.style.display = 'flex';
                item.style.justifyContent = 'space-between';
                item.style.alignItems = 'center';
                item.style.padding = '5px 0';
                item.style.borderBottom = '1px solid var(--border-color)';
                
                item.innerHTML = `
                    <span>${formatTanggal(tanggal)}</span>
                    <button class="action-btn delete-btn" data-tanggal="${tanggal}"><i class="fas fa-trash"></i></button>
                `;
                
                item.querySelector('button').addEventListener('click', (e) => {
                    const tanggalToRemove = e.target.closest('button').getAttribute('data-tanggal');
                    liburManual = liburManual.filter(t => t !== tanggalToRemove);
                    saveData();
                    updateDaftarLibur();
                    generateJadwal();
                    showAlert('Tanggal libur berhasil dihapus', 'success');
                });
                
                list.appendChild(item);
            });
            
            daftarLibur.appendChild(list);
        }
        
        function editJadwalModal(dateStr, karyawanId) {
            const bulanInput = document.getElementById('bulan-jadwal').value;
            if (!jadwal[bulanInput] || !jadwal[bulanInput][dateStr]) return;
            
            const jadwalItem = jadwal[bulanInput][dateStr].find(item => item.karyawanId === karyawanId);
            if (!jadwalItem) return;
            
            const karyawanData = karyawan.find(k => k.id === karyawanId);
            if (!karyawanData) return;
            
            document.getElementById('modalJadwalTitle').textContent = `Edit Jadwal ${karyawanData.nama}`;
            document.getElementById('modal-jadwal-tanggal').textContent = formatTanggal(dateStr);
            document.getElementById('modal-jadwal-shift').value = jadwalItem.shift;
            document.getElementById('modal-jadwal-keterangan').value = jadwalItem.keterangan;
            
            // Isi dropdown karyawan
            const selectKaryawan = document.getElementById('modal-jadwal-karyawan');
            selectKaryawan.innerHTML = '';
            karyawan.filter(k => k.status === 'active').forEach(k => {
                const option = document.createElement('option');
                option.value = k.id;
                option.textContent = k.nama;
                option.selected = k.id === karyawanId;
                selectKaryawan.appendChild(option);
            });
            
            document.getElementById('modal-jadwal-id').value = `${dateStr}-${karyawanId}`;
            openModal('jadwalModal');
        }
        
        function simpanDetailJadwal() {
            const modalId = document.getElementById('modal-jadwal-id').value;
            const [dateStr, karyawanId] = modalId.split('-');
            const bulanInput = document.getElementById('bulan-jadwal').value;
            
            const shift = document.getElementById('modal-jadwal-shift').value;
            const karyawanBaruId = document.getElementById('modal-jadwal-karyawan').value;
            const keterangan = document.getElementById('modal-jadwal-keterangan').value;
            
            if (!jadwal[bulanInput] || !jadwal[bulanInput][dateStr]) return;
            
            // Hapus jadwal lama jika karyawan berubah
            if (karyawanBaruId !== karyawanId) {
                jadwal[bulanInput][dateStr] = jadwal[bulanInput][dateStr].filter(item => item.karyawanId !== karyawanId);
            }
            
            // Cek apakah karyawan sudah ada di tanggal ini
            const existingIndex = jadwal[bulanInput][dateStr].findIndex(item => item.karyawanId === karyawanBaruId);
            
            if (existingIndex !== -1) {
                // Update jadwal yang ada
                jadwal[bulanInput][dateStr][existingIndex] = {
                    karyawanId: karyawanBaruId,
                    shift: shift,
                    keterangan: keterangan
                };
            } else {
                // Tambahkan jadwal baru
                jadwal[bulanInput][dateStr].push({
                    karyawanId: karyawanBaruId,
                    shift: shift,
                    keterangan: keterangan
                });
            }
            
            saveData();
            // Generate ulang tampilan jadwal
            renderCalendar(bulanInput);
            closeModal('jadwalModal');
            showAlert('Jadwal berhasil diperbarui', 'success');
        }
        
        // Absensi functions
        function rekamAbsen(jenis) {
            const idKaryawan = document.getElementById('id-karyawan-absen').value.trim();
            if (!idKaryawan) {
                showAlert('Masukkan ID Karyawan terlebih dahulu', 'error');
                return;
            }
            
            const karyawanData = karyawan.find(k => k.id === idKaryawan);
            if (!karyawanData) {
                showAlert('ID Karyawan tidak ditemukan', 'error');
                return;
            }
            
            if (karyawanData.status !== 'active') {
                showAlert('Karyawan tidak aktif', 'error');
                return;
            }
            
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            const bulanInput = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0');
            const timeNow = today.toTimeString().substr(0, 5);
            
            // Cek jadwal karyawan hari ini
            if (!jadwal[bulanInput] || !jadwal[bulanInput][todayStr]) {
                showAlert('Tidak ada jadwal untuk hari ini', 'error');
                return;
            }
            
            const jadwalHariIni = jadwal[bulanInput][todayStr].find(item => item.karyawanId === idKaryawan);
            if (!jadwalHariIni) {
                showAlert('Tidak ada jadwal untuk karyawan ini hari ini', 'error');
                return;
            }
            
            // Inisialisasi absensi jika belum ada
            if (!absensi[bulanInput]) {
                absensi[bulanInput] = {};
            }
            if (!absensi[bulanInput][todayStr]) {
                absensi[bulanInput][todayStr] = [];
            }
            
            // Cek apakah absensi sudah ada
            let absensiItem = absensi[bulanInput][todayStr].find(a => a.karyawanId === idKaryawan);
            
            if (!absensiItem) {
                absensiItem = {
                    karyawanId: idKaryawan,
                    shift: jadwalHariIni.shift,
                    masuk: '',
                    pulang: '',
                    status: jadwalHariIni.shift === 'libur' ? 'libur' : 'alpa',
                    keterangan: jadwalHariIni.keterangan || ''
                };
                absensi[bulanInput][todayStr].push(absensiItem);
            }
            
            // Rekam absensi
            if (jenis === 'masuk') {
                absensiItem.masuk = timeNow;
                
                // Tentukan status berdasarkan waktu
                if (jadwalHariIni.shift !== 'libur') {
                    const shiftTime = getJamShift(jadwalHariIni.shift).split(' - ');
                    const jamMasukShift = shiftTime[0];
                    
                    const [masukHH, masukMM] = timeNow.split(':').map(Number);
                    const [shiftHH, shiftMM] = jamMasukShift.split(':').map(Number);
                    
                    const masukDate = new Date(2000, 0, 1, masukHH, masukMM);
                    const shiftDate = new Date(2000, 0, 1, shiftHH, shiftMM);
                    
                    // Jika terlambat lebih dari 15 menit
                    if (masukDate - shiftDate > 15 * 60 * 1000) {
                        absensiItem.status = 'terlambat';
                        absensiItem.keterangan = `Terlambat ${Math.floor((masukDate - shiftDate) / (60 * 1000))} menit`;
                    } else {
                        absensiItem.status = 'hadir';
                        absensiItem.keterangan = '';
                    }
                }
                
                showAlert(`Absen masuk berhasil direkam pada ${timeNow}`, 'success');
            } else if (jenis === 'pulang') {
                absensiItem.pulang = timeNow;
                showAlert(`Absen pulang berhasil direkam pada ${timeNow}`, 'success');
            }
            
            saveData();
            // Update tampilan
            loadAbsensi();
            updateDashboard();
            
            // Reset input
            document.getElementById('id-karyawan-absen').value = '';
            document.getElementById('id-karyawan-absen').focus();
        }
        
        function loadAbsensi() {
            const tanggalInput = document.getElementById('tanggal-absensi').value;
            if (!tanggalInput) {
                showAlert('Pilih tanggal terlebih dahulu!', 'error');
                return;
            }
            
            const [tahun, bulan, tanggal] = tanggalInput.split('-');
            const bulanInput = `${tahun}-${bulan}`;
            const dateStr = `${tahun}-${bulan}-${tanggal}`;
            
            const tbody = document.querySelector('#tabel-absensi tbody');
            tbody.innerHTML = '';
            
            // Pastikan jadwal untuk tanggal ini ada
            if (!jadwal[bulanInput] || !jadwal[bulanInput][dateStr]) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Tidak ada jadwal untuk tanggal ini</td></tr>';
                return;
            }
            
            // Inisialisasi absensi jika belum ada
            if (!absensi[bulanInput]) {
                absensi[bulanInput] = {};
            }
            if (!absensi[bulanInput][dateStr]) {
                absensi[bulanInput][dateStr] = [];
            }
            
            jadwal[bulanInput][dateStr].forEach(item => {
                const karyawanData = karyawan.find(k => k.id === item.karyawanId);
                if (!karyawanData) return;
                
                const absensiItem = absensi[bulanInput][dateStr].find(a => a.karyawanId === item.karyawanId) || {
                    karyawanId: item.karyawanId,
                    shift: item.shift,
                    masuk: '',
                    pulang: '',
                    status: item.shift === 'libur' ? 'libur' : 'alpa',
                    keterangan: item.keterangan || ''
                };
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${karyawanData.nama}</td>
                    <td><span class="badge badge-${item.shift}">${item.shift.toUpperCase()}</span></td>
                    <td>${getJamShift(item.shift)}</td>
                    <td>${absensiItem.masuk || '-'}</td>
                    <td>${absensiItem.pulang || '-'}</td>
                    <td>
                        <span class="badge ${getStatusBadgeClass(absensiItem.status)}">${getStatusText(absensiItem.status)}</span>
                    </td>
                    <td>${absensiItem.keterangan || '-'}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function loadRekapAbsensi() {
            const bulanInput = document.getElementById('bulan-rekap').value;
            if (!bulanInput) return;
            
            const [tahun, bulan] = bulanInput.split('-');
            const hariDalamBulan = new Date(tahun, bulan, 0).getDate();
            
            const tbody = document.querySelector('#rekap-absensi tbody');
            tbody.innerHTML = '';
            
            if (!absensi[bulanInput]) {
                absensi[bulanInput] = {};
            }
            
            karyawan.filter(k => k.status === 'active').forEach(k => {
                let totalHadir = 0;
                let totalTerlambat = 0;
                let totalAbsen = 0;
                
                for (let tanggal = 1; tanggal <= hariDalamBulan; tanggal++) {
                    const dateStr = bulanInput + '-' + String(tanggal).padStart(2, '0');
                    
                    if (absensi[bulanInput][dateStr]) {
                        const absensiItem = absensi[bulanInput][dateStr].find(a => a.karyawanId === k.id);
                        
                        if (absensiItem) {
                            if (absensiItem.status === 'hadir') {
                                totalHadir++;
                            } else if (absensiItem.status === 'terlambat') {
                                totalTerlambat++;
                                totalHadir++; // Terlambat masih dianggap hadir
                            } else if (absensiItem.status === 'alpa') {
                                totalAbsen++;
                            }
                            // Status lain (izin, cuti, sakit) tidak mempengaruhi perhitungan
                        }
                    }
                }
                
                const persentase = Math.round((totalHadir / hariDalamBulan) * 100);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${k.nama}</td>
                    <td>${totalHadir}</td>
                    <td>${totalTerlambat}</td>
                    <td>${totalAbsen}</td>
                    <td>
                        <div style="background: #f0f0f0; height: 20px; border-radius: 10px; overflow: hidden;">
                            <div style="background: ${persentase >= 90 ? '#2ecc71' : persentase >= 70 ? '#f39c12' : '#e74c3c'}; 
                                width: ${persentase}%; height: 100%; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px;">
                                ${persentase}%
                            </div>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function editAbsensiModal(dateStr, karyawanId) {
            const [tahun, bulan, tanggal] = dateStr.split('-');
            const bulanInput = `${tahun}-${bulan}`;
            
            const absensiItem = absensi[bulanInput] && absensi[bulanInput][dateStr] ? 
                absensi[bulanInput][dateStr].find(a => a.karyawanId === karyawanId) : null;
            
            const karyawanData = karyawan.find(k => k.id === karyawanId);
            if (!karyawanData) return;
            
            document.getElementById('modalAbsensiTitle').textContent = `Rekam Absensi ${karyawanData.nama}`;
            document.getElementById('modal-absensi-nama').textContent = karyawanData.nama;
            document.getElementById('modal-absensi-tanggal').textContent = formatTanggal(dateStr);
            
            if (absensiItem) {
                document.getElementById('modal-absensi-shift').textContent = absensiItem.shift.toUpperCase();
                document.getElementById('modal-absensi-masuk').value = absensiItem.masuk || '';
                document.getElementById('modal-absensi-pulang').value = absensiItem.pulang || '';
                document.getElementById('modal-absensi-status').value = absensiItem.status;
                document.getElementById('modal-absensi-keterangan').value = absensiItem.keterangan || '';
            } else {
                // Jika belum ada data absensi, ambil dari jadwal
                const jadwalItem = jadwal[bulanInput][dateStr].find(item => item.karyawanId === karyawanId);
                if (jadwalItem) {
                    document.getElementById('modal-absensi-shift').textContent = jadwalItem.shift.toUpperCase();
                    document.getElementById('modal-absensi-status').value = jadwalItem.shift === 'libur' ? 'libur' : 'alpa';
                }
                
                document.getElementById('modal-absensi-masuk').value = '';
                document.getElementById('modal-absensi-pulang').value = '';
                document.getElementById('modal-absensi-keterangan').value = '';
            }
            
            document.getElementById('modal-absensi-id').value = `${dateStr}-${karyawanId}`;
            openModal('absensiModal');
        }
        
        function simpanAbsensi() {
            const modalId = document.getElementById('modal-absensi-id').value;
            const [dateStr, karyawanId] = modalId.split('-');
            const [tahun, bulan, tanggal] = dateStr.split('-');
            const bulanInput = `${tahun}-${bulan}`;
            
            const masuk = document.getElementById('modal-absensi-masuk').value;
            const pulang = document.getElementById('modal-absensi-pulang').value;
            const status = document.getElementById('modal-absensi-status').value;
            const keterangan = document.getElementById('modal-absensi-keterangan').value;
            
            // Inisialisasi absensi jika belum ada
            if (!absensi[bulanInput]) {
                absensi[bulanInput] = {};
            }
            if (!absensi[bulanInput][dateStr]) {
                absensi[bulanInput][dateStr] = [];
            }
            
            // Cek apakah absensi sudah ada
            const existingIndex = absensi[bulanInput][dateStr].findIndex(a => a.karyawanId === karyawanId);
            
            if (existingIndex !== -1) {
                // Update absensi yang ada
                absensi[bulanInput][dateStr][existingIndex] = {
                    ...absensi[bulanInput][dateStr][existingIndex],
                    masuk: masuk,
                    pulang: pulang,
                    status: status,
                    keterangan: keterangan
                };
            } else {
                // Tambahkan absensi baru
                absensi[bulanInput][dateStr].push({
                    karyawanId: karyawanId,
                    shift: jadwal[bulanInput][dateStr].find(item => item.karyawanId === karyawanId).shift,
                    masuk: masuk,
                    pulang: pulang,
                    status: status,
                    keterangan: keterangan
                });
            }
            
            saveData();
            // Update tampilan
            loadAbsensi();
            closeModal('absensiModal');
            showAlert('Absensi berhasil disimpan', 'success');
        }
        
        // Laporan functions
        function setupFilterKaryawan() {
            const filterSelect = document.getElementById('filter-karyawan');
            filterSelect.innerHTML = '';
            
            karyawan.filter(k => k.status === 'active').forEach(k => {
                const option = document.createElement('option');
                option.value = k.id;
                option.textContent = k.nama;
                filterSelect.appendChild(option);
            });
        }
        
        function generateLaporan() {
            const jenisLaporan = document.getElementById('jenis-laporan').value;
            const bulanInput = document.getElementById('bulan-laporan').value;
            const formatLaporan = document.getElementById('format-laporan').value;
            
            if (!bulanInput) {
                showAlert('Pilih bulan terlebih dahulu!', 'error');
                return;
            }
            
            const [tahun, bulan] = bulanInput.split('-');
            const namaBulan = getNamaBulan(parseInt(bulan) - 1);
            
            let laporanContent = '';
            let judulLaporan = '';
            
            switch (jenisLaporan) {
                case 'jadwal':
                    judulLaporan = `Laporan Jadwal Shift ${namaBulan} ${tahun}`;
                    laporanContent = generateLaporanJadwal(bulanInput);
                    break;
                case 'absensi':
                    judulLaporan = `Laporan Rekap Absensi ${namaBulan} ${tahun}`;
                    laporanContent = generateLaporanAbsensi(bulanInput);
                    break;
                default:
                    showAlert('Jenis laporan tidak valid!', 'error');
                    return;
            }
            
            if (formatLaporan === 'pdf' || formatLaporan === 'cetak') {
                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>${judulLaporan}</title>
                        <style>
                            body { font-family: Arial, sans-serif; margin: 20px; }
                            table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                            th, td { padding: 8px; text-align: left; border: 1px solid #ddd; }
                            .text-center { text-align: center; }
                            .text-right { text-align: right; }
                            .header { text-align: center; margin-bottom: 30px; }
                            .footer { margin-top: 50px; text-align: right; }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <h2>${judulLaporan}</h2>
                            <p>Dibuat pada: ${formatTanggal(new Date().toISOString().split('T')[0])}</p>
                        </div>
                        ${laporanContent}
                        <div class="footer">
                            <p>Mengetahui,</p>
                            <br><br><br>
                            <p>___________________</p>
                            <p>HRD</p>
                        </div>
                        <script>
                            ${formatLaporan === 'pdf' ? '' : 'window.print();'}
                        </script>
                    </body>
                    </html>
                `);
                printWindow.document.close();
            } else if (formatLaporan === 'excel') {
                showAlert('Fitur ekspor ke Excel akan segera tersedia!', 'info');
                // Dalam implementasi nyata, gunakan library seperti SheetJS untuk ekspor Excel
            }
        }
        
        function generateLaporanJadwal(bulanInput) {
            if (!jadwal[bulanInput]) {
                return '<p>Tidak ada data jadwal untuk bulan ini</p>';
            }
            
            const [tahun, bulan] = bulanInput.split('-');
            const hariDalamBulan = new Date(tahun, bulan, 0).getDate();
            const namaBulan = getNamaBulan(parseInt(bulan) - 1);
            
            let content = '<table>';
            content += `
                <thead>
                    <tr>
                        <th>Tanggal</th>
                        <th>Nama Karyawan</th>
                        <th>Shift</th>
                        <th>Jam Kerja</th>
                        <th>Keterangan</th>
                    </tr>
                </thead>
                <tbody>
            `;
            
            for (let tanggal = 1; tanggal <= hariDalamBulan; tanggal++) {
                const dateStr = bulanInput + '-' + String(tanggal).padStart(2, '0');
                const dayOfWeek = new Date(tahun, bulan - 1, tanggal).getDay();
                const namaHari = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'][dayOfWeek];
                
                if (jadwal[bulanInput][dateStr]) {
                    jadwal[bulanInput][dateStr].forEach(item => {
                        const karyawanData = karyawan.find(k => k.id === item.karyawanId);
                        if (!karyawanData) return;
                        
                        content += `
                            <tr>
                                <td>${namaHari}, ${tanggal} ${namaBulan} ${tahun}</td>
                                <td>${karyawanData.nama}</td>
                                <td>${item.shift.toUpperCase()}</td>
                                <td>${getJamShift(item.shift)}</td>
                                <td>${item.keterangan || '-'}</td>
                            </tr>
                        `;
                    });
                }
            }
            
            content += '</tbody></table>';
            return content;
        }
        
        function generateLaporanAbsensi(bulanInput) {
            if (!absensi[bulanInput]) {
                return '<p>Tidak ada data absensi untuk bulan ini</p>';
            }
            
            const [tahun, bulan] = bulanInput.split('-');
            const hariDalamBulan = new Date(tahun, bulan, 0).getDate();
            const namaBulan = getNamaBulan(parseInt(bulan) - 1);
            
            const filterKaryawan = Array.from(document.getElementById('filter-karyawan').selectedOptions).map(opt => opt.value);
            
            let content = '<table>';
            content += `
                <thead>
                    <tr>
                        <th>Tanggal</th>
                        <th>Nama Karyawan</th>
                        <th>Shift</th>
                        <th>Masuk</th>
                        <th>Pulang</th>
                        <th>Status</th>
                        <th>Keterangan</th>
                    </tr>
                </thead>
                <tbody>
            `;
            
            for (let tanggal = 1; tanggal <= hariDalamBulan; tanggal++) {
                const dateStr = bulanInput + '-' + String(tanggal).padStart(2, '0');
                const dayOfWeek = new Date(tahun, bulan - 1, tanggal).getDay();
                const namaHari = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'][dayOfWeek];
                
                if (absensi[bulanInput][dateStr]) {
                    absensi[bulanInput][dateStr].forEach(item => {
                        const karyawanData = karyawan.find(k => k.id === item.karyawanId);
                        if (!karyawanData) return;
                        
                        // Filter berdasarkan karyawan yang dipilih
                        if (filterKaryawan.length > 0 && !filterKaryawan.includes(item.karyawanId)) {
                            return;
                        }
                        
                        content += `
                            <tr>
                                <td>${namaHari}, ${tanggal} ${namaBulan} ${tahun}</td>
                                <td>${karyawanData.nama}</td>
                                <td>${item.shift.toUpperCase()}</td>
                                <td>${item.masuk || '-'}</td>
                                <td>${item.pulang || '-'}</td>
                                <td>${getStatusText(item.status)}</td>
                                <td>${item.keterangan || '-'}</td>
                            </tr>
                        `;
                    });
                }
            }
            
            content += '</tbody></table>';
            return content;
        }
        
        function cetakLaporan() {
            document.getElementById('format-laporan').value = 'cetak';
            generateLaporan();
        }
        
        // Dashboard functions
        function updateDashboard() {
            const today = new Date();
            const todayStr = today.toISOString().split('T')[0];
            const bulanInput = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0');
            
            // Update total karyawan
            document.getElementById('total-karyawan').textContent = karyawan.filter(k => k.status === 'active').length;
            
            // Update shift hari ini
            let shiftHariIni = 0;
            if (jadwal[bulanInput] && jadwal[bulanInput][todayStr]) {
                shiftHariIni = jadwal[bulanInput][todayStr].filter(item => item.shift !== 'libur').length;
            }
            document.getElementById('shift-hari-ini').textContent = shiftHariIni;
            
            // Update belum absen
            let belumAbsen = 0;
            if (jadwal[bulanInput] && jadwal[bulanInput][todayStr]) {
                if (!absensi[bulanInput] || !absensi[bulanInput][todayStr]) {
                    belumAbsen = jadwal[bulanInput][todayStr].filter(item => item.shift !== 'libur').length;
                } else {
                    belumAbsen = jadwal[bulanInput][todayStr].filter(item => {
                        if (item.shift === 'libur') return false;
                        const absenItem = absensi[bulanInput][todayStr].find(a => a.karyawanId === item.karyawanId);
                        return !absenItem || !absenItem.masuk;
                    }).length;
                }
            }
            document.getElementById('belum-absen').textContent = belumAbsen;
            
            // Update mini calendar
            updateMiniCalendar();
            
            // Update aktivitas terkini
            updateAktivitasTerkini();
        }
        
        function updateMiniCalendar() {
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            const monthNames = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
            const dayNames = ['Min', 'Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab'];
            
            let calendarHTML = `
                <div style="text-align: center; margin-bottom: 15px; font-weight: bold; font-size: 18px;">
                    ${monthNames[currentMonth]} ${currentYear}
                </div>
                <div class="calendar">
            `;
            
            // Header hari
            dayNames.forEach(day => {
                calendarHTML += `<div class="calendar-header">${day}</div>`;
            });
            
            // Hari kosong di awal bulan
            for (let i = 0; i < firstDay; i++) {
                calendarHTML += '<div class="calendar-day"></div>';
            }
            
            // Hari dalam bulan
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const isToday = day === today.getDate() && currentMonth === today.getMonth() && currentYear === today.getFullYear();
                
                calendarHTML += `
                    <div class="calendar-day ${isToday ? 'today' : ''}" style="${isToday ? 'border: 2px solid var(--primary-color);' : ''}">
                        <div class="day-number">${day}</div>
                `;
                
                // Tampilkan info shift jika ada
                const bulanInput = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}`;
                if (jadwal[bulanInput] && jadwal[bulanInput][dateStr]) {
                    const shiftCount = jadwal[bulanInput][dateStr].filter(item => item.shift !== 'libur').length;
                    if (shiftCount > 0) {
                        calendarHTML += `<div class="shift-item" style="font-size: 10px; padding: 2px;">${shiftCount} shift</div>`;
                    }
                }
                
                calendarHTML += `</div>`;
            }
            
            calendarHTML += '</div>';
            document.getElementById('mini-calendar').innerHTML = calendarHTML;
        }
        
        function updateAktivitasTerkini() {
            const tbody = document.getElementById('aktivitas-terkini');
            tbody.innerHTML = '';
            
            // Ambil 5 aktivitas terbaru dari absensi
            const today = new Date();
            const bulanInput = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0');
            
            if (!absensi[bulanInput]) return;
            
            const aktivitas = [];
            
            for (const dateStr in absensi[bulanInput]) {
                absensi[bulanInput][dateStr].forEach(item => {
                    const karyawanData = karyawan.find(k => k.id === item.karyawanId);
                    if (!karyawanData) return;
                    
                    if (item.masuk) {
                        aktivitas.push({
                            tanggal: dateStr,
                            waktu: item.masuk,
                            nama: karyawanData.nama,
                            aktivitas: 'Absen masuk',
                            status: item.status
                        });
                    }
                    
                    if (item.pulang) {
                        aktivitas.push({
                            tanggal: dateStr,
                            waktu: item.pulang,
                            nama: karyawanData.nama,
                            aktivitas: 'Absen pulang',
                            status: item.status
                        });
                    }
                });
            }
            
            // Urutkan berdasarkan tanggal dan waktu terbaru
            aktivitas.sort((a, b) => {
                const dateA = new Date(`${a.tanggal}T${a.waktu}`);
                const dateB = new Date(`${b.tanggal}T${b.waktu}`);
                return dateB - dateA;
            });
            
            // Tampilkan maksimal 5 aktivitas
            aktivitas.slice(0, 5).forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatTanggal(item.tanggal)} ${item.waktu}</td>
                    <td>${item.nama}</td>
                    <td>${item.aktivitas}</td>
                    <td><span class="badge ${getStatusBadgeClass(item.status)}">${getStatusText(item.status)}</span></td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Helper functions
        function formatTanggal(dateStr) {
            if (!dateStr) return '';
            const [tahun, bulan, tanggal] = dateStr.split('-');
            const namaBulan = getNamaBulan(parseInt(bulan) - 1);
            return `${tanggal} ${namaBulan} ${tahun}`;
        }
        
        function getNamaBulan(index) {
            const bulan = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
            return bulan[index];
        }
        
        function getJamShift(shift) {
            switch (shift) {
                case 'pagi': return '07:00 - 15:00';
                case 'sore': return '15:00 - 23:00';
                case 'malam': return '23:00 - 07:00';
                default: return '-';
            }
        }
        
        function getStatusText(status) {
            switch (status) {
                case 'hadir': return 'Hadir';
                case 'terlambat': return 'Terlambat';
                case 'izin': return 'Izin';
                case 'sakit': return 'Sakit';
                case 'cuti': return 'Cuti';
                case 'libur': return 'Libur';
                case 'alpa': return 'Tanpa Keterangan';
                default: return status;
            }
        }
        
        function getStatusBadgeClass(status) {
            switch (status) {
                case 'hadir': return 'badge-pagi';
                case 'terlambat': return 'badge-warning';
                case 'izin': return 'badge-cuti';
                case 'sakit': return 'badge-sakit';
                case 'cuti': return 'badge-cuti';
                case 'libur': return 'badge-libur';
                case 'alpa': return 'badge-danger';
                default: return '';
            }
        }
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setupTabNavigation();
            setupModalFunctionality();
            initSampleData();
            
            // Set focus to absen input
            document.getElementById('id-karyawan-absen').focus();
        });
    </script>
</body>
</html>
